<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indirect Cost & Headcount CoE Â· FP&A Portfolio</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    /* module-hero, module-label, module-title, module-pill, module-subtitle,
       feature-chips, chip â€” all in style.css */

    /* â”€â”€ Main layout with sidebar â”€â”€ */
    .module-layout {
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 20px;
      align-items: start;
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px 32px;
    }

    /* â”€â”€ Sticky sidebar â”€â”€ */
    .data-badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-weight: 600;
      display: inline-block;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .data-badge.random {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      color: #92400e;
    }

    /* â”€â”€ Scenario tabs in sidebar â”€â”€ */

    /* â”€â”€ Main content area â”€â”€ */
    .main-content { min-width: 0; }

    /* â”€â”€ Module sections â”€â”€ */
    .module-section { padding: 0 0 48px 0; }
    .module-section-title {
      font-size: 24px;
      margin-bottom: 20px;
      letter-spacing: -0.02em;
    }
    .module-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-soft);
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .card-title { font-size: 18px; font-weight: 650; }

    /* â”€â”€ Buttons â”€â”€ */
    .btn-small {
      padding: 7px 12px;
      font-size: 12px;
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      transition: all 140ms ease;
      white-space: nowrap;
    }
    .btn-small:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .btn-small:active { transform: translateY(1px); }
    .btn-primary {
      background: var(--text);
      color: white;
      border-color: var(--text);
    }
    .btn-primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .btn-full { width: 100%; justify-content: center; display: flex; }

    /* â”€â”€ KPI grid â”€â”€ */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    .kpi-box {
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: rgba(246,248,251,0.5);
    }
    .kpi-box-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .kpi-box-value { font-size: 20px; font-weight: 650; }
    .kpi-box-sub { font-size: 12px; margin-top: 6px; color: var(--muted); }

    /* â”€â”€ Charts â”€â”€ */
    .chart-container {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: white;
      position: relative;
    }
    .chart-wrapper { position: relative; width: 100%; }
    .chart-canvas { display: block; width: 100%; height: auto; }
    .chart-tooltip {
      position: absolute;
      background: rgba(11,18,32,0.95);
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 150ms ease;
      z-index: 100;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .chart-tooltip.visible { opacity: 1; }
    .chart-tooltip strong { display: block; margin-bottom: 4px; font-size: 13px; }

    /* â”€â”€ Tables â”€â”€ */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin: 16px 0;
    }
    .data-table th {
      text-align: left;
      padding: 10px 12px;
      border-bottom: 2px solid var(--border);
      font-weight: 650;
      color: var(--text);
      font-size: 12px;
      letter-spacing: 0.01em;
      text-transform: none;
    }
    .data-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover { background: rgba(246,248,251,0.5); }

    /* â”€â”€ Hiring recommendation boxes â”€â”€ */
    .hiring-rec {
      padding: 16px;
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
      border: 1px solid;
    }
    .hiring-rec.recommend {
      background: rgba(5,150,105,0.06);
      border-color: rgba(5,150,105,0.18);
    }
    .hiring-rec.caution {
      background: rgba(217,119,6,0.06);
      border-color: rgba(217,119,6,0.18);
    }
    .hiring-rec.delay {
      background: rgba(239,68,68,0.06);
      border-color: rgba(239,68,68,0.18);
    }
    .hiring-rec-title { font-size: 15px; font-weight: 650; margin-bottom: 8px; }
    .hiring-rec-reason { font-size: 13px; line-height: 1.6; color: var(--text); }

    /* â”€â”€ Tradeoff comparison â”€â”€ */
    .tradeoff-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 20px;
    }
    .tradeoff-box {
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: rgba(246,248,251,0.5);
    }
    .tradeoff-title { font-size: 16px; font-weight: 650; margin-bottom: 12px; }
    .tradeoff-section { margin-bottom: 12px; }
    .tradeoff-section:last-child { margin-bottom: 0; }
    .tradeoff-label { font-size: 13px; color: var(--muted); margin-bottom: 8px; }
    .tradeoff-list { display: grid; gap: 6px; }
    .tradeoff-item { display: flex; gap: 8px; font-size: 13px; line-height: 1.5; }
    .tradeoff-item::before { content: 'â€¢'; color: var(--accent); font-weight: 700; flex-shrink: 0; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOARD DECISION CARD (NEW â€” CFO upgrade)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .board-decision-card {
      background: white;
      border: 1.5px solid rgba(11,18,32,0.14);
      border-radius: var(--radius);
      padding: 20px 22px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(11,18,32,0.06);
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0 20px;
      align-items: start;
    }
    .bd-verdict-col {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 120px;
    }
    .bd-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .bd-decision {
      font-size: 18px;
      font-weight: 800;
      letter-spacing: -0.01em;
      line-height: 1;
    }
    .bd-confidence-pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid;
      width: fit-content;
      letter-spacing: 0.03em;
    }
    .bd-conf-high  { background: rgba(11,18,32,0.06); border-color: rgba(11,18,32,0.18); color: var(--text); }
    .bd-conf-med   { background: rgba(217,119,6,0.08); border-color: rgba(217,119,6,0.22); color: #92400e; }
    .bd-conf-low   { background: rgba(107,114,128,0.08); border-color: rgba(107,114,128,0.22); color: #374151; }
    .bd-rationale-col { border-left: 1px solid var(--border); padding-left: 20px; }
    .bd-bullets { display: grid; gap: 6px; margin-top: 6px; }
    .bd-bullet {
      font-size: 13px;
      color: var(--text);
      line-height: 1.5;
      display: flex;
      gap: 8px;
    }
    .bd-bullet::before {
      content: 'â€”';
      color: var(--muted);
      font-weight: 600;
      flex-shrink: 0;
    }
    /* Decision color variants */
    .bd-hire     { color: #059669; }
    .bd-nohire   { color: #dc2626; }
    .bd-slow     { color: #d97706; }
    .bd-cut      { color: #dc2626; }
    .bd-raise    { color: #1b4d7a; }

    /* â”€â”€ Signal badges inside BD card â”€â”€ */
    .bd-signals { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .bd-signal {
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid;
    }
    .sig-green  { background: rgba(5,150,105,0.08);  border-color: rgba(5,150,105,0.22);  color: #065f46; }
    .sig-yellow { background: rgba(217,119,6,0.08);  border-color: rgba(217,119,6,0.22);  color: #92400e; }
    .sig-red    { background: rgba(239,68,68,0.08);  border-color: rgba(239,68,68,0.22);  color: #991b1b; }

    /* â”€â”€ Raise Plan callout (shown when decision = RAISE) â”€â”€ */
    .raise-plan-callout {
      margin-top: 16px;
      padding: 16px 18px;
      background: rgba(27,77,122,0.05);
      border: 1.5px solid rgba(27,77,122,0.18);
      border-radius: var(--radius-sm);
      display: grid;
      gap: 10px;
    }
    .raise-plan-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .raise-plan-badge {
      font-size: 10px;
      font-weight: 800;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      background: rgba(27,77,122,0.12);
      border: 1px solid rgba(27,77,122,0.22);
      color: #1b4d7a;
      padding: 3px 9px;
      border-radius: 999px;
    }
    .raise-plan-title {
      font-size: 14px;
      font-weight: 700;
      color: #1b4d7a;
    }
    .raise-plan-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .raise-plan-metric {
      padding: 10px 12px;
      border: 1px solid rgba(27,77,122,0.12);
      border-radius: 10px;
      background: white;
    }
    .raise-plan-metric-label {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .raise-plan-metric-value {
      font-size: 15px;
      font-weight: 700;
      color: #1b4d7a;
    }
    .raise-plan-note {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.55;
    }
    @media (max-width: 640px) {
      .raise-plan-grid { grid-template-columns: 1fr 1fr; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HIRING PLAN TABLE (NEW â€” deterministic 12-month)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hiring-plan-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 16px;
    }
    .hiring-plan-table th {
      padding: 8px 10px;
      border-bottom: 2px solid var(--border);
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.02em;
      color: var(--text);
      text-align: center;
      text-transform: none;
    }
    .hiring-plan-table th:first-child { text-align: left; }
    .hiring-plan-table td {
      padding: 7px 10px;
      border-bottom: 1px solid var(--border);
      text-align: center;
      color: var(--text);
    }
    .hiring-plan-table td:first-child { text-align: left; font-weight: 600; }
    .hiring-plan-table tr:last-child td { border-bottom: none; }
    .hiring-plan-table tr:hover { background: rgba(246,248,251,0.5); }
    .hp-hire    { color: #059669; font-weight: 700; }
    .hp-ramp    { color: #d97706; font-size: 11px; }
    .hp-cost    { color: #dc2626; font-size: 11px; }
    .hp-none    { color: var(--muted); }
    .plan-tabs  { display: flex; gap: 8px; margin-bottom: 16px; }
    .plan-tab {
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 600;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      transition: all 120ms ease;
    }
    .plan-tab.active { background: var(--text); color: white; border-color: var(--text); }

    /* â”€â”€ Tooltip system â€” rendered by JS into #tt-root on <body> â”€â”€ */
    /* CSS ::after approach removed: caused clipping, flicker, and z-index bugs */
    [data-tt] { cursor: help; }

    /* â”€â”€ Kill-switch: neutralize ALL ::after tooltip rules from style.css â”€â”€ */
    /* style.css still has .help-icon::after and .term-helper::after active;  */
    /* override them here so only the JS #tt-root tooltip fires.              */
    .help-icon::after,
    .help-icon[data-help]::after,
    .term-helper::after,
    .term-helper:hover::after,
    [data-tt]::after,
    [data-tt]:hover::after,
    .help-icon:hover::after {
      content: none !important;
      display: none !important;
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
    }

    /* Tooltip bubble (injected once into body by initTooltips()) */
    #tt-root {
      position: fixed;
      z-index: 99999;
      pointer-events: none;
      padding: 9px 13px;
      background: rgba(11,18,32,0.96);
      color: #f6f8fb;
      font-size: 12px;
      font-weight: 400;
      line-height: 1.55;
      border-radius: 9px;
      white-space: normal;
      width: 270px;
      max-width: calc(100vw - 24px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.28);
      text-align: left;
      opacity: 0;
      transition: opacity 120ms ease;
      font-family: var(--font-sans);
    }
    #tt-root.tt-visible { opacity: 1; }

    /* Tiny ? badge for labels */
    .tt-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: rgba(93,107,122,0.12);
      border: 1px solid rgba(93,107,122,0.22);
      color: var(--muted);
      font-size: 10px;
      font-weight: 700;
      cursor: help;
      vertical-align: middle;
      margin-left: 4px;
      flex-shrink: 0;
    }

    /* Glossary inline term tooltip */
    .gl-term {
      border-bottom: 1px dotted rgba(93,107,122,0.40);
      cursor: help;
    }

    /* Legacy help-icon kept for sidebar â€” tooltip now handled by JS initTooltips() via data-help attr */
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.18);
      color: var(--accent);
      font-size: 11px;
      font-weight: 700;
      cursor: help;
      position: relative;
      flex-shrink: 0;
    }
    .help-icon::before { content: '?'; line-height: 1; }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width: 980px) {
      .module-layout { grid-template-columns: 1fr; padding: 16px; }
      .kpi-grid { grid-template-columns: repeat(2, 1fr); }
      .tradeoff-grid { grid-template-columns: 1fr; }
      .board-decision-card { grid-template-columns: 1fr; }
      .bd-rationale-col { border-left: none; padding-left: 0; border-top: 1px solid var(--border); padding-top: 16px; margin-top: 8px; }
    }
    @media (max-width: 560px) {
      .kpi-grid { grid-template-columns: 1fr; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ASSUMPTIONS CARD (CFO upgrade) â€” collapsible
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    /* Sidebar sections hidden when assumptions panel is open */
    .sidebar-section.js-hideable { transition: opacity 180ms ease, max-height 220ms ease, margin-bottom 180ms ease; }
    .sidebar-section.js-hideable.is-hidden {
      opacity: 0;
      max-height: 0 !important;
      margin-bottom: 0 !important;
      overflow: hidden;
      pointer-events: none;
    }

    /* Assumptions trigger button (replaces plain title) */
    .assump-trigger {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      font: inherit;
      text-align: left;
      margin-bottom: 10px;
    }
    .assump-trigger-label {
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .assump-trigger-label .tt-icon { flex-shrink: 0; }
    .assump-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 220ms ease;
      line-height: 1;
    }
    .assump-chevron.open { transform: rotate(180deg); }

    /* The collapsible body */
    .assump-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 300ms ease, opacity 220ms ease;
      opacity: 0;
    }
    .assump-body.open {
      max-height: 1200px;
      opacity: 1;
    }

    .assumptions-card {
      background: rgba(246,248,251,0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px;
      margin-top: 0;
    }
    .assump-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 9px;
    }
    .assump-row:last-child { margin-bottom: 0; }
    .assump-label {
      font-size: 11px;
      color: var(--muted);
      flex: 1;
      line-height: 1.3;
    }
    .assump-input {
      width: 58px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: var(--font-sans);
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .assump-input::-webkit-outer-spin-button,
    .assump-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .assump-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .assump-input.invalid {
      border-color: #dc2626;
      background: rgba(220,38,38,0.05);
    }
    .assump-divider {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 7px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EXPORT DROPDOWN (CFO upgrade)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .export-wrap {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    .export-btn {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 600;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      transition: all 140ms ease;
    }
    .export-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .export-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 140ms ease;
    }
    .export-dropdown {
      display: none;
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(11,18,32,0.12);
      z-index: 200;
      overflow: hidden;
    }
    .export-dropdown.open { display: block; }
    .export-item {
      display: block;
      width: 100%;
      padding: 10px 14px;
      font-size: 12px;
      font-weight: 500;
      text-align: left;
      background: white;
      border: none;
      cursor: pointer;
      color: var(--text);
      border-bottom: 1px solid var(--border);
      transition: background 100ms ease;
    }
    .export-item:last-child { border-bottom: none; }
    .export-item:hover { background: rgba(246,248,251,0.8); }
    .export-toast {
      position: fixed;
      bottom: 70px;
      right: 18px;
      padding: 10px 16px;
      background: rgba(11,18,32,0.92);
      color: white;
      font-size: 13px;
      border-radius: 10px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.22);
      z-index: 9999;
      opacity: 0;
      transform: translateY(8px);
      pointer-events: none;
      transition: opacity 250ms ease, transform 250ms ease;
    }
    .export-toast.show { opacity: 1; transform: translateY(0); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOARD DECISION â€” Rule fired + values vs thresholds
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bd-rule-fired {
      margin-top: 8px;
      padding: 8px 10px;
      background: rgba(246,248,251,0.7);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.5;
    }
    .bd-rule-fired strong { color: var(--text); font-size: 11px; }
    .bd-values-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      margin-top: 8px;
    }
    .bd-value-chip {
      padding: 6px 9px;
      border-radius: 7px;
      border: 1px solid var(--border);
      background: rgba(246,248,251,0.6);
      font-size: 11px;
      line-height: 1.4;
    }
    .bd-value-chip .bv-label { color: var(--muted); }
    .bd-value-chip .bv-val { font-weight: 700; color: var(--text); }
    .bd-value-chip .bv-thresh { color: var(--muted); font-size: 10px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COMP INFLATION KNOB (CFO upgrade)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .inflation-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(27,77,122,0.08);
      border: 1px solid rgba(27,77,122,0.18);
      color: #1b4d7a;
      font-weight: 600;
    }

    /* â”€â”€ Standardized Decision Box â”€â”€ */
    .decision-box {
      border: 1.5px solid var(--accent, #0f766e);
      border-radius: 18px;
      padding: 20px 24px;
      margin-bottom: 24px;
      background: white;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.08), 0 8px 18px rgba(11,18,32,0.06);
      transition: border-color 200ms ease, box-shadow 200ms ease, background 200ms ease;
    }
    .decision-box--positive {
      border-color: #0f766e; background: #f0fdf9;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.10), 0 8px 18px rgba(11,18,32,0.06);
    }
    .decision-box--positive .decision-box-eyebrow { color: #0f766e; }
    .decision-box--positive .verdict-action        { color: #0f766e; }
    .decision-box--positive .decision-box-bullets li::before { color: #0f766e; }
    .decision-box--warning {
      border-color: #d97706; background: #fffbeb;
      box-shadow: 0 0 0 4px rgba(217,119,6,0.10), 0 8px 18px rgba(11,18,32,0.06);
    }
    .decision-box--warning .decision-box-eyebrow { color: #d97706; }
    .decision-box--warning .verdict-action        { color: #d97706; }
    .decision-box--warning .decision-box-bullets li::before { color: #d97706; }
    .decision-box--negative {
      border-color: #dc2626; background: #fef2f2;
      box-shadow: 0 0 0 4px rgba(220,38,38,0.10), 0 8px 18px rgba(11,18,32,0.06);
    }
    .decision-box--negative .decision-box-eyebrow { color: #dc2626; }
    .decision-box--negative .verdict-action        { color: #dc2626; }
    .decision-box--negative .decision-box-bullets li::before { color: #dc2626; }
    .decision-box-eyebrow {
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.07em; color: #0f766e; margin-bottom: 8px;
    }
    .decision-box-verdict {
      font-size: 20px; font-weight: 700; letter-spacing: -0.02em;
      color: #0b1220; margin-bottom: 12px;
    }
    .decision-box-verdict .verdict-action { color: #0f766e; }
    .decision-box-bullets {
      list-style: none; margin: 0 0 10px 0; padding: 0;
      display: flex; flex-direction: column; gap: 6px;
    }
    .decision-box-bullets li {
      font-size: 13px; color: #5d6b7a;
      display: flex; align-items: flex-start; gap: 8px; line-height: 1.4;
    }
    .decision-box-bullets li::before {
      content: 'â€º'; color: #0f766e; font-weight: 700; flex-shrink: 0;
    }
    .decision-box-next {
      font-size: 12px; font-weight: 600; color: #5d6b7a;
      border-top: 1px solid rgba(12,23,45,0.10); padding-top: 10px;
    }
    .decision-box-next span { color: #1b4d7a; }
  
    /* â”€â”€ Data-needed strip â”€â”€ */
    .data-needed-section {
      padding: 0 0 0 0;
      border-bottom: 1px solid var(--border, #e5e8ef);
    }
    .data-needed-wrap {
      max-width: var(--max-w, 1200px);
      margin: 0 auto;
      padding: 20px 32px 24px;
    }
    .data-needed-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--muted, #6b7280);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .data-needed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(185px, 1fr));
      gap: 8px;
      align-items: stretch;
    }
    .data-needed-item {
      padding: 10px 12px;
      border: 1px solid var(--border, #e5e8ef);
      border-radius: 9px;
      display: flex;
      align-items: flex-start;
      gap: 9px;
      background: #fafbfc;
      min-height: 88px;
      box-sizing: border-box;
    }
    .data-needed-icon {
      width: 26px;
      height: 26px;
      font-size: 13px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }
    .data-needed-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text, #0b1220);
      margin-bottom: 3px;
      line-height: 1.35;
    }
    .data-needed-desc {
      font-size: 10px;
      color: var(--muted, #6b7280);
      line-height: 1.5;
    }


    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SIDEBAR â€” Accordion (shared across all modules)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sidebar {
      position: sticky;
      top: 80px;
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      max-height: calc(100vh - 100px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(12,23,45,0.15) transparent;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(12,23,45,0.15); border-radius: 4px; }
    .sidebar::-webkit-scrollbar-thumb:hover { background: rgba(12,23,45,0.28); }

    /* Static top section (data mode badge + always-visible controls) */
    .sb-static {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .sb-static-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    /* Accordion group */
    .sb-acc-group {
      border-bottom: 1px solid var(--border);
    }
    .sb-acc-group:last-child { border-bottom: none; }

    .sb-acc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      transition: color 120ms ease;
    }
    .sb-acc-header:hover { color: var(--text); }
    .sb-acc-header.open  { color: var(--text); }
    .sb-acc-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 200ms ease;
      flex-shrink: 0;
    }
    .sb-acc-header.open .sb-acc-chevron {
      transform: rotate(180deg);
      color: var(--text);
    }
    .sb-acc-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft, rgba(15,118,110,0.10));
      color: var(--accent, #0f766e);
      flex-shrink: 0;
      margin-left: auto;
    }

    .sb-acc-body {
      display: none;
      padding-bottom: 14px;
    }
    .sb-acc-body.open { display: block; }

    /* Buttons inside accordion */
    .sb-acc-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: all 140ms ease;
      text-align: left;
      white-space: nowrap;
      font-family: inherit;
    }
    .sb-acc-btn:first-child { margin-top: 0; }
    .sb-acc-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .sb-acc-btn:active { transform: translateY(1px); }
    .sb-acc-btn.primary { background: var(--text, #0b1220); color: white; border-color: var(--text, #0b1220); }
    .sb-acc-btn.primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-acc-btn.accent  { background: var(--accent, #0f766e); color: white; border-color: var(--accent, #0f766e); }

    /* Scenario tabs inside accordion */
    .sb-acc-tabs { display: flex; flex-direction: column; gap: 6px; }
    .sb-acc-tab {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }
    .sb-acc-tab:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-tab.active { background: var(--text, #0b1220); color: white; border-color: var(--text, #0b1220); }

    /* Input rows inside accordion */
    .sb-acc-input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .sb-acc-input-row:last-child { margin-bottom: 0; }
    .sb-acc-input-row label {
      font-size: 11px;
      color: var(--muted, #5d6b7a);
      flex: 1;
      line-height: 1.3;
    }
    .sb-acc-input-row input[type="number"] {
      width: 76px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: inherit;
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .sb-acc-input-row input[type="number"]::-webkit-outer-spin-button,
    .sb-acc-input-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sb-acc-input-row input[type="number"]:focus {
      outline: none;
      border-color: var(--accent, #0f766e);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .sb-acc-sub {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 8px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* Responsive: on mobile sidebar goes full width, no sticky, no scroll */
    @media (max-width: 860px) {
      .sidebar {
        position: static;
        max-height: none;
        overflow-y: visible;
      }
    }

  
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHARED SIDEBAR SHELL â€” standardised across all modules
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    /* Layout */
    .module-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      align-items: start;
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .main-content { min-width: 0; }

    /* Mobile Controls Toggle Button */
    .mobile-controls-btn {
      display: none;
      align-items: center;
      gap: 10px;
      width: 100%;
      padding: 12px 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      cursor: pointer;
      margin-bottom: 4px;
      box-shadow: var(--shadow-soft);
      transition: all 140ms ease;
    }
    .mobile-controls-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: var(--shadow);
    }
    .mobile-controls-btn .mcb-icon { font-size: 16px; flex-shrink: 0; }
    .mobile-controls-btn .mcb-label { flex: 1; text-align: left; }
    .mobile-controls-btn .mcb-chevron {
      font-size: 11px; color: var(--muted);
      transition: transform 200ms ease;
    }
    .mobile-controls-btn[aria-expanded="true"] .mcb-chevron { transform: rotate(180deg); }

    /* Sidebar shell */
    .sidebar {
      position: sticky;
      top: calc(var(--nav-h, 56px) + 36px);
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      max-height: calc(100vh - var(--nav-h, 56px) - 52px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(12,23,45,0.15) transparent;
      width: 280px;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(12,23,45,0.15); border-radius: 4px; }
    .sidebar::-webkit-scrollbar-thumb:hover { background: rgba(12,23,45,0.28); }

    /* Static section (Data Mode etc â€” always visible) */
    .sb-static {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .sb-static-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    /* â”€â”€ Data Mode segmented control (fixed height, no wrapping) â”€â”€ */
    .sb-data-mode-row {
      display: flex;
      gap: 0;
      height: 34px;              /* fixed height â€” prevents layout shift */
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-muted);
      flex-wrap: nowrap;         /* never wrap */
    }
    .sb-data-mode-btn {
      flex: 1;
      min-width: 0;
      height: 100%;
      padding: 0 4px;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: inherit;
    }
    .sb-data-mode-btn:last-child { border-right: none; }
    .sb-data-mode-btn:hover { background: rgba(12,23,45,0.04); color: var(--text); }
    .sb-data-mode-btn.active {
      background: var(--text);
      color: white;
    }

    /* Mode pills (2-option) â€” also fixed height */
    .sb-mode-pills {
      display: flex;
      gap: 0;
      height: 34px;
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-muted);
      flex-wrap: nowrap;
    }
    .sb-mode-pill {
      flex: 1;
      height: 100%;
      padding: 0 6px;
      border: none;
      border-right: 1px solid var(--border);
      background: transparent;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: inherit;
      text-align: center;
    }
    .sb-mode-pill:last-child { border-right: none; }
    .sb-mode-pill:hover { background: rgba(12,23,45,0.04); color: var(--text); }
    .sb-mode-pill.active { background: var(--text); color: white; }

    /* Badge */
    .data-badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-weight: 600;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .data-badge.random {
      background: #fef3c7;
      border-color: #fbbf24;
      color: #92400e;
    }

    /* Accordion groups */
    .sb-acc-group {
      border-bottom: 1px solid var(--border);
    }
    .sb-acc-group:last-child { border-bottom: none; }

    .sb-acc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      transition: color 120ms ease;
      font-family: inherit;
    }
    .sb-acc-header:hover { color: var(--text); }
    .sb-acc-header.open  { color: var(--text); }
    .sb-acc-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 200ms ease;
      flex-shrink: 0;
    }
    .sb-acc-header.open .sb-acc-chevron { transform: rotate(180deg); color: var(--text); }
    .sb-acc-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      flex-shrink: 0;
      margin-left: auto;
    }

    .sb-acc-body {
      display: none;
      padding-bottom: 14px;
    }
    .sb-acc-body.open { display: block; }

    /* Buttons inside accordion */
    .sb-acc-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: all 140ms ease;
      text-align: left;
      white-space: nowrap;
      font-family: inherit;
    }
    .sb-acc-btn:first-child { margin-top: 0; }
    .sb-acc-btn:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-btn:active { transform: translateY(1px); }
    .sb-acc-btn.primary { background: var(--text); color: white; border-color: var(--text); }
    .sb-acc-btn.primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-acc-btn.accent  { background: var(--accent); color: white; border-color: var(--accent); }

    /* Tabs (scenario selectors etc.) */
    .sb-acc-tabs { display: flex; flex-direction: column; gap: 6px; }
    .sb-acc-tab {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }
    .sb-acc-tab:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-tab.active { background: var(--text); color: white; border-color: var(--text); }

    /* Input rows */
    .sb-acc-input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .sb-acc-input-row:last-child { margin-bottom: 0; }
    .sb-acc-input-row label {
      font-size: 11px;
      color: var(--muted);
      flex: 1;
      line-height: 1.3;
    }
    .sb-acc-input-row input[type="number"] {
      width: 76px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: inherit;
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .sb-acc-input-row input[type="number"]::-webkit-outer-spin-button,
    .sb-acc-input-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sb-acc-input-row input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .sb-acc-sub {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 8px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* Action buttons (full-width) */
    .sb-action-btn {
      display: flex; align-items: center; gap: 8px;
      width: 100%; padding: 7px 12px;
      border-radius: 999px; border: 1px solid var(--border);
      background: white; font-size: 12px; font-weight: 600;
      cursor: pointer; margin-top: 6px;
      transition: all 140ms ease; text-align: left;
      white-space: nowrap; font-family: inherit;
    }
    .sb-action-btn:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-action-btn:active { transform: translateY(1px); }
    .sb-action-btn.sb-action-primary { background: var(--text); color: white; border-color: var(--text); }
    .sb-action-btn.sb-action-primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-action-btn.sb-action-accent  { background: var(--accent); color: white; border-color: var(--accent); }
    .sb-file-hidden { position: absolute; opacity: 0; width: 0; height: 0; }

    /* Sliders */
    .control-item { margin-bottom: 16px; }
    .control-item:last-child { margin-bottom: 0; }
    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text);
    }
    .control-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-2);
      font-family: var(--font-mono, monospace);
    }
    .control-input {
      -webkit-appearance: none; appearance: none;
      width: 100%; height: 6px;
      border-radius: 3px;
      background: var(--bg-muted);
      outline: none; cursor: pointer;
    }
    .control-input::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,118,110,0.3);
      transition: all 140ms ease;
    }
    .control-input::-webkit-slider-thumb:hover { transform: scale(1.1); }
    .control-input::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,118,110,0.3); border: none;
    }

    /* â”€â”€ Mobile responsive â”€â”€ */
    @media (max-width: 860px) {
      .module-layout {
        grid-template-columns: 1fr;
        padding: 16px;
      }
      .mobile-controls-btn { display: flex; }
      .sidebar {
        position: static;
        top: 0;
        width: 100%;
        max-height: none;
        overflow-y: visible;
        display: none;            /* hidden by default; JS toggles */
        border-radius: var(--radius-sm);
        margin-bottom: 8px;
      }
      .sidebar.mobile-open { display: block; }
    }

    @media (max-width: 560px) {
      .module-layout { padding: 12px; }
    }


</style>
<style>
/* â”€â”€ Global Time Ticker â”€â”€ */
.tz-live-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:#10b981;box-shadow:0 0 0 0 rgba(16,185,129,.4);animation:tzPulse 2.4s ease-in-out infinite;flex-shrink:0}
@keyframes tzPulse{0%{box-shadow:0 0 0 0 rgba(16,185,129,.4)}60%{box-shadow:0 0 0 5px rgba(16,185,129,0)}100%{box-shadow:0 0 0 0 rgba(16,185,129,0)}}
.tz-ticker{position:sticky;top:var(--nav-h,56px);z-index:89;background:rgba(250,251,252,.96);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-bottom:1px solid var(--border);height:36px;display:flex;align-items:center;opacity:0;pointer-events:none;transform:translateY(-4px);transition:opacity 220ms ease,transform 220ms ease}
.tz-ticker.tz-ticker--visible{opacity:1;pointer-events:auto;transform:translateY(0)}
.tz-ticker-inner{max-width:900px;width:100%;margin:0 auto;padding:0 24px;display:flex;align-items:center;overflow:hidden}
.tz-ticker-brand{display:inline-flex;align-items:center;gap:5px;font-size:10px;font-weight:750;letter-spacing:.07em;text-transform:uppercase;color:var(--accent);text-decoration:none;flex-shrink:0;padding-right:10px}
.tz-ticker-brand:hover{opacity:.75}
.tz-ticker-divider{width:1px;height:16px;background:var(--border);flex-shrink:0;margin-right:10px}
.tz-ticker-items{display:flex;align-items:center;overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;flex:1;min-width:0}
.tz-ticker-items::-webkit-scrollbar{display:none}
.tz-ticker-item{display:inline-flex;align-items:center;gap:5px;padding:0 12px;height:36px;font-size:11px;flex-shrink:0;border-right:1px solid var(--border);white-space:nowrap}
.tz-ticker-item:first-child{padding-left:0}.tz-ticker-item:last-child{border-right:none}
.tz-ticker-item-label{font-size:9px;font-weight:700;letter-spacing:.07em;text-transform:uppercase;color:var(--muted)}
.tz-ticker-item-value{font-size:11px;font-weight:620;color:var(--text);font-variant-numeric:tabular-nums}
.tz-ticker-item-value.tk-active{color:#059669;font-weight:700}.tz-ticker-item-value.tk-ending{color:#d97706;font-weight:700}.tz-ticker-item-value.tk-offline{color:#94a3b8}.tz-ticker-item-value.tk-window{color:var(--accent);font-weight:680}
.tz-ticker-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0}
.tz-ticker-dot.tk-active{background:#059669}.tz-ticker-dot.tk-ending{background:#d97706}.tz-ticker-dot.tk-offline{background:#cbd5e1}
@media(max-width:640px){.tz-ticker-inner{padding:0 12px}.tz-ticker-item{padding:0 9px}}
</style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <nav class="nav" aria-label="Main navigation">
        <a href="index.html" class="brand">
          <span class="brand-mark" aria-hidden="true"></span>
          <span>Ralph Patrick Divina</span>
        </a>
        <div class="nav-cta">
          <a href="index.html#card-indirect-cost" class="btn btn-ghost">&#8592; Back to Portfolio</a>
        </div>
      </nav>
    </div>
  </header>
</header>
<!-- Global Time Ticker -->
<div class="tz-ticker tz-ticker--visible" id="tz-ticker" aria-label="Global time coordination summary">
  <div class="tz-ticker-inner">
    <a class="tz-ticker-brand" href="index.html#tz-world" aria-label="Go to Time section">
      <span class="tz-live-dot"></span>
      <span>Time</span>
    </a>
    <div class="tz-ticker-divider"></div>
    <div class="tz-ticker-items" id="tz-ticker-items"><!-- JS-rendered --></div>
  </div>
</div>

  <!-- Module Hero -->
  <section class="module-hero">
    <div class="container">
      <div class="module-eyebrow">Workforce &bull; Cost Planning</div>
      <h1 class="module-title">Indirect Cost &amp; Headcount CoE</h1>
      <p class="module-subtitle">Plan fully-loaded headcount costs and evaluate hiring tradeoffs against runway and capacity.</p>
      <div class="feature-chips">
        <span class="chip">Fully Loaded Cost</span>
        <span class="chip">Ramp &amp; Capacity</span>
        <span class="chip">Hiring Triggers</span>
        <span class="chip">Runway Impact</span>
      </div>
    </div>
  </section>

  <!-- DATA NEEDED STRIP -->
  <div class="data-needed-section">
    <div class="data-needed-wrap">
      <div class="data-needed-label">ğŸ“‚ &nbsp;Data needed for this module</div>
      <div class="data-needed-grid">
        <div class="data-needed-item"><div class="data-needed-icon" style="background:#eff6ff;">ğŸ‘¤</div><div><div class="data-needed-name">Headcount Register</div><div class="data-needed-desc">All employees with role, level, dept &amp; hire date â†’ base cost foundation</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f0fdf9;">ğŸ’°</div><div><div class="data-needed-name">Compensation &amp; Benefits</div><div class="data-needed-desc">Salary, bonus, benefits &amp; payroll taxes â†’ fully loaded cost build</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fef3c7;">ğŸ“…</div><div><div class="data-needed-name">Hiring Plan / Req List</div><div class="data-needed-desc">Approved open roles &amp; target start dates â†’ forward cost projection</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f5f3ff;">âš¡</div><div><div class="data-needed-name">Productivity / Ramp Data</div><div class="data-needed-desc">Output or revenue per head by tenure â†’ capacity &amp; ramp modeling</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fdf2f8;">ğŸ¦</div><div><div class="data-needed-name">Cash &amp; Runway Snapshot</div><div class="data-needed-desc">Current cash balance &amp; burn â†’ links hiring decisions to runway</div></div></div>
      </div>
    </div>
  </div>


  <!-- Main Module Layout -->
  <div class="module-layout">
    <!-- Sidebar -->
        <!-- Mobile Controls Toggle (hidden on desktop) -->
    <button class="mobile-controls-btn" id="mobileControlsBtn" aria-expanded="false">
      <span class="mcb-icon">&#9881;</span>
      <span class="mcb-label">Controls</span>
      <span class="mcb-chevron">&#9660;</span>
    </button>
    <aside class="sidebar" id="sidebarPanel">

      <!-- DATA MODE â€” always visible at top -->
      <div class="sb-static">
        <div class="sb-static-title" style="font-size:10px;font-weight:700;color:var(--muted);letter-spacing:0.08em;text-transform:uppercase;display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px;">
          <span>DATA MODE</span>
          <span id="dataModeBadge2" class="data-badge">SAMPLE</span>
        </div>
        <div style="display:flex;gap:0;height:34px;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--bg-muted);flex-wrap:nowrap;">
          <button id="btnSampleMode" onclick="onUseSample()" style="flex:1;height:100%;padding:0 4px;background:var(--text);color:white;border:none;border-right:1px solid var(--border);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;">Sample</button>
          <button id="btnRandomMode" onclick="onRandomizeAll()" style="flex:1;height:100%;padding:0 4px;background:transparent;border:none;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;font-family:inherit;">Random</button>
        </div>
        <div style="font-size:10px;color:var(--muted);margin-top:6px;line-height:1.4;">Sample = fixed demo dataset &bull; Random = generated dataset</div>
      </div>

      <!-- Scenario â€” collapsible with visible badge -->
      <div class="sb-acc-group">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Scenario</span>
          <span id="sbScenarioLabel" class="sb-acc-badge">Base Case</span>
          <span class="sb-acc-chevron">â–¼</span>
        </button>
        <div class="sb-acc-body">
        <div class="sb-acc-tabs" id="scenarioTabsEl">
          <div style="display:flex;align-items:center;gap:8px;">
            <button class="sb-acc-tab active" data-scenario="base" onclick="onScenarioChange('base')" aria-label="Base Case scenario" style="flex:1;">Base Case</button>
            <span class="help-icon" aria-label="Base Case definition" data-tt="Base Case = 0% change (baseline assumptions)." style="flex-shrink:0;"></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <button class="sb-acc-tab" data-scenario="upside" onclick="onScenarioChange('upside')" aria-label="Upside scenario" style="flex:1;">Upside</button>
            <span class="help-icon" aria-label="Upside definition" data-tt="Upside = +15% vs Base Case." style="flex-shrink:0;"></span>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <button class="sb-acc-tab" data-scenario="downside" onclick="onScenarioChange('downside')" aria-label="Downside scenario" style="flex:1;">Downside</button>
            <span class="help-icon" aria-label="Downside definition" data-tt="Downside = -15% vs Base Case." style="flex-shrink:0;"></span>
          </div>
        </div>
        </div>
      </div>

      <!-- Starting Cash -->
      <div class="sb-acc-group" id="sidebarCash">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Starting Cash</span>
          <span class="tt-icon" data-tt="Total cash in the bank today. The model uses this to calculate how many months you can operate before running out of money.">?</span>
          <span class="sb-acc-chevron">â–¼</span>
        </button>
        <div class="sb-acc-body">
          <input
            type="number"
            id="cashBalanceInput"
            value="2400000"
            step="100000"
            style="padding: 9px 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 13px; font-family: var(--font-sans); width: 100%; margin-bottom:6px;"
            onchange="updateCashBalance()"
          />
          <div style="font-size: 11px; color: var(--muted); line-height: 1.4;">Cash in bank. Used to calculate runway.</div>
        </div>
      </div>

      <!-- Actions -->
      <div class="sb-acc-group" id="sidebarActions">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Actions</span>
          <span class="sb-acc-chevron">â–¼</span>
        </button>
        <div class="sb-acc-body">
          <button class="sb-acc-btn" onclick="downloadTemplates()">Download Templates</button>
          <div class="export-wrap" style="margin-top:6px;">
            <button class="export-btn" id="exportBtn" onclick="toggleExport(event)">
              <span>Export â–¾</span>
            </button>
            <div class="export-dropdown" id="exportDropdown">
              <button class="export-item" onclick="exportHiringPlanCSV()">ğŸ“„ Export Hiring Plan (CSV)</button>
              <button class="export-item" onclick="exportFunctionCostCSV()">ğŸ“Š Export Function Cost Table (CSV)</button>
              <button class="export-item" onclick="copyBoardSummary()">ğŸ“‹ Copy Board Summary</button>
            </div>
          </div>
        </div>
      </div>
      <div id="exportToast" class="export-toast"></div>

      <!-- Assumptions -->
      <div class="sb-acc-group" id="sidebarAssumptions">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)" id="assumpTrigger" aria-expanded="false">
          <span>Assumptions</span>
          <span class="tt-icon" data-tt="All model thresholds live here. Change any value and every KPI, chart, and decision updates instantly. Fully auditable for board review.">?</span>
          <span class="sb-acc-chevron" id="assumpChevron">â–¼</span>
        </button>
        <div class="sb-acc-body" id="assumpBody">
          <div class="assumptions-card">
            <div class="assump-divider">Utilization Thresholds</div>
            <div class="assump-row">
              <label class="assump-label" for="aUtilYellow"><span data-tt="The utilization % at which the team enters 'caution' territory. Below this = potential overcapacity. Default 70%.">Yellow start (%)</span></label>
              <input class="assump-input" id="aUtilYellow" type="number" value="70" min="1" max="100" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aUtilRed"><span data-tt="The utilization % at which the team is over-capacity. Above this = must hire. Default 85%.">Red start (%)</span></label>
              <input class="assump-input" id="aUtilRed" type="number" value="85" min="1" max="100" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-divider">Runway Guardrails (months)</div>
            <div class="assump-row">
              <label class="assump-label" for="aRunwayCritical"><span data-tt="Runway below this triggers CUT BURN. Cash emergency zone. Default 6 months.">Critical (&lt;)</span></label>
              <input class="assump-input" id="aRunwayCritical" type="number" value="6" min="1" max="60" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aRunwayCaution"><span data-tt="Runway below this triggers RAISE (if util is high). Caution zone. Default 12 months.">Caution (&lt;)</span></label>
              <input class="assump-input" id="aRunwayCaution" type="number" value="12" min="1" max="60" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aRunwaySafeHire"><span data-tt="Minimum runway needed before aggressive strategy fires a hire. Default 12 months.">Safe to Hire (Agg)</span></label>
              <input class="assump-input" id="aRunwaySafeHire" type="number" value="12" min="1" max="60" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aRunwaySafeCon"><span data-tt="Minimum runway needed before conservative strategy fires a hire. Higher bar. Default 15 months.">Safe to Hire (Con)</span></label>
              <input class="assump-input" id="aRunwaySafeCon" type="number" value="15" min="1" max="60" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-divider">Hire Parameters</div>
            <div class="assump-row">
              <label class="assump-label" for="aRampMonths"><span data-tt="How many months until a new hire reaches full productivity. Ramp curve: 25%â†’60%â†’100%. Default 3.">Ramp duration (mo)</span></label>
              <input class="assump-input" id="aRampMonths" type="number" value="3" min="1" max="12" step="1" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aOneTimeCost"><span data-tt="Recruiting + onboarding cost per new hire. Default $16,000.">One-time cost/hire ($)</span></label>
              <input class="assump-input" id="aOneTimeCost" type="number" value="16000" min="0" max="200000" step="500" style="width:72px;" onchange="onAssumpChange()">
            </div>
            <div class="assump-divider">CFO Control Knob</div>
            <div class="assump-row">
              <label class="assump-label" for="aCompInflation"><span data-tt="Annual salary inflation % applied to payroll costs. Default 6%.">Comp inflation (%/yr)</span></label>
              <input class="assump-input" id="aCompInflation" type="number" value="6" min="0" max="50" step="0.5" onchange="onAssumpChange()">
            </div>
            <div class="assump-divider">Scenario Multipliers</div>
            <div class="assump-row">
              <label class="assump-label" for="aScenarUpside"><span data-tt="Capacity multiplier for the Upside scenario. Default 1.15 (+15%).">Upside multiplier</span></label>
              <input class="assump-input" id="aScenarUpside" type="number" value="1.15" min="0.5" max="3" step="0.05" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aScenarDownside"><span data-tt="Capacity multiplier for the Downside scenario. Default 0.85 (-15%).">Downside multiplier</span></label>
              <input class="assump-input" id="aScenarDownside" type="number" value="0.85" min="0.1" max="1" step="0.05" onchange="onAssumpChange()">
            </div>
            <div class="assump-row">
              <label class="assump-label" for="aScenarUtilShift"><span data-tt="Utilization demand shift in Upside (+) and Downside (-) scenarios. Default Â±10pp.">Upside util shift (%pt)</span></label>
              <input class="assump-input" id="aScenarUtilShift" type="number" value="10" min="0" max="30" step="1" onchange="onAssumpChange()">
            </div>
            <div style="margin-top:12px;padding-top:10px;border-top:1px solid var(--border);">
              <button class="sb-acc-btn" onclick="resetAssumptions()" style="font-size:11px;color:var(--muted);">â†º Reset to defaults</button>
            </div>
          </div>
        </div>
      </div>

    </aside>

    <!-- Main Content -->
    <main class="main-content">

      <!-- â•â• SUMMARY SECTION â•â• -->
      <section class="module-section">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <h2 class="module-section-title" style="margin: 0;">Summary</h2>
          <span class="help-icon" id="summaryHelp" data-help="Quick snapshot: are we overstaffed? Burning too much cash? Team overloaded? At a glance view for the CFO or board."></span>
        </div>

        <!-- Standardized Decision Box -->
        <div class="decision-box" id="decisionBox">
          <div class="decision-box-eyebrow">Decision</div>
          <div id="decisionContent">
            <div class="decision-box-verdict" id="decisionVerdict">Loadingâ€¦</div>
            <ul class="decision-box-bullets" id="decisionBullets"></ul>
            <div class="decision-box-next" id="decisionNext"></div>
          </div>
        </div>

        <div id="summaryKPIs" class="kpi-grid"></div>
      </section>

      <!-- â•â• ORG STRUCTURE â•â• -->
      <section class="module-section">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <h2 class="module-section-title" style="margin: 0;">Org Structure by Function</h2>
          <span class="help-icon" id="opexHelp" data-help="Shows where your money goes each month. Compare team sizes and costs across Sales, Engineering, G&amp;A, and Ops."></span>
        </div>

        <div class="module-card">
          <div class="card-title" style="margin-bottom: 16px;">
            Headcount by Function
            <span class="tt-icon" data-tt="Number of employees per team per month. Watching headcount growth helps you see whether hiring is front-loaded or spread over time.">?</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="headcountChart" class="chart-canvas"></canvas>
            <div id="headcountTooltip" class="chart-tooltip"></div>
          </div>
          <!-- Headcount So-What Box -->
          <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px;">
            <div id="hc-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">Largest Function</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="hc-top-fn" style="font-size:26px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">â€”</span>
                  <span id="hc-top-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; background:rgba(15,118,110,0.12); color:#0f766e; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Total Headcount (Dec)</div>
                <div id="hc-total" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>
            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">ğŸ“– WHAT YOU'RE LOOKING AT</div>
            <div id="hc-verdict" style="padding:12px 16px; border-radius:10px; border-left:3px solid #0f766e; font-size:13px; line-height:1.6; margin-bottom:10px; background:rgba(15,118,110,0.04);"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              Each bar shows headcount <strong>stacked by function</strong> over 12 months. A steep upward slope = aggressive hiring. A flat line = stable headcount â€” watch whether demand keeps rising despite no new hires, because utilization will climb with it.
            </div>
          </div>
        </div><!-- /headcount card -->

        <div class="module-card">
          <div class="card-title" style="margin-bottom: 16px;">
            Opex by Function
            <span class="tt-icon" data-tt="Operating expenditure (Opex): the monthly cash cost of running each team, including salaries, benefits, taxes, bonuses, and one-time hiring costs.">?</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="opexChart" class="chart-canvas"></canvas>
            <div id="opexTooltip" class="chart-tooltip"></div>
          </div>
          <!-- Opex So-What Box -->
          <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px;">
            <div id="opex-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">Highest-Cost Function</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="opex-top-fn" style="font-size:26px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">â€”</span>
                  <span id="opex-top-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; background:rgba(15,118,110,0.12); color:#0f766e; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Total Monthly Opex (Dec)</div>
                <div id="opex-total" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>
            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">ğŸ“– WHAT YOU'RE LOOKING AT</div>
            <div id="opex-verdict" style="padding:12px 16px; border-radius:10px; border-left:3px solid #0f766e; font-size:13px; line-height:1.6; margin-bottom:10px; background:rgba(15,118,110,0.04);"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              Each bar is <strong>fully loaded monthly cost</strong> stacked by function â€” salary, benefits, payroll tax, bonus, and one-time hiring costs. Month spikes = new hires (equipment + recruiting + onboarding hit in one shot). A growing total bar means your cost base is expanding â€” verify revenue growth is keeping pace.
            </div>
          </div>
        </div><!-- /opex card -->
      </section>

      <!-- â•â• FULLY LOADED COSTS â•â• -->
      <section class="module-section">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <h2 class="module-section-title" style="margin: 0;">Fully Loaded Cost Structure</h2>
          <span class="help-icon" id="fullyLoadedCostHelp" data-help="The real cost of an employee isn't just salary. This breaks down benefits, taxes, bonuses, and one-time costs so you know what hiring truly costs."></span>
        </div>
        <div id="fullyLoadedCosts"></div>
      </section>

      <!-- â•â• CAPACITY &amp; UTILIZATION â•â• -->
      <section class="module-section">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <h2 class="module-section-title" style="margin: 0;">Capacity &amp; Utilization</h2>
          <span class="help-icon" id="utilizationHelp" data-help="Shows if your team is underwater (too much work) or underutilized (paying for idle capacity). Critical for timing your next hire."></span>
        </div>

        <div class="module-card">
          <div class="card-title" style="margin-bottom: 16px;">
            Utilization by Function
            <span class="tt-icon" data-tt="Utilization = Demand Ã· Capacity. Shows what percent of team capacity is consumed. Above 85% signals overload; below 70% suggests overcapacity.">?</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="utilizationChart" class="chart-canvas"></canvas>
            <div id="utilizationTooltip" class="chart-tooltip"></div>
          </div>
          <!-- Utilization So-What Box -->
          <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px;">
            <div id="util-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">Highest Utilization</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="util-top-fn" style="font-size:26px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">â€”</span>
                  <span id="util-top-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Avg Utilization (Dec)</div>
                <div id="util-avg" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>
            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">ğŸ“– WHAT YOU'RE LOOKING AT</div>
            <div id="util-verdict" style="padding:12px 16px; border-radius:10px; border-left:3px solid #0f766e; font-size:13px; line-height:1.6; margin-bottom:10px; background:rgba(15,118,110,0.04);"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              Each line tracks <strong>utilization % over 12 months</strong> per function (Demand Ã· Capacity). The dashed red line is the overload threshold â€” above this, a hire is justified. The orange line is the caution zone. Lines trending upward mean demand is outgrowing capacity and the hiring window is narrowing.
            </div>
          </div>
        </div><!-- /utilization card -->

        <div class="module-card">
          <div class="card-title" style="margin-bottom: 16px;">Current Capacity Status</div>
          <table id="capacityTable" class="data-table"></table>
        </div>
      </section>

      <!-- â•â• HIRING TRIGGERS â•â• -->
      <section class="module-section">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <h2 class="module-section-title" style="margin: 0;">Hiring Justification Logic</h2>
          <span class="help-icon" id="hiringTriggersHelp" data-help="Takes the guesswork out of hiring decisions. Shows when to hire (team is overloaded) vs. delay (cash is tight). Data-driven, not gut feel."></span>
        </div>
        <div id="hiringTriggers"></div>
      </section>

      <!-- â•â• HIRING STRATEGY COMPARISON â•â• -->
      <section class="module-section">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
          <h2 class="module-section-title" style="margin: 0;">Hiring Strategy Comparison</h2>
          <span class="help-icon" id="runwayHelp" data-help="Hire fast = solve bottlenecks but burn cash faster. Hire slow = preserve runway but risk team burnout. This shows the tradeoff explicitly."></span>
        </div>

        <div class="module-card">
          <div class="card-title" style="margin-bottom: 16px;">
            Runway Impact
            <span class="tt-icon" data-tt="Runway = months of cash remaining at the current burn rate. Conservative hiring preserves runway; aggressive hiring shortens it. Both trajectories shown.">?</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="runwayChart" class="chart-canvas"></canvas>
            <div id="runwayTooltip" class="chart-tooltip"></div>
          </div>

          <!-- So What: Runway Impact -->
          <div style="margin:16px 0 8px;padding:18px 20px;border:1.5px solid rgba(15,118,110,0.25);border-radius:14px;background:#f0fdf9;box-shadow:0 2px 8px rgba(15,118,110,0.06);">
            <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.07em;color:#0f766e;margin-bottom:8px;">ğŸ’¡ So What â€” Runway Impact</div>
            <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:6px;">
              <li style="font-size:13px;color:#5d6b7a;display:flex;align-items:flex-start;gap:8px;"><span style="color:#0f766e;font-weight:700;flex-shrink:0;">â€º</span>Every hire shortens runway. This chart shows exactly how many months you trade away under each hiring strategy â€” making the hire/delay tradeoff explicit and board-ready.</li>
              <li style="font-size:13px;color:#5d6b7a;display:flex;align-items:flex-start;gap:8px;"><span style="color:#0f766e;font-weight:700;flex-shrink:0;">â€º</span>Conservative hiring preserves 3â€“6 additional months of runway vs aggressive â€” enough time to close a funding round or reach a revenue milestone that reduces cash dependence.</li>
              <li style="font-size:13px;color:#5d6b7a;display:flex;align-items:flex-start;gap:8px;"><span style="color:#0f766e;font-weight:700;flex-shrink:0;">â€º</span><strong style="color:#0b1220;">If runway gap between strategies exceeds 4 months:</strong> Default to conservative hiring plan and flag aggressive scenario as requiring a capital raise or revenue acceleration commitment.</li>
              <li style="font-size:13px;color:#5d6b7a;display:flex;align-items:flex-start;gap:8px;"><span style="color:#0f766e;font-weight:700;flex-shrink:0;">â€º</span><strong style="color:#0b1220;">If runway &lt; 12 months on either path:</strong> Pause all non-critical hires, model cash-neutral staffing (backfill only), and present funding options to the board within 30 days.</li>
            </ul>
          </div>
        </div>

        <div id="strategyComparison"></div>

        <!-- Hiring Plan Table (NEW â€” deterministic) -->
        <div class="module-card" style="margin-top: 20px;">
          <div class="card-header">
            <div>
              <div class="card-title">
                12-Month Hiring Plan
                <span class="tt-icon" data-tt="Deterministic month-by-month plan. Conservative delays hires until utilization â‰¥85% AND runway â‰¥15 mo. Aggressive hires when utilization â‰¥85% and runway â‰¥12 mo. Includes recruiting/onboarding cost and 3-month ramp.">?</span>
              </div>
              <div style="font-size: 12px; color: var(--muted); margin-top: 4px;">Derived from utilization and runway thresholds â€” no randomness</div>
            </div>
          </div>
          <div class="plan-tabs">
            <button class="plan-tab active" id="planTabCon" onclick="showPlanTab('conservative')">Conservative</button>
            <button class="plan-tab" id="planTabAgg" onclick="showPlanTab('aggressive')">Aggressive</button>
          </div>
          <div id="hiringPlanTable"></div>
        </div>
      </section>


    </main>
  </div>

  <!-- â”€â”€ Next Module â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <nav class="next-module-bar" aria-label="Next recommended module">
    <div>
      <div class="next-module-label">Next recommended</div>
      <div class="next-module-title">Capex &amp; Financing Decisions</div>
      <div class="next-module-why">Headcount costs are sized â€” now model the next big asset or equipment decision.</div>
    </div>
    <div class="next-module-actions">
      <a class="btn btn-solid" href="capex-financing.html">Open Capex &amp; Financing â†’</a>
      <a class="btn btn-ghost" href="index.html">â† Back to Portfolio</a>
    </div>
  </nav>

  <script src="./main.js"></script>
  <script>
    // ========== PROFESSIONAL MONOCHROME PALETTE ==========
    const COLORS = {
      functions: ['#111827', '#374151', '#6B7280', '#9CA3AF'],
      accent: '#0F766E',
      warning: '#dc2626',
      caution: '#d97706',
      success: '#059669',
      muted: '#5d6b7a'
    };

    // ========== LIVE ASSUMPTIONS (single source of truth) ==========
    // All model thresholds read from here; inputs write here; renderAll() re-reads.
    let ASSUMP = {
      utilYellow:      70,   // % â€” caution starts
      utilRed:         85,   // % â€” overloaded starts
      runwayCritical:  6,    // months â€” cut burn
      runwayCaution:   12,   // months â€” RAISE zone
      runwaySafeHire:  12,   // months â€” aggressive threshold
      runwaySafeCon:   15,   // months â€” conservative threshold
      rampMonths:      3,    // months to full productivity
      oneTimeCost:     16000,// $ per hire (recruiting + onboarding)
      compInflation:   6,    // % per year comp inflation
      scenarUpside:    1.15, // multiplier for upside scenario
      scenarDownside:  0.85, // multiplier for downside scenario
      scenarUtilShift: 10    // percentage-point demand shift for upside/downside
    };

    function readAssumptions() {
      function safeInput(id, min, max, fallback) {
        const el = document.getElementById(id);
        if (!el) return fallback;
        const v = parseFloat(el.value);
        if (!isFinite(v) || isNaN(v) || v < min || v > max) {
          el.classList.add('invalid');
          return null; // invalid â†’ caller should use existing value
        }
        el.classList.remove('invalid');
        return v;
      }
      const d = ASSUMP_DEFAULTS || {};
      const updates = {
        utilYellow:      safeInput('aUtilYellow',      1,    100,  d.utilYellow      || 70),
        utilRed:         safeInput('aUtilRed',          1,    100,  d.utilRed         || 85),
        runwayCritical:  safeInput('aRunwayCritical',   0,    60,   d.runwayCritical  || 6),
        runwayCaution:   safeInput('aRunwayCaution',    0,    60,   d.runwayCaution   || 12),
        runwaySafeHire:  safeInput('aRunwaySafeHire',   0,    60,   d.runwaySafeHire  || 12),
        runwaySafeCon:   safeInput('aRunwaySafeCon',    0,    60,   d.runwaySafeCon   || 15),
        rampMonths:      safeInput('aRampMonths',       1,    12,   d.rampMonths      || 3),
        oneTimeCost:     safeInput('aOneTimeCost',      0,    500000, d.oneTimeCost   || 16000),
        compInflation:   safeInput('aCompInflation',    0,    50,   d.compInflation   || 6),
        scenarUpside:    safeInput('aScenarUpside',     0.5,  5,    d.scenarUpside    || 1.15),
        scenarDownside:  safeInput('aScenarDownside',   0.1,  1,    d.scenarDownside  || 0.85),
        scenarUtilShift: safeInput('aScenarUtilShift',  0,    40,   d.scenarUtilShift || 10)
      };
      // Only update ASSUMP where values are valid (null = keep existing)
      Object.keys(updates).forEach(k => { if (updates[k] !== null) ASSUMP[k] = updates[k]; });
    }

    function onAssumpChange() {
      readAssumptions();
      if (baseDataset) {
        activeDataset = applyScenario(baseDataset, scenario);
        renderAll();
      }
    }

    // ========== FIXED SAMPLE DATASET ==========
    const SAMPLE_DATA = {
      months: [
        {
          month: 'Jan',
          functions: [
            { name: 'Sales', headcount: 12, costs: { salary: 102000, benefits: 18360, taxes: 8160, bonus: 13260, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Deals/month', capacity: 52, demand: 39 } },
            { name: 'Engineering', headcount: 28, costs: { salary: 280000, benefits: 50400, taxes: 22400, bonus: 36400, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Story Points/month', capacity: 326, demand: 261 } },
            { name: 'G&A', headcount: 18, costs: { salary: 112500, benefits: 20250, taxes: 9000, bonus: 14625, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 18, demand: 14 } },
            { name: 'Ops', headcount: 15, costs: { salary: 81250, benefits: 14625, taxes: 6500, bonus: 10563, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 662, demand: 477 } }
          ]
        },
        {
          month: 'Feb',
          functions: [
            { name: 'Sales', headcount: 12, costs: { salary: 102000, benefits: 18360, taxes: 8160, bonus: 13260, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Deals/month', capacity: 53, demand: 41 } },
            { name: 'Engineering', headcount: 29, costs: { salary: 290000, benefits: 52200, taxes: 23200, bonus: 37700, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 338, demand: 270 } },
            { name: 'G&A', headcount: 18, costs: { salary: 112500, benefits: 20250, taxes: 9000, bonus: 14625, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 18, demand: 14 } },
            { name: 'Ops', headcount: 15, costs: { salary: 81250, benefits: 14625, taxes: 6500, bonus: 10563, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Tickets/month', capacity: 665, demand: 485 } }
          ]
        },
        {
          month: 'Mar',
          functions: [
            { name: 'Sales', headcount: 13, costs: { salary: 110500, benefits: 19890, taxes: 8840, bonus: 14365, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Deals/month', capacity: 56, demand: 44 } },
            { name: 'Engineering', headcount: 29, costs: { salary: 290000, benefits: 52200, taxes: 23200, bonus: 37700, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Story Points/month', capacity: 342, demand: 280 } },
            { name: 'G&A', headcount: 18, costs: { salary: 112500, benefits: 20250, taxes: 9000, bonus: 14625, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 18, demand: 14 } },
            { name: 'Ops', headcount: 16, costs: { salary: 86667, benefits: 15600, taxes: 6933, bonus: 11267, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Tickets/month', capacity: 698, demand: 510 } }
          ]
        },
        {
          month: 'Apr',
          functions: [
            { name: 'Sales', headcount: 13, costs: { salary: 110500, benefits: 19890, taxes: 8840, bonus: 14365, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Deals/month', capacity: 57, demand: 46 } },
            { name: 'Engineering', headcount: 30, costs: { salary: 300000, benefits: 54000, taxes: 24000, bonus: 39000, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 354, demand: 292 } },
            { name: 'G&A', headcount: 19, costs: { salary: 118750, benefits: 21375, taxes: 9500, bonus: 15438, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'FTE Available', capacity: 19, demand: 14 } },
            { name: 'Ops', headcount: 16, costs: { salary: 86667, benefits: 15600, taxes: 6933, bonus: 11267, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 704, demand: 525 } }
          ]
        },
        {
          month: 'May',
          functions: [
            { name: 'Sales', headcount: 14, costs: { salary: 119000, benefits: 21420, taxes: 9520, bonus: 15470, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Deals/month', capacity: 60, demand: 49 } },
            { name: 'Engineering', headcount: 31, costs: { salary: 310000, benefits: 55800, taxes: 24800, bonus: 40300, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 366, demand: 305 } },
            { name: 'G&A', headcount: 19, costs: { salary: 118750, benefits: 21375, taxes: 9500, bonus: 15438, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 19, demand: 14 } },
            { name: 'Ops', headcount: 16, costs: { salary: 86667, benefits: 15600, taxes: 6933, bonus: 11267, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 710, demand: 540 } }
          ]
        },
        {
          month: 'Jun',
          functions: [
            { name: 'Sales', headcount: 14, costs: { salary: 119000, benefits: 21420, taxes: 9520, bonus: 15470, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Deals/month', capacity: 62, demand: 52 } },
            { name: 'Engineering', headcount: 32, costs: { salary: 320000, benefits: 57600, taxes: 25600, bonus: 41600, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 378, demand: 320 } },
            { name: 'G&A', headcount: 19, costs: { salary: 118750, benefits: 21375, taxes: 9500, bonus: 15438, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 19, demand: 14 } },
            { name: 'Ops', headcount: 17, costs: { salary: 92083, benefits: 16575, taxes: 7367, bonus: 11971, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Tickets/month', capacity: 743, demand: 570 } }
          ]
        },
        {
          month: 'Jul',
          functions: [
            { name: 'Sales', headcount: 15, costs: { salary: 127500, benefits: 22950, taxes: 10200, bonus: 16575, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Deals/month', capacity: 65, demand: 55 } },
            { name: 'Engineering', headcount: 33, costs: { salary: 330000, benefits: 59400, taxes: 26400, bonus: 42900, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 390, demand: 336 } },
            { name: 'G&A', headcount: 20, costs: { salary: 125000, benefits: 22500, taxes: 10000, bonus: 16250, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'FTE Available', capacity: 20, demand: 15 } },
            { name: 'Ops', headcount: 17, costs: { salary: 92083, benefits: 16575, taxes: 7367, bonus: 11971, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 750, demand: 590 } }
          ]
        },
        {
          month: 'Aug',
          functions: [
            { name: 'Sales', headcount: 15, costs: { salary: 127500, benefits: 22950, taxes: 10200, bonus: 16575, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Deals/month', capacity: 66, demand: 58 } },
            { name: 'Engineering', headcount: 34, costs: { salary: 340000, benefits: 61200, taxes: 27200, bonus: 44200, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 402, demand: 352 } },
            { name: 'G&A', headcount: 20, costs: { salary: 125000, benefits: 22500, taxes: 10000, bonus: 16250, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 20, demand: 15 } },
            { name: 'Ops', headcount: 18, costs: { salary: 97500, benefits: 17550, taxes: 7800, bonus: 12675, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Tickets/month', capacity: 783, demand: 620 } }
          ]
        },
        {
          month: 'Sep',
          functions: [
            { name: 'Sales', headcount: 16, costs: { salary: 136000, benefits: 24480, taxes: 10880, bonus: 17680, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Deals/month', capacity: 69, demand: 61 } },
            { name: 'Engineering', headcount: 35, costs: { salary: 350000, benefits: 63000, taxes: 28000, bonus: 45500, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 414, demand: 368 } },
            { name: 'G&A', headcount: 20, costs: { salary: 125000, benefits: 22500, taxes: 10000, bonus: 16250, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 20, demand: 15 } },
            { name: 'Ops', headcount: 18, costs: { salary: 97500, benefits: 17550, taxes: 7800, bonus: 12675, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 790, demand: 645 } }
          ]
        },
        {
          month: 'Oct',
          functions: [
            { name: 'Sales', headcount: 16, costs: { salary: 136000, benefits: 24480, taxes: 10880, bonus: 17680, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Deals/month', capacity: 70, demand: 64 } },
            { name: 'Engineering', headcount: 36, costs: { salary: 360000, benefits: 64800, taxes: 28800, bonus: 46800, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 426, demand: 383 } },
            { name: 'G&A', headcount: 21, costs: { salary: 131250, benefits: 23625, taxes: 10500, bonus: 17063, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'FTE Available', capacity: 21, demand: 15 } },
            { name: 'Ops', headcount: 18, costs: { salary: 97500, benefits: 17550, taxes: 7800, bonus: 12675, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 796, demand: 665 } }
          ]
        },
        {
          month: 'Nov',
          functions: [
            { name: 'Sales', headcount: 17, costs: { salary: 144500, benefits: 26010, taxes: 11560, bonus: 18785, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Deals/month', capacity: 73, demand: 67 } },
            { name: 'Engineering', headcount: 37, costs: { salary: 370000, benefits: 66600, taxes: 29600, bonus: 48100, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 438, demand: 398 } },
            { name: 'G&A', headcount: 21, costs: { salary: 131250, benefits: 23625, taxes: 10500, bonus: 17063, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 21, demand: 15 } },
            { name: 'Ops', headcount: 19, costs: { salary: 102917, benefits: 18525, taxes: 8233, bonus: 13379, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Tickets/month', capacity: 829, demand: 690 } }
          ]
        },
        {
          month: 'Dec',
          functions: [
            { name: 'Sales', headcount: 17, costs: { salary: 144500, benefits: 26010, taxes: 11560, bonus: 18785, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Deals/month', capacity: 74, demand: 71 } },
            { name: 'Engineering', headcount: 38, costs: { salary: 380000, benefits: 68400, taxes: 30400, bonus: 49400, equipment: 3500, recruiting: 8000, onboarding: 4500 }, capacity: { metric: 'Story Points/month', capacity: 450, demand: 415 } },
            { name: 'G&A', headcount: 21, costs: { salary: 131250, benefits: 23625, taxes: 10500, bonus: 17063, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'FTE Available', capacity: 21, demand: 16 } },
            { name: 'Ops', headcount: 19, costs: { salary: 102917, benefits: 18525, taxes: 8233, bonus: 13379, equipment: 0, recruiting: 0, onboarding: 0 }, capacity: { metric: 'Tickets/month', capacity: 835, demand: 710 } }
          ]
        }
      ],
      runway: { cash: 2400000, burn: 185000 }
    };

    // ========== STATE MANAGEMENT ==========
    let dataMode = 'sample';
    let scenario = 'base';
    let baseDataset = null;
    let activeDataset = null;
    let activePlanTab = 'conservative';

    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const FUNCTIONS = ['Sales','Engineering','G&A','Ops'];

    let headcountChartPoints = [];
    let opexChartPoints = [];
    let utilizationChartPoints = [];
    let runwayChartPoints = [];

    // ========== GLOSSARY (single source of truth for all finance term tooltips) ==========
    // Each entry: [shortLabel, fullDefinition (â‰¤220 chars)]
    const GLOSSARY = {
      'Runway':          'Months of cash left at the current burn rate. Under 6 months = critical. Tells you when to start fundraising or cut costs.',
      'Burn Rate':       'How much cash you spend each month. Higher burn = shorter runway. Used to calculate runway and model hiring decisions.',
      'Utilization':     'How much of your team\'s capacity is actually being used. Above 85% = overloaded (hire soon). Below 70% = paying for idle capacity.',
      'Headcount':       'Total number of employees. Drives costs, capacity, and burn rate. Key input to every financial forecast.',
      'Opex':            'Operating Expenditure: the recurring cash cost of running the business â€” salaries, benefits, taxes, bonuses. Excludes one-time costs.',
      'Fully Loaded Cost': 'The true cost of an employee beyond base salary. Includes benefits, payroll taxes, bonus accrual, equipment, and recruiting costs.',
      'Run Rate':        'Annualized view of a current monthly figure. E.g., $200K/month run rate = $2.4M/year. Used for forecasting and investor reporting.',
      'One-Time Costs':  'Upfront costs per new hire: equipment, recruiter fees, onboarding. Not recurring â€” but spike cash burn in the month incurred.',
      'Capacity':        'Maximum output your team can produce in a period, accounting for productivity ramp of new hires (25% â†’ 60% â†’ 100% over 3 months).',
      'Demand':          'Actual workload flowing into a team. When demand consistently exceeds capacity, it signals a hiring need.',
      'Backlog':         'Work piling up because demand exceeds capacity. A growing backlog risks customer SLA misses, churn, and revenue loss.',
      'Backlog %':       'Backlog as a percentage of total capacity. Above 20% = serious delivery risk. Customers and leadership will notice.',
      'Conservative':    'Hiring strategy that prioritizes cash preservation. Hires 1 person only when utilization â‰¥ 85% AND runway â‰¥ 15 months.',
      'Aggressive':      'Hiring strategy that prioritizes team capacity. Hires 2 people when utilization â‰¥ 85% AND runway â‰¥ 12 months.',
      'Delta':           'The difference between Conservative and Aggressive scenarios. Shows the direct financial cost of moving faster.',
      'Monthly Run Rate':'Recurring monthly spend excluding one-time costs. The baseline burn used for runway calculations.',
      'Annual/Head':     'Monthly cost per employee Ã— 12. Used for headcount budget submissions and board-level compensation benchmarking.',
      'Monthly/Head':    'Fully loaded monthly cost per employee. Includes salary, benefits, payroll tax, and bonus accrual.',
      'Story Points':    'Engineering output unit. Measures completed work items, weighted by complexity. Used to track engineering team capacity.',
      'FTE Available':   'Full-Time Equivalent capacity in G&A. Tracks how many operational support hours are available vs. allocated.',
      'Proj. Util':      'Projected utilization in a future month, accounting for demand growth and the ramp-up of planned new hires.',
      'Proj. Runway':    'Projected months of cash remaining, after deducting one-time hiring costs from the current cash balance.',
      'Ramp':            'New hire productivity ramp: 25% capacity in Month 1, 60% in Month 2, 100% from Month 3. Reflects real-world onboarding time.',
      'Confidence':      'How strongly the data supports the recommendation. HIGH = both signals clearly align. MED = signals are mixed. LOW = data near threshold.',
      'HIRE':            'Both utilization and runway support adding headcount now. Team is overloaded AND cash position is healthy. Act now before bottlenecks compound.',
      'DON\'T HIRE':     'Either cash is too tight or the team is underutilized. Hiring now would burn capital without solving a real capacity problem.',
      'SLOW GROWTH':     'Runway is comfortable but team isn\'t fully loaded. Hire selectively in bottlenecked functions only. Hold in underutilized areas.',
      'CUT BURN':        'Runway is under 6 months. Immediate priority: reduce monthly spend, delay hiring, and/or accelerate path to revenue.',
      'RAISE':           'Team is overloaded but runway is too short to hire safely. Raise capital first, then build headcount after closing the round.',
      'Implied Raise':   'Estimated fundraise size needed to extend runway to target. Calculated as: monthly burn Ã— (target runway âˆ’ current runway).',
      'Target Runway':   'The desired months of runway post-fundraise. 18 months is the standard â€” gives 6 months to deploy capital plus buffer before next raise.',
      'Comp Inflation':  'Annual % increase applied to recurring payroll costs (salary, benefits, taxes, bonus). Models merit raises and market comp drift. Applied monthly (rateÃ·12) to each data period.',
      'Hiring Lead Time':'Months between approving a hire and the new employee\'s start date. Delays capacity relief and shifts when one-time costs hit cash.',
    };

    /**
     * gl(term) â€” wraps a finance term in a tooltip span using the GLOSSARY.
     * Falls back to plain text if term isn't in the glossary.
     */
    function gl(term, displayText) {
      const label = displayText || term;
      const def = GLOSSARY[term];
      if (!def) return label;
      // Escape the definition for use in a data attribute
      const safe = def.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
      return `<span class="gl-term" data-tt="${safe}">${label}</span>`;
    }

    // ========== SAFE NUMBER HELPERS ==========

    function safeNum(val, fallback = 0) {
      if (val === null || val === undefined) return fallback;
      const n = Number(val);
      return (isFinite(n) && !isNaN(n)) ? n : fallback;
    }

    function fmtSafe(val, decimals = 1) {
      const n = safeNum(val);
      return isFinite(n) ? n.toFixed(decimals) : 'â€”';
    }

    // ========== DATA FUNCTIONS ==========

    function deepCopy(obj) { return JSON.parse(JSON.stringify(obj)); }

    function loadSampleData() { return deepCopy(SAMPLE_DATA); }

    function generateRandomData() {
      const data = {
        months: [],
        runway: {
          cash: 1600000 + Math.random() * 1400000,
          burn: 140000 + Math.random() * 90000
        }
      };

      MONTHS.forEach((month, mi) => {
        const monthData = { month, functions: [] };
        FUNCTIONS.forEach((func) => {
          const baseHC = Math.floor(10 + Math.random() * 25);
          const hireRate = (0.2 + Math.random() * 0.5);
          const growth = Math.floor(mi * hireRate);
          const headcount = baseHC + growth;

          const baseSalary = 55000 + Math.random() * 85000;
          const salaryMonth = (baseSalary / 12) * headcount;
          const benefits = salaryMonth * (0.16 + Math.random() * 0.08);
          const taxes = salaryMonth * (0.07 + Math.random() * 0.02);
          const bonus = salaryMonth * (0.11 + Math.random() * 0.08);
          const newHires = mi === 0 ? 0 : Math.floor(hireRate * (0.9 + Math.random() * 0.2));
          const equipment = newHires * (2000 + Math.random() * 3500);
          const recruiting = newHires * (5000 + Math.random() * 11000);
          const onboarding = newHires * (3000 + Math.random() * 6000);

          let capacityMetric, capacity, demand;
          if (func === 'Sales') {
            capacityMetric = 'Deals/month';
            capacity = Math.round(headcount * (3.5 + Math.random() * 2.5));
            demand = Math.round(capacity * (0.70 + mi * 0.018 + Math.random() * 0.12));
          } else if (func === 'Engineering') {
            capacityMetric = 'Story Points/month';
            capacity = Math.round(headcount * (10 + Math.random() * 5));
            demand = Math.round(capacity * (0.75 + mi * 0.012 + Math.random() * 0.10));
          } else if (func === 'Ops') {
            capacityMetric = 'Tickets/month';
            capacity = Math.round(headcount * (38 + Math.random() * 16));
            demand = Math.round(capacity * (0.68 + mi * 0.008 + Math.random() * 0.14));
          } else {
            capacityMetric = 'FTE Available';
            capacity = Math.round(headcount);
            demand = Math.round(capacity * (0.73 + Math.random() * 0.08));
          }

          monthData.functions.push({
            name: func, headcount,
            costs: { salary: salaryMonth, benefits, taxes, bonus, equipment, recruiting, onboarding },
            capacity: { metric: capacityMetric, capacity, demand }
          });
        });
        data.months.push(monthData);
      });
      return data;
    }

    function applyScenario(baseData, scenarioName) {
      const mult = scenarioName === 'upside' ? ASSUMP.scenarUpside : scenarioName === 'downside' ? ASSUMP.scenarDownside : 1.0;
      const utilBoost = scenarioName === 'upside' ? ASSUMP.scenarUtilShift / 100 : scenarioName === 'downside' ? -(ASSUMP.scenarUtilShift / 100) : 0;
      const scenarioData = deepCopy(baseData);
      // Apply comp inflation: annualRate/12 per month index
      const monthlyInflation = ASSUMP.compInflation / 100 / 12;
      scenarioData.months.forEach((month, mi) => {
        const inflFactor = Math.pow(1 + monthlyInflation, mi);
        month.functions.forEach(func => {
          func.headcount = Math.round(func.headcount * mult);
          const costKeys = ['salary','benefits','taxes','bonus','equipment','recruiting','onboarding'];
          costKeys.forEach(key => {
            if (func.costs[key]) {
              // Apply scenario mult, then inflation only to recurring (not one-time)
              const isOneTime = key === 'equipment' || key === 'recruiting' || key === 'onboarding';
              func.costs[key] = Math.round(func.costs[key] * mult * (isOneTime ? 1 : inflFactor));
            }
          });
          func.capacity.capacity = Math.round(func.capacity.capacity * mult);
          func.capacity.demand = Math.round(func.capacity.demand * (1 + utilBoost));
        });
      });
      return scenarioData;
    }

    // ========== MULTI-FACTOR DECISION ENGINE ==========


  // â”€â”€ Standardized Decision Box helper â”€â”€
  function setDecisionBox(state, verdict, verdictAction, bullets, next) {
    var box = document.getElementById('decisionBox');
    if (!box) return;
    box.classList.remove('decision-box--positive','decision-box--warning','decision-box--negative');
    box.classList.add('decision-box--' + state);
    document.getElementById('decisionVerdict').innerHTML =
      verdict + ' <span class="verdict-action">' + verdictAction + '</span>';
    document.getElementById('decisionBullets').innerHTML =
      bullets.map(function(b){ return '<li>' + b + '</li>'; }).join('');
    document.getElementById('decisionNext').innerHTML =
      'Top driver: <span>' + next + '</span>';
  }

    function computeDecision(avgUtil, runway) {
      const u = safeNum(avgUtil);
      const r = safeNum(runway);
      const rCrit   = ASSUMP.runwayCritical;
      const rCaution= ASSUMP.runwayCaution;
      const uRed    = ASSUMP.utilRed;
      const uYellow = ASSUMP.utilYellow;

      // Near-threshold LOW confidence detection
      const runwayNear = Math.abs(r - rCrit) <= 1 || Math.abs(r - rCaution) <= 1;
      const utilNear   = Math.abs(u - uRed) <= 2 || Math.abs(u - uYellow) <= 2;
      const near = runwayNear || utilNear;

      let decision, cssClass, confidence, ruleText;

      if (r < rCrit) {
        decision = 'CUT BURN';  cssClass = 'bd-cut';
        confidence = near ? 'LOW' : 'HIGH';
        ruleText = `Rule: Runway < ${rCrit} mo â†’ CUT BURN`;
      } else if (r < rCaution && u >= uRed) {
        decision = 'RAISE';     cssClass = 'bd-raise';
        confidence = near ? 'LOW' : 'MED';
        ruleText = `Rule: Runway ${rCrit}â€“${rCaution} mo AND Util â‰¥ ${uRed}% â†’ RAISE`;
      } else if (r >= rCaution && u >= uRed) {
        decision = 'HIRE';      cssClass = 'bd-hire';
        confidence = near ? 'LOW' : 'HIGH';
        ruleText = `Rule: Runway â‰¥ ${rCaution} mo AND Util â‰¥ ${uRed}% â†’ HIRE`;
      } else if (r >= rCaution && u >= uYellow && u < uRed) {
        decision = 'SLOW GROWTH'; cssClass = 'bd-slow';
        confidence = near ? 'LOW' : 'MED';
        ruleText = `Rule: Runway â‰¥ ${rCaution} mo AND Util ${uYellow}â€“${uRed}% â†’ SLOW GROWTH`;
      } else if (u < uYellow && r < rCaution) {
        decision = 'DON\'T HIRE'; cssClass = 'bd-nohire';
        confidence = near ? 'LOW' : 'HIGH';
        ruleText = `Rule: Util < ${uYellow}% AND Runway < ${rCaution} mo â†’ DON'T HIRE`;
      } else {
        decision = 'DON\'T HIRE'; cssClass = 'bd-nohire';
        confidence = near ? 'LOW' : 'MED';
        ruleText = `Rule: Util < ${uRed}% OR Runway insufficient â†’ DON'T HIRE`;
      }

      // Capacity signal
      const capSig = u >= uRed ? { label: 'Capacity: Overloaded', cls: 'sig-red' }
                   : u >= uYellow ? { label: 'Capacity: Healthy', cls: 'sig-yellow' }
                   :                { label: 'Capacity: Underutilized', cls: 'sig-green' };

      // Cash signal
      const cashSig = r < rCrit    ? { label: 'Runway: Critical', cls: 'sig-red' }
                   : r < rCaution  ? { label: 'Runway: Caution', cls: 'sig-yellow' }
                   :                  { label: 'Runway: Safe', cls: 'sig-green' };

      // Build rationale bullets
      const bullets = [];
      bullets.push(`Avg utilization ${fmtSafe(u)}% â€” ${u >= uRed ? 'team is at or beyond sustainable capacity' : u >= uYellow ? 'healthy loading, monitor trend' : 'below target, overcapacity risk'}.`);
      bullets.push(`Runway ${fmtSafe(r)} months â€” ${r < rCrit ? `critical: less than ${rCrit} months of cash remaining` : r < rCaution ? `caution: ${rCrit}â€“${rCaution} month window, fundraise or cut costs` : `comfortable: >${rCaution} months of operating capital`}.`);
      if (decision === 'RAISE') bullets.push('Team is maxed but cash is tight â€” raise capital before headcount, then hire.');
      if (decision === 'CUT BURN') bullets.push('Immediate priority: reduce monthly spend or accelerate revenue before any new hires.');
      if (decision === 'SLOW GROWTH') bullets.push('Hire selectively in overloaded functions only; hold headcount in underutilized areas.');

      return { decision, cssClass, confidence, capSig, cashSig, bullets, ruleText,
               vals: { u, r, uRed, uYellow, rCrit, rCaution } };
    }

    // ========== DETERMINISTIC HIRING PLAN ==========

    function computeHiringPlan(avgUtil, runway, strategy) {
      // Uses ASSUMP for all thresholds
      const utilThreshold   = ASSUMP.utilRed;
      const runwayThreshold = strategy === 'aggressive' ? ASSUMP.runwaySafeHire : ASSUMP.runwaySafeCon;
      const rampMo          = Math.max(1, Math.round(ASSUMP.rampMonths));
      const costPerHire     = ASSUMP.oneTimeCost;

      // Ramp curve: interpolate based on rampMonths
      // Always starts at 25%, ends at 100%, midpoints fill proportionally
      function getRampCurve(months) {
        if (months <= 1) return [1.0];
        if (months === 2) return [0.25, 1.0];
        if (months === 3) return [0.25, 0.60, 1.0];
        // >3 months: linear ramp from 25% to 100%
        const curve = [];
        for (let i = 0; i < months; i++) {
          curve.push(+(0.25 + (0.75 * i / (months - 1))).toFixed(2));
        }
        return curve;
      }
      const rampCurve = getRampCurve(rampMo);
      const rampLabel = rampCurve.map(v => Math.round(v * 100) + '%').join('â†’');

      const planMonths = MONTHS.slice(0, 12);
      const rows = [];

      let curUtil = safeNum(avgUtil);
      let curRunway = safeNum(runway);
      const baseBurnPerHead = 8500;

      planMonths.forEach((mon, idx) => {
        const shouldHire = curUtil >= utilThreshold && curRunway >= runwayThreshold;
        const hires = shouldHire ? (strategy === 'aggressive' ? 2 : 1) : 0;
        const oneTimeCost = hires > 0 ? hires * costPerHire : 0;
        const demandGrowth = 0.008;
        curUtil = Math.min(100, curUtil * (1 + demandGrowth));
        // Full ramp kicks in after rampMo months
        if (idx >= rampMo && rows[idx - rampMo] && rows[idx - rampMo].hires > 0) {
          curUtil = Math.max(0, curUtil - (rows[idx - rampMo].hires * (strategy === 'aggressive' ? 4.5 : 3.5)));
        }
        curRunway = Math.max(0, curRunway - (1 + (oneTimeCost / (curRunway > 0 ? baseBurnPerHead * 10 : 1))));

        rows.push({
          month: mon,
          hires,
          oneTimeCost,
          util: curUtil,
          runway: curRunway,
          rampNote: hires > 0 ? `${rampLabel} over ${rampMo} mo` : ''
        });
      });

      return rows;
    }

    // ========== EXPORT FUNCTIONS ==========

    function toggleExport(e) {
      e.stopPropagation();
      const dd = document.getElementById('exportDropdown');
      dd.classList.toggle('open');
      // Close on outside click
      if (dd.classList.contains('open')) {
        setTimeout(() => {
          document.addEventListener('click', closeExportOnce);
        }, 10);
      }
    }
    function closeExportOnce() {
      document.getElementById('exportDropdown').classList.remove('open');
      document.removeEventListener('click', closeExportOnce);
    }

    function showToast(msg) {
      const t = document.getElementById('exportToast');
      if (!t) return;
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2400);
    }

    function csvEscape(v) {
      const s = String(v == null ? '' : v);
      if (s.includes(',') || s.includes('"') || s.includes('\n')) return '"' + s.replace(/"/g, '""') + '"';
      return s;
    }

    function blobDownload(content, filename, mime) {
      const blob = new Blob([content], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }

    function exportHiringPlanCSV() {
      document.getElementById('exportDropdown').classList.remove('open');
      if (!activeDataset) { showToast('No data loaded.'); return; }
      const data = activeDataset;
      const last = data.months[data.months.length - 1];
      const avgUtil = last.functions.reduce((s, f) => s + ((f.capacity.demand / safeNum(f.capacity.capacity, 1)) * 100), 0) / FUNCTIONS.length;
      const runway  = safeNum(data.runway.cash / data.runway.burn);

      const conPlan = computeHiringPlan(avgUtil, runway, 'conservative');
      const aggPlan = computeHiringPlan(avgUtil, runway, 'aggressive');

      const headers = ['Month','Con_Hires','Con_OneTimeCost','Con_Util%','Con_Runway_mo','Agg_Hires','Agg_OneTimeCost','Agg_Util%','Agg_Runway_mo'];
      const rows = conPlan.map((cr, i) => {
        const ar = aggPlan[i];
        return [cr.month, cr.hires, cr.oneTimeCost, cr.util.toFixed(1), cr.runway.toFixed(1), ar.hires, ar.oneTimeCost, ar.util.toFixed(1), ar.runway.toFixed(1)];
      });

      const csv = [headers, ...rows].map(r => r.map(csvEscape).join(',')).join('\n');
      // Metadata footer
      const meta = [
        '',
        `Assumptions used`,
        `Util Red,${ASSUMP.utilRed}%`,
        `Util Yellow,${ASSUMP.utilYellow}%`,
        `Runway Critical,${ASSUMP.runwayCritical} mo`,
        `Runway Caution,${ASSUMP.runwayCaution} mo`,
        `Safe to Hire (Agg),${ASSUMP.runwaySafeHire} mo`,
        `Safe to Hire (Con),${ASSUMP.runwaySafeCon} mo`,
        `Ramp Duration,${ASSUMP.rampMonths} mo`,
        `One-Time Cost/Hire,$${ASSUMP.oneTimeCost}`,
        `Comp Inflation,${ASSUMP.compInflation}%/yr`,
        `Scenario,${scenario}`,
        `Exported,${new Date().toISOString()}`
      ].join('\n');

      blobDownload(csv + '\n' + meta, 'hiring-plan.csv', 'text/csv');
      showToast('âœ“ Hiring Plan exported');
    }

    function exportFunctionCostCSV() {
      document.getElementById('exportDropdown').classList.remove('open');
      if (!activeDataset) { showToast('No data loaded.'); return; }
      const data = activeDataset;
      const headers = ['Month','Function','Headcount','Salary','Benefits','Taxes','Bonus','Equipment','Recruiting','Onboarding','Total_Fully_Loaded','Per_Head_Monthly'];
      const rows = [];
      data.months.forEach(month => {
        month.functions.forEach(func => {
          const c = func.costs;
          const total = c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding;
          const perHead = func.headcount > 0 ? total / func.headcount : 0;
          rows.push([month.month, func.name, func.headcount, c.salary.toFixed(0), c.benefits.toFixed(0), c.taxes.toFixed(0), c.bonus.toFixed(0), c.equipment.toFixed(0), c.recruiting.toFixed(0), c.onboarding.toFixed(0), total.toFixed(0), perHead.toFixed(0)]);
        });
      });
      const meta = [
        '',
        `Comp Inflation Applied,${ASSUMP.compInflation}%/yr`,
        `Scenario,${scenario}`,
        `Exported,${new Date().toISOString()}`
      ].join('\n');
      const csv = [headers, ...rows].map(r => r.map(csvEscape).join(',')).join('\n');
      blobDownload(csv + '\n' + meta, 'function-costs.csv', 'text/csv');
      showToast('âœ“ Function Cost Table exported');
    }

    function copyBoardSummary() {
      document.getElementById('exportDropdown').classList.remove('open');
      if (!activeDataset) { showToast('No data loaded.'); return; }
      const data = activeDataset;
      const last = data.months[data.months.length - 1];
      const totalHC   = last.functions.reduce((s, f) => s + f.headcount, 0);
      const totalCost = last.functions.reduce((s, f) => { const c = f.costs; return s + c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding; }, 0);
      const avgUtil   = last.functions.reduce((s, f) => s + ((f.capacity.demand / safeNum(f.capacity.capacity, 1)) * 100), 0) / FUNCTIONS.length;
      const runway    = safeNum(data.runway.cash / data.runway.burn);
      const dec       = computeDecision(avgUtil, runway);

      const lines = [
        'â•”â•â• INDIRECT COST & HEADCOUNT BOARD SUMMARY â•â•â•—',
        `  Date: ${new Date().toLocaleDateString('en-US', {month:'long', day:'numeric', year:'numeric'})}`,
        `  Scenario: ${scenario.toUpperCase()}`,
        '',
        'â”€â”€ DECISION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
        `  Verdict:    ${dec.decision}`,
        `  Confidence: ${dec.confidence}`,
        `  ${dec.ruleText}`,
        '',
        'â”€â”€ VALUES vs THRESHOLDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
        `  Utilization: ${fmtSafe(avgUtil)}%   (Red â‰¥ ${ASSUMP.utilRed}% Â· Yellow â‰¥ ${ASSUMP.utilYellow}%)`,
        `  Runway:      ${isFinite(runway) ? fmtSafe(runway) + ' mo' : 'â€”'}   (Critical < ${ASSUMP.runwayCritical} Â· Caution < ${ASSUMP.runwayCaution})`,
        '',
        'â”€â”€ KPIs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
        `  Total Headcount:  ${totalHC}  (across ${FUNCTIONS.length} functions)`,
        `  Monthly Opex:     ${formatCurrency(totalCost, 0)}  (fully loaded)`,
        `  Starting Cash:    ${formatCurrency(data.runway.cash, 0)}`,
        `  Monthly Burn:     ${formatCurrency(data.runway.burn, 0)}`,
        '',
        'â”€â”€ FUNCTION BREAKDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
        ...last.functions.map(f => {
          const c = f.costs;
          const tot = c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding;
          const util = ((f.capacity.demand / safeNum(f.capacity.capacity, 1)) * 100).toFixed(1);
          return `  ${f.name.padEnd(12)} HC: ${String(f.headcount).padEnd(4)} Util: ${util}%   Cost: ${formatCurrency(tot, 0)}/mo`;
        }),
        '',
        'â”€â”€ ASSUMPTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
        `  Comp Inflation: ${ASSUMP.compInflation}%/yr`,
        `  Ramp Duration:  ${ASSUMP.rampMonths} months`,
        `  One-time/Hire:  ${formatCurrency(ASSUMP.oneTimeCost, 0)}`,
        `  Scenario Mults: Upside ${ASSUMP.scenarUpside}x / Downside ${ASSUMP.scenarDownside}x`,
        '',
        'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'
      ];

      const text = lines.join('\n');
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => showToast('âœ“ Board Summary copied to clipboard')).catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.cssText = 'position:fixed;top:-9999px;left:-9999px;opacity:0;';
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); showToast('âœ“ Board Summary copied'); }
      catch(e) { showToast('âš  Copy failed â€” use Ctrl+A then Ctrl+C'); }
      document.body.removeChild(ta);
    }

    // ========== ASSUMPTIONS PANEL TOGGLE ==========

    let assumpOpen = false;

    function toggleAssumptions() {
      assumpOpen = !assumpOpen;
      const body    = document.getElementById('assumpBody');
      const chevron = document.getElementById('assumpChevron');
      const trigger = document.getElementById('assumpTrigger');
      body.classList.toggle('open', assumpOpen);
      chevron.classList.toggle('open', assumpOpen);
      trigger.setAttribute('aria-expanded', String(assumpOpen));

      // Hide/show the other sidebar sections
      ['sidebarScenario','sidebarCash','sidebarActions'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.toggle('is-hidden', assumpOpen);
      });
    }

    // ========== DEFAULTS (single source for reset) ==========
    const ASSUMP_DEFAULTS = {
      utilYellow: 70, utilRed: 85,
      runwayCritical: 6, runwayCaution: 12,
      runwaySafeHire: 12, runwaySafeCon: 15,
      rampMonths: 3, oneTimeCost: 16000,
      compInflation: 6,
      scenarUpside: 1.15, scenarDownside: 0.85, scenarUtilShift: 10
    };

    const ASSUMP_INPUT_MAP = {
      utilYellow: 'aUtilYellow', utilRed: 'aUtilRed',
      runwayCritical: 'aRunwayCritical', runwayCaution: 'aRunwayCaution',
      runwaySafeHire: 'aRunwaySafeHire', runwaySafeCon: 'aRunwaySafeCon',
      rampMonths: 'aRampMonths', oneTimeCost: 'aOneTimeCost',
      compInflation: 'aCompInflation',
      scenarUpside: 'aScenarUpside', scenarDownside: 'aScenarDownside',
      scenarUtilShift: 'aScenarUtilShift'
    };

    function resetAssumptions() {
      // Write defaults back to inputs
      Object.keys(ASSUMP_DEFAULTS).forEach(key => {
        const el = document.getElementById(ASSUMP_INPUT_MAP[key]);
        if (el) {
          el.value = ASSUMP_DEFAULTS[key];
          el.classList.remove('invalid');
        }
      });
      // Apply to ASSUMP object
      Object.assign(ASSUMP, ASSUMP_DEFAULTS);
      // Re-render
      if (baseDataset) {
        activeDataset = applyScenario(baseDataset, scenario);
        renderAll();
      }
    }

    // ========== EVENT HANDLERS ==========

    function onUseSample() {
      // Reset assumptions to defaults first
      resetAssumptions();
      baseDataset = loadSampleData();
      dataMode = 'sample';
      activeDataset = applyScenario(baseDataset, scenario);
      updateDataModeBadge();
      renderAll();
    }

    function onRandomizeAll() {
      baseDataset = generateRandomData();
      dataMode = 'random';
      activeDataset = applyScenario(baseDataset, scenario);
      updateDataModeBadge();
      renderAll();
    }

    function onScenarioChange(newScenario) {
      scenario = newScenario;
      document.querySelectorAll('.sb-acc-tab[data-scenario]').forEach(t => t.classList.remove('active'));
      const activeTab = document.querySelector(`.sb-acc-tab[data-scenario="${newScenario}"]`);
      if (activeTab) activeTab.classList.add('active');
      const lbl = document.getElementById('sbScenarioLabel');
      if (lbl) { const n = {base:'Base Case',upside:'Upside',downside:'Downside'}; lbl.textContent = n[newScenario] || newScenario; }
      activeDataset = applyScenario(baseDataset, scenario);
      renderAll();
    }

    function showPlanTab(tab) {
      activePlanTab = tab;
      document.getElementById('planTabCon').classList.toggle('active', tab === 'conservative');
      document.getElementById('planTabAgg').classList.toggle('active', tab === 'aggressive');
      renderHiringPlanTable();
    }

    function updateDataModeBadge() {
      const badge = document.getElementById('dataModeBadge');
      const badge2 = document.getElementById('dataModeBadge2');
      const s = document.getElementById('btnSampleMode');
      const r = document.getElementById('btnRandomMode');
      const isSample = dataMode === 'sample';
      const txt = isSample ? 'SAMPLE' : 'RANDOM';
      const cls = isSample ? 'data-badge' : 'data-badge random';
      if (badge) { badge.textContent = txt; badge.className = cls; }
      if (badge2) { badge2.textContent = txt; badge2.className = cls; }
      if (s) { s.style.background = isSample ? 'var(--text)' : 'transparent'; s.style.color = isSample ? 'white' : 'var(--muted)'; }
      if (r) { r.style.background = !isSample ? 'var(--text)' : 'transparent'; r.style.color = !isSample ? 'white' : 'var(--muted)'; }
    }

    function updateCashBalance() {
      const input = document.getElementById('cashBalanceInput');
      const newCash = parseFloat(input.value) || 2400000;
      if (activeDataset) {
        activeDataset.runway.cash = newCash;
        if (baseDataset) baseDataset.runway.cash = newCash;
        renderAll();
      }
    }

    function syncCashBalanceInput() {
      const input = document.getElementById('cashBalanceInput');
      if (activeDataset && input) input.value = activeDataset.runway.cash;
    }

    // ========== TOOLTIP ENGINE (data-help legacy, kept for sidebar) ==========

    function updateTooltips() {
      if (!activeDataset) return;
      const data = activeDataset;
      const last = data.months[data.months.length - 1];
      const totalCost = last.functions.reduce((s, f) => {
        const c = f.costs;
        return s + (c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding);
      }, 0);
      const avgUtil = last.functions.reduce((s, f) => {
        return s + ((f.capacity.demand / f.capacity.capacity) * 100);
      }, 0) / FUNCTIONS.length;
      const runway = safeNum(data.runway.cash / data.runway.burn);

      const opexHelp = document.querySelector('#opexHelp');
      if (opexHelp) opexHelp.setAttribute('data-help', `Shows where your money goes each month. Currently spending ${formatCurrency(totalCost, 0)}/month total across ${FUNCTIONS.length} functions.`);

      const utilHelp = document.querySelector('#utilizationHelp');
      if (utilHelp) utilHelp.setAttribute('data-help', `Shows if your team is underwater (too much work) or underutilized. Current avg: ${fmtSafe(avgUtil)}%. >85% = hire, 70-85% = healthy, <70% = delay.`);

      const runwayHelp = document.querySelector('#runwayHelp');
      if (runwayHelp) runwayHelp.setAttribute('data-help', `Hire fast = solve bottlenecks but burn cash faster. Hire slow = preserve runway but risk burnout. Current runway: ${fmtSafe(runway)} months.`);
    }

    // ========== RENDERING FUNCTIONS ==========

    function renderSummaryKPIs() {
      const data = activeDataset;
      const last = data.months[data.months.length - 1];

      const totalHC = last.functions.reduce((s, f) => s + f.headcount, 0);
      const totalCost = last.functions.reduce((s, f) => {
        const c = f.costs;
        return s + (c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding);
      }, 0);
      const avgUtil = last.functions.reduce((s, f) => {
        const cap = safeNum(f.capacity.capacity, 1);
        return s + ((f.capacity.demand / cap) * 100);
      }, 0) / FUNCTIONS.length;
      const runway = safeNum(data.runway.cash / data.runway.burn);

      // Board decision
      const dec = computeDecision(avgUtil, runway);
      renderBoardDecisionCard(dec, avgUtil, runway);

      document.getElementById('summaryKPIs').innerHTML = `
        <div class="kpi-box">
          <div class="kpi-box-label">
            Total Headcount <span class="tt-icon" data-tt="${GLOSSARY['Headcount'].replace(/"/g,'&quot;')}">?</span>
          </div>
          <div class="kpi-box-value">${totalHC}</div>
          <div class="kpi-box-sub">Across ${FUNCTIONS.length} functions</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label">
            Monthly Opex <span class="tt-icon" data-tt="${GLOSSARY['Opex'].replace(/"/g,'&quot;')}">?</span>
          </div>
          <div class="kpi-box-value">${formatCurrency(totalCost, 0)}</div>
          <div class="kpi-box-sub">Fully loaded Â· <span class="inflation-badge" data-tt="Comp inflation of ${ASSUMP.compInflation}%/yr is applied to recurring payroll costs over the 12-month dataset.">${ASSUMP.compInflation}%/yr inflation</span></div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label">
            Avg Utilization <span class="tt-icon" data-tt="${GLOSSARY['Utilization'].replace(/"/g,'&quot;')}">?</span>
          </div>
          <div class="kpi-box-value" style="color: ${avgUtil > ASSUMP.utilRed ? COLORS.warning : avgUtil > ASSUMP.utilYellow ? COLORS.caution : COLORS.success};">${fmtSafe(avgUtil)}%</div>
          <div class="kpi-box-sub">${avgUtil > ASSUMP.utilRed ? 'Consider hiring' : avgUtil < ASSUMP.utilYellow ? 'Underutilized' : 'Healthy range'}</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label">
            Runway <span class="tt-icon" data-tt="${GLOSSARY['Runway'].replace(/"/g,'&quot;')}">?</span>
          </div>
          <div class="kpi-box-value" style="color: ${runway < ASSUMP.runwayCritical ? COLORS.warning : runway < ASSUMP.runwayCaution ? COLORS.caution : COLORS.success};">${isFinite(runway) ? fmtSafe(runway) + ' mo' : 'â€”'}</div>
          <div class="kpi-box-sub">At current ${gl('Burn Rate', 'burn rate')}</div>
        </div>
      `;
    }

    function renderBoardDecisionCard(dec, avgUtil, runway) {

      // â”€â”€ Standardized Decision Box wiring â”€â”€
      const icState = (dec.decision === 'HIRE') ? 'positive'
                    : (dec.decision === 'CUT BURN' || dec.decision === "DON'T HIRE") ? 'negative'
                    : 'warning';
      const icVerdict = 'Board decision:';
      const icAction  = dec.decision;
      const icBullets = dec.bullets.slice(0, 3);
      const icDriver  = dec.ruleText;
      setDecisionBox(icState, icVerdict, icAction, icBullets, icDriver);

      const confClass = dec.confidence === 'HIGH' ? 'bd-conf-high' : dec.confidence === 'MED' ? 'bd-conf-med' : 'bd-conf-low';
      const bulletsHtml = dec.bullets.map(b => `<div class="bd-bullet">${b}</div>`).join('');

      // â”€â”€ Raise Plan callout (deterministic â€” only when decision = RAISE) â”€â”€
      let raisePlanHtml = '';
      if (dec.decision === 'RAISE') {
        const data = activeDataset;
        const monthlyBurn = safeNum(data.runway.cash / runway / runway) || safeNum(data.runway.burn); // fallback to stored burn
        // Use the stored burn rate for accuracy
        const burn = safeNum(data.runway.burn);
        const targetRunway = 18; // months â€” standard pre-Series ask
        const impliedRaise = Math.max(0, burn * (targetRunway - runway));
        // Start fundraising when runway hits 9â€“12 months (standard lead time)
        const startAt = Math.max(1, Math.round(runway - 9)); // months from now
        const startLabel = startAt <= 1 ? 'Immediately' : `In ~${startAt} month${startAt !== 1 ? 's' : ''}`;

        raisePlanHtml = `
          <div class="raise-plan-callout">
            <div class="raise-plan-header">
              <span class="raise-plan-badge">Raise Plan</span>
              <span class="raise-plan-title">Fundraising roadmap based on current financials</span>
            </div>
            <div class="raise-plan-grid">
              <div class="raise-plan-metric">
                <div class="raise-plan-metric-label">${gl('Implied Raise')}</div>
                <div class="raise-plan-metric-value">${formatCurrency(impliedRaise, 0)}</div>
              </div>
              <div class="raise-plan-metric">
                <div class="raise-plan-metric-label">${gl('Target Runway')} (post-close)</div>
                <div class="raise-plan-metric-value">${targetRunway} months</div>
              </div>
              <div class="raise-plan-metric">
                <div class="raise-plan-metric-label">Start Fundraising</div>
                <div class="raise-plan-metric-value" style="font-size:13px;">${startLabel}</div>
              </div>
            </div>
            <div class="raise-plan-note">
              <strong>Logic:</strong> Implied raise = monthly ${gl('Burn Rate')} (${formatCurrency(burn, 0)}) Ã— (target ${targetRunway} mo âˆ’ current ${fmtSafe(runway)} mo ${gl('Runway')}).
              Begin investor outreach when ${gl('Runway')} reaches 9â€“12 months to allow a standard 6-month fundraising process.
              Hiring should pause until round is closed.
            </div>
          </div>
        `;
      }

      // boardDecisionCard element removed (duplicate of decision-box above) â€” skip render
      const _bdc = document.getElementById('boardDecisionCard');
      if (_bdc) { _bdc.innerHTML = `
        <div class="bd-verdict-col">
          <div class="bd-label">Board Decision</div>
          <div class="bd-decision ${dec.cssClass}" data-tt="${(GLOSSARY[dec.decision] || '').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}">${dec.decision}</div>
          <div class="bd-confidence-pill ${confClass}" data-tt="${(GLOSSARY['Confidence'] || '').replace(/"/g,'&quot;')}">
            Confidence: ${dec.confidence}
          </div>
          <div class="bd-signals">
            <span class="bd-signal ${dec.capSig.cls}" data-tt="${(GLOSSARY['Utilization'] || '').replace(/"/g,'&quot;')}">${dec.capSig.label}</span>
            <span class="bd-signal ${dec.cashSig.cls}" data-tt="${(GLOSSARY['Runway'] || '').replace(/"/g,'&quot;')}">${dec.cashSig.label}</span>
          </div>
          <!-- Rule fired (transparency) -->
          <div class="bd-rule-fired">
            <strong>${dec.ruleText}</strong>
          </div>
        </div>
        <div class="bd-rationale-col">
          <div class="bd-label">Rationale</div>
          <!-- Values vs thresholds -->
          <div class="bd-values-grid">
            <div class="bd-value-chip">
              <div class="bv-label">Utilization</div>
              <div class="bv-val" style="color:${dec.vals.u >= dec.vals.uRed ? COLORS.warning : dec.vals.u >= dec.vals.uYellow ? COLORS.caution : COLORS.success};">${fmtSafe(dec.vals.u)}%</div>
              <div class="bv-thresh">Red â‰¥ ${dec.vals.uRed}% Â· Yellow â‰¥ ${dec.vals.uYellow}%</div>
            </div>
            <div class="bd-value-chip">
              <div class="bv-label">Runway</div>
              <div class="bv-val" style="color:${dec.vals.r < dec.vals.rCrit ? COLORS.warning : dec.vals.r < dec.vals.rCaution ? COLORS.caution : COLORS.success};">${isFinite(dec.vals.r) ? fmtSafe(dec.vals.r) + ' mo' : 'â€”'}</div>
              <div class="bv-thresh">Critical &lt; ${dec.vals.rCrit} Â· Caution &lt; ${dec.vals.rCaution}</div>
            </div>
          </div>
          <div class="bd-bullets" style="margin-top:10px;">${bulletsHtml}</div>
          ${raisePlanHtml}
        </div>
      `; }// end if(_bdc)
    }

    function renderHeadcountChart() {
      const canvas = document.getElementById('headcountChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      if (!rect.width) return;
      canvas.width = rect.width * dpr;
      canvas.height = 320 * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = '320px';
      ctx.scale(dpr, dpr);

      const w = rect.width;
      const h = 320;
      const padding = { top: 40, right: 60, bottom: 50, left: 60 };
      const chartW = w - padding.left - padding.right;
      const chartH = h - padding.top - padding.bottom;

      const data = activeDataset;
      headcountChartPoints = [];

      const totals = data.months.map(m => m.functions.reduce((s, f) => s + f.headcount, 0));
      const maxHCRaw = Math.max(...totals.filter(v => isFinite(v)));
      const maxHC = (isFinite(maxHCRaw) && maxHCRaw > 0) ? maxHCRaw * 1.1 : 10;

      ctx.strokeStyle = 'rgba(12,23,45,0.08)';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (i / 4) * chartH;
        ctx.beginPath(); ctx.moveTo(padding.left, y); ctx.lineTo(w - padding.right, y); ctx.stroke();
      }
      ctx.fillStyle = COLORS.muted; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'right'; ctx.textBaseline = 'middle';
      for (let i = 0; i <= 4; i++) {
        const val = maxHC * (1 - i / 4);
        const y = padding.top + (i / 4) * chartH;
        ctx.fillText(Math.round(val).toString(), padding.left - 10, y);
      }

      const barWidth = chartW / data.months.length;
      data.months.forEach((month, mi) => {
        const x = padding.left + mi * barWidth + barWidth * 0.1;
        const barW = barWidth * 0.8;
        let yOffset = 0;
        month.functions.forEach((func, fi) => {
          const height = (func.headcount / maxHC) * chartH;
          const y = padding.top + chartH - yOffset - height;
          ctx.fillStyle = COLORS.functions[fi];
          ctx.fillRect(x, y, barW, height);
          headcountChartPoints.push({ x: x + barW / 2, y: y + height / 2, month: month.month, function: func.name, headcount: func.headcount });
          yOffset += height;
        });
      });

      ctx.fillStyle = COLORS.muted; ctx.font = '11px sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
      data.months.forEach((month, i) => {
        if (i % 2 === 0 || data.months.length <= 6) {
          ctx.fillText(month.month, padding.left + i * barWidth + barWidth / 2, h - padding.bottom + 10);
        }
      });

      let legendX = padding.left;
      FUNCTIONS.forEach((func, i) => {
        ctx.fillStyle = COLORS.functions[i]; ctx.fillRect(legendX, 15, 16, 10);
        ctx.fillStyle = '#0b1220'; ctx.font = '11px sans-serif'; ctx.textAlign = 'left';
        ctx.fillText(func, legendX + 20, 22);
        legendX += ctx.measureText(func).width + 35;
      });
    }

    function renderOpexChart() {
      const canvas = document.getElementById('opexChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      if (!rect.width) return;
      canvas.width = rect.width * dpr;
      canvas.height = 320 * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = '320px';
      ctx.scale(dpr, dpr);

      const w = rect.width; const h = 320;
      const padding = { top: 40, right: 60, bottom: 50, left: 70 };
      const chartW = w - padding.left - padding.right;
      const chartH = h - padding.top - padding.bottom;

      const data = activeDataset;
      opexChartPoints = [];

      const totalsOpex = data.months.map(m => m.functions.reduce((s, f) => {
        const c = f.costs;
        return s + (c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding);
      }, 0));
      const maxOpexRaw = Math.max(...totalsOpex.filter(v => isFinite(v)));
      const maxOpex = (isFinite(maxOpexRaw) && maxOpexRaw > 0) ? maxOpexRaw * 1.1 : 1;

      ctx.strokeStyle = 'rgba(12,23,45,0.08)'; ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (i / 4) * chartH;
        ctx.beginPath(); ctx.moveTo(padding.left, y); ctx.lineTo(w - padding.right, y); ctx.stroke();
      }
      ctx.fillStyle = COLORS.muted; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'right'; ctx.textBaseline = 'middle';
      for (let i = 0; i <= 4; i++) {
        const val = maxOpex * (1 - i / 4);
        const y = padding.top + (i / 4) * chartH;
        ctx.fillText('$' + (val / 1000).toFixed(0) + 'K', padding.left - 10, y);
      }

      const barWidth = chartW / data.months.length;
      data.months.forEach((month, mi) => {
        const x = padding.left + mi * barWidth + barWidth * 0.1;
        const barW = barWidth * 0.8;
        let yOffset = 0;
        month.functions.forEach((func, fi) => {
          const c = func.costs;
          const totalCost = c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding;
          const height = (totalCost / maxOpex) * chartH;
          const y = padding.top + chartH - yOffset - height;
          ctx.fillStyle = COLORS.functions[fi];
          ctx.fillRect(x, y, barW, height);
          opexChartPoints.push({ x: x + barW / 2, y: y + height / 2, month: month.month, function: func.name, cost: totalCost });
          yOffset += height;
        });
      });

      ctx.fillStyle = COLORS.muted; ctx.font = '11px sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
      data.months.forEach((month, i) => {
        if (i % 2 === 0 || data.months.length <= 6) {
          ctx.fillText(month.month, padding.left + i * barWidth + barWidth / 2, h - padding.bottom + 10);
        }
      });

      let legendX = padding.left;
      FUNCTIONS.forEach((func, i) => {
        ctx.fillStyle = COLORS.functions[i]; ctx.fillRect(legendX, 15, 16, 10);
        ctx.fillStyle = '#0b1220'; ctx.font = '11px sans-serif'; ctx.textAlign = 'left';
        ctx.fillText(func, legendX + 20, 22);
        legendX += ctx.measureText(func).width + 35;
      });
    }

    function renderFullyLoadedCosts() {
      const data = activeDataset;
      const last = data.months[data.months.length - 1];
      let html = '';

      last.functions.forEach(func => {
        const c = func.costs;
        const runRate = c.salary + c.benefits + c.taxes + c.bonus;
        const oneTime = c.equipment + c.recruiting + c.onboarding;
        const perHead = safeNum(runRate / (func.headcount || 1));
        const annualPerHead = perHead * 12;

        html += `
          <div class="module-card">
            <div class="card-header">
              <div class="card-title">${func.name}</div>
              <div style="font-size: 13px; color: var(--muted);">${func.headcount} employees</div>
            </div>
            <div style="padding: 12px 16px; background: rgba(246,248,251,0.7); border-left: 3px solid ${COLORS.functions[FUNCTIONS.indexOf(func.name)]}; border-radius: 8px; margin-bottom: 16px; font-size: 13px; line-height: 1.6; color: var(--text);">
              ${func.name === 'Sales' ?
                'What it costs to close deals. Includes reps, managers, and sales ops. Higher comp plans (bonuses) reflect commission structures.' :
              func.name === 'Engineering' ?
                'What it costs to build product. Includes developers, product managers, designers. High salary reflects competitive tech talent market.' :
              func.name === 'G&A' ?
                'What it costs to run the company. Includes finance, HR, legal, admin. Enables the business to function but doesn\'t directly generate revenue.' :
                'What it costs to serve customers. Includes support, success, implementation. Scales with customer count and complexity.'}
            </div>
            <div class="kpi-grid">
              <div class="kpi-box">
                <div class="kpi-box-label">
                  Monthly/Head <span class="tt-icon" data-tt="${GLOSSARY['Monthly/Head'].replace(/"/g,'&quot;')}">?</span>
                </div>
                <div class="kpi-box-value" style="font-size: 18px;">${formatCurrency(perHead, 0)}</div>
              </div>
              <div class="kpi-box">
                <div class="kpi-box-label">
                  Annual/Head <span class="tt-icon" data-tt="${GLOSSARY['Annual/Head'].replace(/"/g,'&quot;')}">?</span>
                </div>
                <div class="kpi-box-value" style="font-size: 18px;">${formatCurrency(annualPerHead, 0)}</div>
              </div>
              <div class="kpi-box">
                <div class="kpi-box-label">
                  Monthly Run Rate <span class="tt-icon" data-tt="${GLOSSARY['Monthly Run Rate'].replace(/"/g,'&quot;')}">?</span>
                </div>
                <div class="kpi-box-value" style="font-size: 18px;">${formatCurrency(runRate, 0)}</div>
              </div>
              <div class="kpi-box">
                <div class="kpi-box-label">
                  One-Time Costs <span class="tt-icon" data-tt="${GLOSSARY['One-Time Costs'].replace(/"/g,'&quot;')}">?</span>
                </div>
                <div class="kpi-box-value" style="font-size: 18px; color: ${oneTime > 0 ? COLORS.caution : COLORS.success};">${formatCurrency(oneTime, 0)}</div>
              </div>
            </div>
            <div style="margin-top: 16px; padding: 14px; background: rgba(246,248,251,0.5); border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 12px;">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div><span style="color: var(--muted);">Base Salary:</span> <strong>${formatCurrency(c.salary / func.headcount, 0)}/mo</strong></div>
                <div><span style="color: var(--muted);">Benefits:</span> <strong>${formatCurrency(c.benefits / func.headcount, 0)}/mo</strong></div>
                <div><span style="color: var(--muted);">Taxes:</span> <strong>${formatCurrency(c.taxes / func.headcount, 0)}/mo</strong></div>
                <div><span style="color: var(--muted);">Bonus:</span> <strong>${formatCurrency(c.bonus / func.headcount, 0)}/mo</strong></div>
                <div><span style="color: var(--muted);">Equipment:</span> <strong>${formatCurrency(c.equipment, 0)} total</strong></div>
                <div><span style="color: var(--muted);">Recruiting:</span> <strong>${formatCurrency(c.recruiting, 0)} total</strong></div>
              </div>
            </div>
          </div>
        `;
      });

      document.getElementById('fullyLoadedCosts').innerHTML = html;
    }

    function renderUtilizationChart() {
      const canvas = document.getElementById('utilizationChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      if (!rect.width) return;
      canvas.width = rect.width * dpr;
      canvas.height = 280 * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = '280px';
      ctx.scale(dpr, dpr);

      const w = rect.width; const h = 280;
      const padding = { top: 40, right: 40, bottom: 50, left: 60 };
      const chartW = w - padding.left - padding.right;
      const chartH = h - padding.top - padding.bottom;
      const data = activeDataset;
      utilizationChartPoints = [];

      FUNCTIONS.forEach((func, fi) => {
        const utilData = data.months.map(m => {
          const f = m.functions.find(fn => fn.name === func);
          if (!f || !f.capacity.capacity) return 0;
          return safeNum((f.capacity.demand / f.capacity.capacity) * 100);
        });
        const barWidth = chartW / data.months.length;
        ctx.beginPath(); ctx.strokeStyle = COLORS.functions[fi]; ctx.lineWidth = 2.5;
        data.months.forEach((month, mi) => {
          const x = padding.left + mi * barWidth + barWidth / 2;
          const util = utilData[mi];
          const y = padding.top + chartH - (util / 100) * chartH;
          if (mi === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
          utilizationChartPoints.push({ x, y, month: month.month, function: func, utilization: util });
        });
        ctx.stroke();
        data.months.forEach((month, mi) => {
          const x = padding.left + mi * barWidth + barWidth / 2;
          const util = utilData[mi];
          const y = padding.top + chartH - (util / 100) * chartH;
          ctx.fillStyle = COLORS.functions[fi]; ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI * 2); ctx.fill();
        });
      });

      // Threshold lines
      [ASSUMP.utilRed, ASSUMP.utilYellow].forEach(pct => {
        const y = padding.top + chartH - (pct / 100) * chartH;
        ctx.beginPath();
        ctx.strokeStyle = pct === ASSUMP.utilRed ? 'rgba(220,38,38,0.25)' : 'rgba(217,119,6,0.22)';
        ctx.setLineDash([4, 4]); ctx.lineWidth = 1;
        ctx.moveTo(padding.left, y); ctx.lineTo(w - padding.right, y); ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillStyle = pct === ASSUMP.utilRed ? 'rgba(220,38,38,0.55)' : 'rgba(217,119,6,0.55)';
        ctx.font = '10px sans-serif'; ctx.textAlign = 'left'; ctx.textBaseline = 'bottom';
        ctx.fillText(pct + '%', w - padding.right + 3, y + 1);
      });

      ctx.strokeStyle = 'rgba(12,23,45,0.08)'; ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (i / 4) * chartH;
        ctx.beginPath(); ctx.moveTo(padding.left, y); ctx.lineTo(w - padding.right, y); ctx.stroke();
        const val = 100 * (1 - i / 4);
        ctx.fillStyle = COLORS.muted; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'right'; ctx.textBaseline = 'middle';
        ctx.fillText(val.toFixed(0) + '%', padding.left - 10, y);
      }

      ctx.fillStyle = COLORS.muted; ctx.font = '11px sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
      data.months.forEach((month, i) => {
        if (i % 2 === 0 || data.months.length <= 6) {
          const barWidth = chartW / data.months.length;
          ctx.fillText(month.month, padding.left + i * barWidth + barWidth / 2, h - padding.bottom + 10);
        }
      });

      let legendX = padding.left;
      FUNCTIONS.forEach((func, i) => {
        ctx.fillStyle = COLORS.functions[i]; ctx.fillRect(legendX, 15, 16, 2.5);
        ctx.fillStyle = '#0b1220'; ctx.font = '11px sans-serif'; ctx.textAlign = 'left';
        ctx.fillText(func, legendX + 20, 19);
        legendX += ctx.measureText(func).width + 35;
      });
    }

    function renderCapacityTable() {
      const data = activeDataset;
      const last = data.months[data.months.length - 1];

      let html = `<thead><tr>
        <th>Function</th>
        <th>Capacity
          <span class="tt-icon" data-tt="${GLOSSARY['Capacity'].replace(/"/g,'&quot;')}">?</span>
        </th>
        <th>Demand
          <span class="tt-icon" data-tt="${GLOSSARY['Demand'].replace(/"/g,'&quot;')}">?</span>
        </th>
        <th>Utilization
          <span class="tt-icon" data-tt="${GLOSSARY['Utilization'].replace(/"/g,'&quot;')}">?</span>
        </th>
        <th>Backlog
          <span class="tt-icon" data-tt="${GLOSSARY['Backlog'].replace(/"/g,'&quot;')}">?</span>
        </th>
        <th>Backlog %
          <span class="tt-icon" data-tt="${GLOSSARY['Backlog %'].replace(/"/g,'&quot;')}">?</span>
        </th>
      </tr></thead><tbody>`;

      last.functions.forEach(func => {
        const cap = safeNum(func.capacity.capacity, 1);
        const util = safeNum((func.capacity.demand / cap) * 100);
        const backlog = Math.max(0, func.capacity.demand - cap);
        const backlogPct = safeNum((backlog / cap) * 100);
        const utilColor = util > ASSUMP.utilRed ? COLORS.warning : util > ASSUMP.utilYellow ? COLORS.caution : COLORS.success;
        const backlogColor = backlogPct > 20 ? COLORS.warning : backlogPct > 0 ? COLORS.caution : COLORS.success;

        html += `
          <tr>
            <td style="font-weight: 600;">${func.name}</td>
            <td>${func.capacity.capacity} ${func.capacity.metric}</td>
            <td>${func.capacity.demand}</td>
            <td style="color: ${utilColor}; font-weight: 600;">${fmtSafe(util)}%</td>
            <td style="color: ${backlogColor}; font-weight: 600;">${backlog}</td>
            <td style="color: ${backlogColor}; font-weight: 600;">${fmtSafe(backlogPct)}%</td>
          </tr>
        `;
      });

      html += '</tbody>';
      document.getElementById('capacityTable').innerHTML = html;
    }

    function renderHiringTriggers() {
      const data = activeDataset;
      const runway = safeNum(data.runway.cash / data.runway.burn);
      const uRed    = ASSUMP.utilRed;
      const uYellow = ASSUMP.utilYellow;
      const rCrit   = ASSUMP.runwayCritical;
      let html = '';

      FUNCTIONS.forEach((fname, fi) => {
        const recent = data.months.slice(-3).map(m => m.functions[fi]);
        const avgUtil = recent.reduce((s, f) => {
          const cap = safeNum(f.capacity.capacity, 1);
          return s + ((f.capacity.demand / cap) * 100);
        }, 0) / recent.length;

        const backlogs = recent.map(f => Math.max(0, f.capacity.demand - f.capacity.capacity));
        const backlogGrowth = backlogs.length > 1 ? ((backlogs[backlogs.length - 1] - backlogs[0]) / Math.max(1, backlogs[0])) * 100 : 0;

        let recType, message, reasons = [];

        if (runway < rCrit) {
          recType = 'delay';
          message = `Delay hiring in ${fname}`;
          reasons.push(`Runway is ${fmtSafe(runway)} months (< ${rCrit}-month threshold).`);
          reasons.push('Preserve cash until revenue inflects or funding is secured.');
        } else if (avgUtil > uRed || backlogGrowth > 15) {
          recType = 'recommend';
          message = `Recommend hiring in ${fname}`;
          if (avgUtil > uRed) reasons.push(`Utilization at ${fmtSafe(avgUtil)}% (> ${uRed}% for 2+ months).`);
          if (backlogGrowth > 15) reasons.push(`Backlog growth ${fmtSafe(backlogGrowth)}% (> 15% threshold).`);
          reasons.push('Team is at capacity risk â€” hire to maintain delivery velocity.');
        } else if (avgUtil < uYellow) {
          recType = 'caution';
          message = `Monitor capacity in ${fname}`;
          reasons.push(`Utilization at ${fmtSafe(avgUtil)}% (< ${uYellow}%) â€” potential overcapacity.`);
          reasons.push('Consider workload redistribution or delay next hire.');
        } else {
          recType = 'caution';
          message = `No action needed for ${fname}`;
          reasons.push(`Utilization at ${fmtSafe(avgUtil)}% â€” healthy ${uYellow}â€“${uRed}% range.`);
          reasons.push('Team appropriately sized for current demand.');
        }

        html += `
          <div class="hiring-rec ${recType}">
            <div class="hiring-rec-title">${message}</div>
            <div class="hiring-rec-reason">
              ${reasons.map(r => `<div style="margin-bottom: 4px;">â€¢ ${r}</div>`).join('')}
            </div>
          </div>
        `;
      });

      document.getElementById('hiringTriggers').innerHTML = html;
    }

    function renderRunwayChart() {
      const canvas = document.getElementById('runwayChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      if (!rect.width) return;
      canvas.width = rect.width * dpr;
      canvas.height = 260 * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = '260px';
      ctx.scale(dpr, dpr);

      const w = rect.width; const h = 260;
      const padding = { top: 40, right: 60, bottom: 50, left: 60 };
      const chartW = w - padding.left - padding.right;
      const chartH = h - padding.top - padding.bottom;

      const data = activeDataset;
      runwayChartPoints = [];

      const conservative = [];
      const aggressive = [];

      let conCash = safeNum(data.runway.cash);
      let aggCash = safeNum(data.runway.cash);

      data.months.forEach((month, mi) => {
        const burn = month.functions.reduce((s, f) => {
          const c = f.costs;
          return s + (c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding);
        }, 0);

        const conBurn = safeNum(burn * (mi === 0 ? 1 : 0.92));
        conCash -= conBurn;
        const conRunwayVal = (conBurn > 0) ? Math.max(0, conCash / conBurn) : 0;
        conservative.push(isFinite(conRunwayVal) ? conRunwayVal : 0);

        const aggBurn = safeNum(burn * (mi === 0 ? 1 : 1.13));
        aggCash -= aggBurn;
        const aggRunwayVal = (aggBurn > 0) ? Math.max(0, aggCash / aggBurn) : 0;
        aggressive.push(isFinite(aggRunwayVal) ? aggRunwayVal : 0);
      });

      // FIXED: safe max computation from both arrays
      const allVals = [...conservative, ...aggressive].filter(v => isFinite(v) && !isNaN(v));
      const maxRunwayRaw = allVals.length > 0 ? Math.max(...allVals) : 1;
      const maxRunway = (isFinite(maxRunwayRaw) && maxRunwayRaw > 0) ? maxRunwayRaw * 1.1 : 1;

      ctx.strokeStyle = 'rgba(12,23,45,0.08)'; ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (i / 4) * chartH;
        ctx.beginPath(); ctx.moveTo(padding.left, y); ctx.lineTo(w - padding.right, y); ctx.stroke();
      }

      ctx.fillStyle = COLORS.muted; ctx.font = 'bold 11px sans-serif'; ctx.textAlign = 'right'; ctx.textBaseline = 'middle';
      for (let i = 0; i <= 4; i++) {
        const val = maxRunway * (1 - i / 4);
        const y = padding.top + (i / 4) * chartH;
        ctx.fillText(val.toFixed(1) + ' mo', padding.left - 10, y);
      }

      const barWidth = chartW / (data.months.length || 1);

      // Conservative line
      ctx.beginPath(); ctx.strokeStyle = COLORS.accent; ctx.lineWidth = 2.5;
      conservative.forEach((runway, i) => {
        const x = padding.left + i * barWidth + barWidth / 2;
        const y = padding.top + chartH - (runway / maxRunway) * chartH;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // Aggressive line
      ctx.beginPath(); ctx.strokeStyle = COLORS.warning; ctx.lineWidth = 2.5;
      aggressive.forEach((runway, i) => {
        const x = padding.left + i * barWidth + barWidth / 2;
        const y = padding.top + chartH - (runway / maxRunway) * chartH;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // Points
      conservative.forEach((runway, i) => {
        const x = padding.left + i * barWidth + barWidth / 2;
        const y = padding.top + chartH - (runway / maxRunway) * chartH;
        ctx.fillStyle = COLORS.accent; ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI * 2); ctx.fill();
        runwayChartPoints.push({ x, y, month: data.months[i].month, runway, strategy: 'conservative' });
      });

      aggressive.forEach((runway, i) => {
        const x = padding.left + i * barWidth + barWidth / 2;
        const y = padding.top + chartH - (runway / maxRunway) * chartH;
        ctx.fillStyle = COLORS.warning; ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI * 2); ctx.fill();
        runwayChartPoints.push({ x, y, month: data.months[i].month, runway, strategy: 'aggressive' });
      });

      ctx.fillStyle = COLORS.muted; ctx.font = '11px sans-serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'top';
      data.months.forEach((month, i) => {
        if (i % 2 === 0 || data.months.length <= 6) {
          ctx.fillText(month.month, padding.left + i * barWidth + barWidth / 2, h - padding.bottom + 10);
        }
      });

      ctx.fillStyle = COLORS.accent; ctx.fillRect(padding.left, 15, 20, 2.5);
      ctx.fillStyle = '#0b1220'; ctx.font = '11px sans-serif'; ctx.textAlign = 'left';
      ctx.fillText('Conservative Hiring', padding.left + 25, 19);
      ctx.fillStyle = COLORS.warning; ctx.fillRect(padding.left + 160, 15, 20, 2.5);
      ctx.fillText('Aggressive Hiring', padding.left + 185, 19);
    }

    function renderStrategyComparison() {
      const data = activeDataset;
      const last = data.months[data.months.length - 1];

      const currentHC   = last.functions.reduce((s, f) => s + f.headcount, 0);
      const currentCost = last.functions.reduce((s, f) => {
        const c = f.costs;
        return s + (c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding);
      }, 0);
      const currentUtil = last.functions.reduce((s, f) => {
        const cap = safeNum(f.capacity.capacity, 1);
        return s + ((f.capacity.demand / cap) * 100);
      }, 0) / FUNCTIONS.length;

      const conHC     = Math.round(currentHC * 1.06);
      const conCost   = currentCost * 1.06;
      const conUtil   = Math.min(safeNum(currentUtil * 1.09), 96);
      const conRunway = safeNum(data.runway.cash / (currentCost * 1.06));

      const aggHC     = Math.round(currentHC * 1.17);
      const aggCost   = currentCost * 1.17;
      const aggUtil   = Math.max(safeNum(currentUtil * 0.91), 62);
      const aggRunway = safeNum(data.runway.cash / (currentCost * 1.17));

      const html = `
        <div class="module-card">
          <div class="card-title" style="margin-bottom: 16px;">
            Strategy Comparison
            <span style="font-size: 13px; font-weight: 400; color: var(--muted); margin-left: 8px;">6-month projection</span>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Metric</th>
                <th>Conservative
                  <span class="tt-icon" data-tt="${GLOSSARY['Conservative'].replace(/"/g,'&quot;')}">?</span>
                </th>
                <th>Aggressive
                  <span class="tt-icon" data-tt="${GLOSSARY['Aggressive'].replace(/"/g,'&quot;')}">?</span>
                </th>
                <th>Delta
                  <span class="tt-icon" data-tt="${GLOSSARY['Delta'].replace(/"/g,'&quot;')}">?</span>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="font-weight: 600;">Headcount</td>
                <td>${conHC}</td>
                <td>${aggHC}</td>
                <td style="color: ${COLORS.accent};">+${aggHC - conHC}</td>
              </tr>
              <tr>
                <td style="font-weight: 600;">Monthly Opex
                  <span class="tt-icon" data-tt="${GLOSSARY['Opex'].replace(/"/g,'&quot;')}">?</span>
                </td>
                <td>${formatCurrency(conCost, 0)}</td>
                <td>${formatCurrency(aggCost, 0)}</td>
                <td style="color: ${COLORS.warning};">+${formatCurrency(aggCost - conCost, 0)}</td>
              </tr>
              <tr>
                <td style="font-weight: 600;">Avg Utilization</td>
                <td style="color: ${conUtil > 85 ? COLORS.warning : COLORS.caution};">${fmtSafe(conUtil)}%</td>
                <td style="color: ${aggUtil < 70 ? COLORS.caution : COLORS.success};">${fmtSafe(aggUtil)}%</td>
                <td>${(safeNum(aggUtil) - safeNum(conUtil)).toFixed(1)}%</td>
              </tr>
              <tr>
                <td style="font-weight: 600;">Runway
                  <span class="tt-icon" data-tt="${GLOSSARY['Runway'].replace(/"/g,'&quot;')}">?</span>
                </td>
                <td style="color: ${conRunway < ASSUMP.runwayCritical ? COLORS.warning : COLORS.success};">${isFinite(conRunway) ? fmtSafe(conRunway) + ' mo' : 'â€”'}</td>
                <td style="color: ${aggRunway < ASSUMP.runwayCritical ? COLORS.warning : COLORS.caution};">${isFinite(aggRunway) ? fmtSafe(aggRunway) + ' mo' : 'â€”'}</td>
                <td style="color: ${conRunway > aggRunway ? COLORS.success : COLORS.warning};">${isFinite(conRunway - aggRunway) ? ((conRunway - aggRunway > 0 ? '+' : '') + (conRunway - aggRunway).toFixed(1) + ' mo') : 'â€”'}</td>
              </tr>
            </tbody>
          </table>

          <div class="tradeoff-grid">
            <div class="tradeoff-box">
              <div class="tradeoff-title">Conservative Hiring</div>
              <div class="tradeoff-section">
                <div class="tradeoff-label">What you gain:</div>
                <div class="tradeoff-list">
                  <div class="tradeoff-item">Extended runway (+${isFinite(conRunway - aggRunway) ? (conRunway - aggRunway).toFixed(1) : 'â€”'} months vs aggressive)</div>
                  <div class="tradeoff-item">Lower cash burn risk</div>
                  <div class="tradeoff-item">More time to prove unit economics</div>
                </div>
              </div>
              <div class="tradeoff-section">
                <div class="tradeoff-label">What you risk:</div>
                <div class="tradeoff-list">
                  <div class="tradeoff-item">Team burnout (${fmtSafe(conUtil)}% utilization)</div>
                  <div class="tradeoff-item">Delivery bottlenecks and missed deadlines</div>
                  <div class="tradeoff-item">Lost revenue opportunities</div>
                </div>
              </div>
            </div>

            <div class="tradeoff-box">
              <div class="tradeoff-title">Aggressive Hiring</div>
              <div class="tradeoff-section">
                <div class="tradeoff-label">What you gain:</div>
                <div class="tradeoff-list">
                  <div class="tradeoff-item">Healthy utilization (${fmtSafe(aggUtil)}%)</div>
                  <div class="tradeoff-item">Faster execution and product velocity</div>
                  <div class="tradeoff-item">Capacity headroom for revenue growth</div>
                </div>
              </div>
              <div class="tradeoff-section">
                <div class="tradeoff-label">What you risk:</div>
                <div class="tradeoff-list">
                  <div class="tradeoff-item">Shortened runway (${isFinite(aggRunway) ? fmtSafe(aggRunway) : 'â€”'} months)</div>
                  <div class="tradeoff-item">Higher burn rate (+${formatCurrency(aggCost - conCost, 0)}/mo)</div>
                  <div class="tradeoff-item">Pressure to raise capital sooner</div>
                </div>
              </div>
            </div>
          </div>

          <div style="margin-top: 20px; padding: 16px; background: rgba(246,248,251,0.5); border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 13px; line-height: 1.6;">
            <strong>Strategic Recommendation:</strong> ${
              conRunway < 9
                ? 'With &lt;9 months runway, prioritize conservative hiring. Focus on high-ROI roles. Defer nice-to-have hires until funding is secured or revenue inflects.'
                : aggUtil > ASSUMP.utilRed - 3
                ? 'Current utilization suggests aggressive hiring is justified. Team is near capacity â€” invest in growth before bottlenecks limit revenue.'
                : `Balanced approach: hire strategically in bottlenecked functions (&gt;${ASSUMP.utilRed}% util), delay in underutilized areas (&lt;${ASSUMP.utilYellow}% util).`
            }
          </div>
        </div>
      `;

      document.getElementById('strategyComparison').innerHTML = html;
    }

    function renderHiringPlanTable() {
      const data = activeDataset;
      const last = data.months[data.months.length - 1];
      const avgUtil = last.functions.reduce((s, f) => {
        const cap = safeNum(f.capacity.capacity, 1);
        return s + ((f.capacity.demand / cap) * 100);
      }, 0) / FUNCTIONS.length;
      const runway = safeNum(data.runway.cash / data.runway.burn);

      const plan = computeHiringPlan(avgUtil, runway, activePlanTab);

      let html = `
        <table class="hiring-plan-table">
          <thead>
            <tr>
              <th>Month</th>
              <th>Hires <span class="tt-icon" data-tt="${GLOSSARY['Headcount'].replace(/"/g,'&quot;')}">?</span></th>
              <th>One-Time Cost <span class="tt-icon" data-tt="${GLOSSARY['One-Time Costs'].replace(/"/g,'&quot;')}">?</span></th>
              <th>Ramp <span class="tt-icon" data-tt="${GLOSSARY['Ramp'].replace(/"/g,'&quot;')}">?</span></th>
              <th>Proj. Util <span class="tt-icon" data-tt="${GLOSSARY['Proj. Util'].replace(/"/g,'&quot;')}">?</span></th>
              <th>Proj. Runway <span class="tt-icon" data-tt="${GLOSSARY['Proj. Runway'].replace(/"/g,'&quot;')}">?</span></th>
            </tr>
          </thead>
          <tbody>
      `;

      plan.forEach(row => {
        html += `
          <tr>
            <td>${row.month}</td>
            <td>${row.hires > 0 ? `<span class="hp-hire">+${row.hires}</span>` : `<span class="hp-none">â€”</span>`}</td>
            <td>${row.oneTimeCost > 0 ? `<span class="hp-cost">${formatCurrency(row.oneTimeCost, 0)}</span>` : `<span class="hp-none">â€”</span>`}</td>
            <td>${row.rampNote ? `<span class="hp-ramp">${row.rampNote}</span>` : `<span class="hp-none">â€”</span>`}</td>
            <td style="color: ${row.util > ASSUMP.utilRed ? COLORS.warning : row.util < ASSUMP.utilYellow ? COLORS.caution : COLORS.success};">${fmtSafe(row.util)}%</td>
            <td style="color: ${row.runway < ASSUMP.runwayCritical ? COLORS.warning : row.runway < ASSUMP.runwayCaution ? COLORS.caution : COLORS.success};">${fmtSafe(row.runway)} mo</td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
        <div style="margin-top: 12px; font-size: 12px; color: var(--muted); line-height: 1.6;">
          <strong>Plan logic:</strong>
          ${activePlanTab === 'aggressive'
            ? `Hire 2 heads when utilization â‰¥ ${ASSUMP.utilRed}% AND runway â‰¥ ${ASSUMP.runwaySafeHire} months. Demand grows ~0.8%/month organically.`
            : `Hire 1 head when utilization â‰¥ ${ASSUMP.utilRed}% AND runway â‰¥ ${ASSUMP.runwaySafeCon} months (higher bar). Demand grows ~0.8%/month organically.`}
          New hires ramp over ${ASSUMP.rampMonths} months. One-time cost per hire: ${formatCurrency(ASSUMP.oneTimeCost, 0)}.
          ${ASSUMP.compInflation > 0 ? `Comp inflation applied at ${ASSUMP.compInflation}%/yr.` : ''}
        </div>
      `;

      document.getElementById('hiringPlanTable').innerHTML = html;
    }

    // ========== CHART INTERACTIONS ==========

    function setupChartInteractions() {
      const pairs = [
        { canvas: 'headcountChart', tooltip: 'headcountTooltip', points: () => headcountChartPoints,
          fmt: p => `<strong>${p.month}</strong><br>${p.function}: ${p.headcount} employees` },
        { canvas: 'opexChart', tooltip: 'opexTooltip', points: () => opexChartPoints,
          fmt: p => `<strong>${p.month}</strong><br>${p.function}: ${formatCurrency(p.cost, 0)}` },
        { canvas: 'utilizationChart', tooltip: 'utilizationTooltip', points: () => utilizationChartPoints,
          fmt: p => `<strong>${p.month}</strong><br>${p.function}: ${fmtSafe(p.utilization)}%` },
        { canvas: 'runwayChart', tooltip: 'runwayTooltip', points: () => runwayChartPoints,
          fmt: p => `<strong>${p.month}</strong><br>${p.strategy}: ${fmtSafe(p.runway)} months` }
      ];

      pairs.forEach(({ canvas, tooltip, points, fmt }) => {
        const cv = document.getElementById(canvas);
        const tt = document.getElementById(tooltip);
        if (!cv || !tt) return;

        cv.addEventListener('mousemove', e => {
          const rect = cv.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          let closest = null, minDist = 35;
          points().forEach(p => {
            const d = Math.sqrt((x - p.x) ** 2 + (y - p.y) ** 2);
            if (d < minDist) { minDist = d; closest = p; }
          });
          if (closest) {
            tt.innerHTML = fmt(closest);
            tt.style.left = (x + 15) + 'px';
            tt.style.top  = (y - 10) + 'px';
            tt.classList.add('visible');
          } else { tt.classList.remove('visible'); }
        });
        cv.addEventListener('mouseleave', () => tt.classList.remove('visible'));
      });
    }

    // ========== HELPERS ==========

    function formatCurrency(value, decimals = 2) {
      const v = safeNum(value);
      if (!isFinite(v)) return 'â€”';
      return '$' + v.toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
    }

    function downloadTemplates() {
      const csv = `Function,Month,Headcount,Base_Salary,Benefits_Pct,Taxes_Pct,Bonus_Pct,Capacity_Metric,Demand_Value
Sales,Jan,12,85000,0.20,0.08,0.15,Deals/month,45
Engineering,Jan,28,120000,0.20,0.08,0.15,Story Points/month,280
G&A,Jan,18,75000,0.20,0.08,0.15,FTE Available,14
Ops,Jan,15,65000,0.20,0.08,0.15,Tickets/month,580

Notes:
- Capacity_Metric: What the function produces
- Demand_Value: Current workload
- One-time costs calculated automatically
- Ramp curves applied automatically for new hires`;
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'headcount-template.csv';
      document.body.appendChild(a); a.click();
      document.body.removeChild(a); URL.revokeObjectURL(url);
    }

    function renderAll() {
      renderSummaryKPIs();
      renderHeadcountChart();
      renderOpexChart();
      renderFullyLoadedCosts();
      renderUtilizationChart();
      renderCapacityTable();
      renderHiringTriggers();
      renderRunwayChart();
      renderStrategyComparison();
      renderHiringPlanTable();
      renderChartExplainers();
      setupChartInteractions();
      updateTooltips();
      syncCashBalanceInput();
    }

    // ========== CHART EXPLAINER BOXES ("So What" panels) ==========
    function renderChartExplainers() {
      if (!activeDataset) return;
      const data = activeDataset;
      const last = data.months[data.months.length - 1];
      const first = data.months[0];

      // â”€â”€ Headcount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const hcByFn = last.functions.map(f => ({ name: f.name, hc: f.headcount }));
      const hcTop  = hcByFn.reduce((a,b) => b.hc > a.hc ? b : a);
      const hcTotal = hcByFn.reduce((s,f) => s + f.hc, 0);
      const hcFirst = first.functions.reduce((s,f) => s + f.headcount, 0);
      const hcGrowthPct = hcFirst > 0 ? Math.round((hcTotal - hcFirst) / hcFirst * 100) : 0;
      const hcTopPct = Math.round(hcTop.hc / hcTotal * 100);

      const el = id => document.getElementById(id);

      if (el('hc-top-fn'))    el('hc-top-fn').textContent   = hcTop.name;
      if (el('hc-top-badge')) el('hc-top-badge').textContent = `${hcTop.hc} people Â· ${hcTopPct}% of org`;
      if (el('hc-total'))     el('hc-total').textContent     = `${hcTotal} total (+${hcGrowthPct}% vs Jan)`;

      if (el('hc-callout')) {
        const borderColor = hcGrowthPct > 25 ? 'rgba(217,119,6,0.25)' : 'rgba(15,118,110,0.2)';
        const bgColor = hcGrowthPct > 25 ? 'rgba(217,119,6,0.05)' : 'rgba(15,118,110,0.06)';
        el('hc-callout').style.borderColor = borderColor;
        el('hc-callout').style.background  = bgColor;
      }
      if (el('hc-verdict')) {
        const engFn = last.functions.find(f => f.name === 'Engineering');
        const engPct = engFn ? Math.round(engFn.headcount / hcTotal * 100) : 0;
        el('hc-verdict').innerHTML = hcGrowthPct > 20
          ? `âœ“ <strong>Headcount grew ${hcGrowthPct}% over 12 months</strong> â€” ${hcTop.name} is your largest function at ${hcTop.hc} people (${hcTopPct}% of org). ${engPct > 40 ? `Engineering at ${engPct}% signals a product-led team â€” confirm sales coverage can keep pace with pipeline.` : 'Distribution is balanced across functions.'}`
          : `â€” <strong>Measured ${hcGrowthPct}% headcount growth</strong> â€” hiring has been disciplined and lean. ${hcTop.name} is the largest function (${hcTop.hc} people). If demand is climbing faster than headcount, utilization will begin compressing delivery capacity.`;
        el('hc-verdict').style.borderLeftColor = hcGrowthPct > 25 ? '#d97706' : '#0f766e';
        el('hc-verdict').style.background = hcGrowthPct > 25 ? 'rgba(217,119,6,0.04)' : 'rgba(15,118,110,0.04)';
      }

      // â”€â”€ Opex â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const opexByFn = last.functions.map(f => {
        const c = f.costs;
        return { name: f.name, cost: c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding };
      });
      const opexTop   = opexByFn.reduce((a,b) => b.cost > a.cost ? b : a);
      const opexTotal = opexByFn.reduce((s,f) => s + f.cost, 0);
      const opexFirst = first.functions.reduce((s,f) => {
        const c = f.costs;
        return s + c.salary + c.benefits + c.taxes + c.bonus + c.equipment + c.recruiting + c.onboarding;
      }, 0);
      const opexGrowthPct = opexFirst > 0 ? Math.round((opexTotal - opexFirst) / opexFirst * 100) : 0;
      const opexTopPct = Math.round(opexTop.cost / opexTotal * 100);

      if (el('opex-top-fn'))    el('opex-top-fn').textContent    = opexTop.name;
      if (el('opex-top-badge')) el('opex-top-badge').textContent  = `${formatCurrency(opexTop.cost, 0)}/mo Â· ${opexTopPct}%`;
      if (el('opex-total'))     el('opex-total').textContent      = `${formatCurrency(opexTotal, 0)}/mo`;

      if (el('opex-callout')) {
        const borderColor = opexGrowthPct > 30 ? 'rgba(217,119,6,0.25)' : 'rgba(15,118,110,0.2)';
        const bgColor     = opexGrowthPct > 30 ? 'rgba(217,119,6,0.05)' : 'rgba(15,118,110,0.06)';
        el('opex-callout').style.borderColor = borderColor;
        el('opex-callout').style.background  = bgColor;
      }
      if (el('opex-verdict')) {
        el('opex-verdict').innerHTML = `âœ“ <strong>${opexTop.name} drives ${opexTopPct}% of total Opex</strong> at ${formatCurrency(opexTop.cost, 0)}/mo. Total fully loaded cost base grew ${opexGrowthPct}% over the period. ${opexGrowthPct > 25 ? `This pace requires revenue to grow at least as fast â€” otherwise gross margins compress. Review whether one-time hiring costs are inflating any single month.` : `Cost discipline is solid. One-time hiring spikes are visible but contained within the recurring trend.`}`;
        el('opex-verdict').style.borderLeftColor = opexGrowthPct > 30 ? '#d97706' : '#0f766e';
        el('opex-verdict').style.background = opexGrowthPct > 30 ? 'rgba(217,119,6,0.04)' : 'rgba(15,118,110,0.04)';
      }

      // â”€â”€ Utilization â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const utilByFn = last.functions.map(f => ({
        name: f.name,
        util: safeNum((f.capacity.demand / safeNum(f.capacity.capacity, 1)) * 100)
      }));
      const utilTop    = utilByFn.reduce((a,b) => b.util > a.util ? b : a);
      const utilAvg    = utilByFn.reduce((s,f) => s + f.util, 0) / utilByFn.length;
      const overloaded = utilByFn.filter(f => f.util >= ASSUMP.utilRed);
      const uRed       = ASSUMP.utilRed;
      const uYellow    = ASSUMP.utilYellow;

      const utilColor = utilTop.util >= uRed ? '#dc2626' : utilTop.util >= uYellow ? '#d97706' : '#059669';
      if (el('util-top-fn'))    el('util-top-fn').textContent    = utilTop.name;
      if (el('util-top-badge')) {
        el('util-top-badge').textContent     = `${fmtSafe(utilTop.util)}% utilization`;
        el('util-top-badge').style.background = utilTop.util >= uRed ? 'rgba(220,38,38,0.10)' : 'rgba(217,119,6,0.10)';
        el('util-top-badge').style.color      = utilColor;
      }
      if (el('util-avg'))  el('util-avg').textContent = `${fmtSafe(utilAvg)}% across all functions`;
      if (el('util-callout')) {
        const borderColor = overloaded.length > 0 ? 'rgba(220,38,38,0.25)' : utilAvg >= uYellow ? 'rgba(217,119,6,0.25)' : 'rgba(15,118,110,0.2)';
        const bgColor     = overloaded.length > 0 ? 'rgba(220,38,38,0.05)' : utilAvg >= uYellow ? 'rgba(217,119,6,0.05)' : 'rgba(15,118,110,0.06)';
        el('util-callout').style.borderColor = borderColor;
        el('util-callout').style.background  = bgColor;
      }
      if (el('util-verdict')) {
        let msg, borderCol, bgCol;
        if (overloaded.length > 0) {
          const names = overloaded.map(f => f.name).join(' & ');
          msg       = `ğŸ”´ <strong>${names} ${overloaded.length === 1 ? 'is' : 'are'} above the ${uRed}% overload threshold.</strong> These teams are at or beyond sustainable capacity â€” delivery quality and morale risk rising. A hire is justified now if runway supports it (see Hiring Justification below).`;
          borderCol = '#dc2626'; bgCol = 'rgba(220,38,38,0.04)';
        } else if (utilAvg >= uYellow) {
          msg       = `ğŸŸ¡ <strong>Average utilization at ${fmtSafe(utilAvg)}% â€” healthy but watch the trend.</strong> No function is overloaded yet, but upward trajectory suggests a hiring decision within 1â€“2 quarters. Monitor month-over-month demand growth and headcount plan alignment.`;
          borderCol = '#d97706'; bgCol = 'rgba(217,119,6,0.04)';
        } else {
          msg       = `âœ“ <strong>All functions below ${uRed}% â€” capacity is healthy.</strong> Average utilization is ${fmtSafe(utilAvg)}%. No immediate hiring pressure. Consider whether any function is significantly underutilized (&lt;${uYellow}%) and whether roles can be redeployed before hiring.`;
          borderCol = '#0f766e'; bgCol = 'rgba(15,118,110,0.04)';
        }
        el('util-verdict').innerHTML = msg;
        el('util-verdict').style.borderLeftColor = borderCol;
        el('util-verdict').style.background      = bgCol;
      }
    }

    // ========== TOOLTIP ENGINE (body-level, no clipping, no flicker) ==========
    // Replaces CSS ::after approach. Uses a single fixed-position div on <body>.

    function initTooltips() {
      // Create singleton tooltip element
      let ttEl = document.getElementById('tt-root');
      if (!ttEl) {
        ttEl = document.createElement('div');
        ttEl.id = 'tt-root';
        document.body.appendChild(ttEl);
      }

      let hideTimer = null;

      function showTT(text, targetEl) {
        clearTimeout(hideTimer);
        ttEl.textContent = text;
        ttEl.classList.add('tt-visible');
        positionTT(targetEl);
      }

      function hideTT() {
        // Small delay so moving between adjacent elements doesn't flash
        hideTimer = setTimeout(() => ttEl.classList.remove('tt-visible'), 80);
      }

      function positionTT(el) {
        const rect = el.getBoundingClientRect();
        const ttW = 270;
        const gap = 8;

        // Default: above the element, centered
        let left = rect.left + rect.width / 2 - ttW / 2;
        let top  = rect.top - gap;

        // Clamp to viewport horizontally
        left = Math.max(12, Math.min(left, window.innerWidth - ttW - 12));

        // If above would go off-screen, flip below
        const ttH = ttEl.offsetHeight || 60;
        if (top - ttH < 8) {
          top = rect.bottom + gap;
          ttEl.style.transform = 'translateY(0)';
        } else {
          top = rect.top - gap;
          ttEl.style.transform = 'translateY(-100%)';
        }

        ttEl.style.left = left + 'px';
        ttEl.style.top  = top  + 'px';
      }

      // Event delegation on document â€” catches dynamically rendered elements too
      document.addEventListener('mouseover', e => {
        const el = e.target.closest('[data-tt], [data-help]');
        if (!el) return;
        const text = el.getAttribute('data-tt') || el.getAttribute('data-help');
        if (text) showTT(text, el);
      });

      document.addEventListener('mouseout', e => {
        const el = e.target.closest('[data-tt], [data-help]');
        if (el) hideTT();
      });

      // Reposition on scroll/resize without re-triggering show/hide
      window.addEventListener('scroll', () => ttEl.classList.remove('tt-visible'), { passive: true });
    }

    // ========== INIT ==========

    window.addEventListener('DOMContentLoaded', () => {
      initTooltips();
      readAssumptions();
      onUseSample();
    });

    window.addEventListener('resize', () => {
      renderHeadcountChart();
      renderOpexChart();
      renderUtilizationChart();
      renderRunwayChart();
    });
  
    /* â”€â”€ Sidebar accordion: one section open at a time â”€â”€ */
    function sidebarAccordion(headerEl) {
      var sidebar = headerEl.closest('.sidebar');
      var allHeaders = sidebar.querySelectorAll('.sb-acc-header');
      allHeaders.forEach(function(h) {
        if (h === headerEl) return;
        h.classList.remove('open');
        var b = h.nextElementSibling;
        if (b && b.classList.contains('sb-acc-body')) b.classList.remove('open');
      });
      headerEl.classList.toggle('open');
      var body = headerEl.nextElementSibling;
      if (body && body.classList.contains('sb-acc-body')) body.classList.toggle('open');
    }


    /* Mobile sidebar toggle */
    (function() {
      var btn = document.getElementById('mobileControlsBtn');
      var sb  = document.querySelector('.sidebar');
      if (!btn || !sb) return;
      btn.addEventListener('click', function() {
        var open = sb.classList.toggle('mobile-open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();


    /* â”€â”€ Body-level tooltip engine (fixes sidebar overflow clipping) â”€â”€ */
    function initTooltips() {
      var ttEl = document.getElementById('tt-root');
      if (!ttEl) {
        ttEl = document.createElement('div');
        ttEl.id = 'tt-root';
        document.body.appendChild(ttEl);
      }

      var hideTimer = null;
      var activeEl = null;

      function show(text, targetEl) {
        clearTimeout(hideTimer);
        activeEl = targetEl;
        ttEl.textContent = text;
        ttEl.classList.add('tt-visible');
        position(targetEl);
      }

      function hide() {
        hideTimer = setTimeout(function() {
          ttEl.classList.remove('tt-visible');
          activeEl = null;
        }, 80);
      }

      function position(el) {
        var rect = el.getBoundingClientRect();
        var ttW = 270;
        var gap = 8;
        var left = rect.left + rect.width / 2 - ttW / 2;
        left = Math.max(12, Math.min(left, window.innerWidth - ttW - 12));
        ttEl.style.width = ttW + 'px';
        ttEl.style.left = left + 'px';
        // Measure height after setting content
        var ttH = ttEl.offsetHeight || 60;
        var top, transform;
        if (rect.top - ttH - gap - 8 < 0) {
          top = rect.bottom + window.scrollY + gap;
          transform = 'none';
        } else {
          top = rect.top + window.scrollY - ttH - gap;
          transform = 'none';
        }
        ttEl.style.top = top + 'px';
        ttEl.style.transform = transform;
        ttEl.style.position = 'absolute';
      }

      /* Kill CSS ::after tooltips â€” they clip in overflow containers */
      var killStyle = document.createElement('style');
      killStyle.textContent = '.help-icon::after,.help-icon:hover::after,[data-help]::after,[data-tt]::after,.term-helper::after,.term-helper:hover::after{content:none!important;display:none!important;}';
      document.head.appendChild(killStyle);

      /* Desktop: mouse events (event delegation) */
      document.addEventListener('mouseover', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) return;
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (text && text !== 'Loading...') show(text, el);
      });

      document.addEventListener('mouseout', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (el) hide();
      });

      /* Mobile: tap to toggle */
      document.addEventListener('click', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) {
          // tap anywhere else hides tooltip
          if (ttEl.classList.contains('tt-visible')) {
            ttEl.classList.remove('tt-visible');
            activeEl = null;
          }
          return;
        }
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (!text || text === 'Loading...') return;
        if (activeEl === el && ttEl.classList.contains('tt-visible')) {
          ttEl.classList.remove('tt-visible');
          activeEl = null;
        } else {
          show(text, el);
        }
        e.stopPropagation();
      });

      /* Reposition on scroll (don't hide, just reposition) */
      window.addEventListener('scroll', function() {
        if (activeEl && ttEl.classList.contains('tt-visible')) {
          position(activeEl);
        }
      }, { passive: true });

      /* Hide on resize */
      window.addEventListener('resize', function() {
        ttEl.classList.remove('tt-visible');
        activeEl = null;
      }, { passive: true });
    }


</script>
<script>
/* Global Time Ticker */
(function(){
  var R=[{l:'APAC',t:'Asia/Singapore'},{l:'EMEA',t:'Europe/London'},{l:'USA',t:'America/New_York'},{l:'LATAM',t:'America/Sao_Paulo'}];
  var WS=6,WN=17,WE=18;
  function fmt(tz){return new Intl.DateTimeFormat('en-US',{timeZone:tz,hour:'numeric',minute:'2-digit',hour12:true}).format(new Date())}
  function hm(tz){var p=new Intl.DateTimeFormat('en-US',{timeZone:tz,hour:'numeric',minute:'2-digit',hour12:false}).formatToParts(new Date()),h=0,m=0;p.forEach(function(x){if(x.type==='hour')h=+x.value;if(x.type==='minute')m=+x.value});return{h:h||0,m:m||0}}
  function st(tz){var h=hm(tz).h;return h>=WS&&h<WN?'active':h===WN?'ending':'offline'}
  function wake(tz){var x=hm(tz),d=WS*60-(x.h*60+x.m);return d<=0?d+1440:d}
  function slp(tz){var x=hm(tz);return Math.max(0,WE*60-(x.h*60+x.m))}
  function dur(m){var h=Math.floor(m/60),n=m%60;return h===0?n+'m':n===0?h+'h':h+'h '+n+'m'}
  function bestWin(ltz){
    var now=new Date(),s=new Date(now);s.setUTCMinutes(0,0,0);s.setUTCHours(s.getUTCHours()+1);
    var bu=null,bc=0;
    for(var i=0;i<48;i++){
      var pr=new Date(s.getTime()+i*3600000),iw=0;
      R.forEach(function(r){var p=new Intl.DateTimeFormat('en-US',{timeZone:r.t,hour:'numeric',hour12:false}).formatToParts(pr),h=0;p.forEach(function(x){if(x.type==='hour')h=+x.value});if(h>=WS&&h<WE)iw++});
      if(iw>bc){bc=iw;bu=pr}
      if(bc===R.length)break;
    }
    if(!bu||bc<2)return null;
    var e=new Date(bu.getTime()+7200000),o={timeZone:ltz,hour:'numeric',minute:'2-digit',hour12:true};
    var t1=new Intl.DateTimeFormat('en-US',o).format(bu),t2=new Intl.DateTimeFormat('en-US',o).format(e);
    var fd={timeZone:ltz,year:'numeric',month:'2-digit',day:'2-digit'};
    var tm=new Intl.DateTimeFormat('en-US',fd).format(now)!==new Intl.DateTimeFormat('en-US',fd).format(bu)?' (tom)':'';
    return{time:t1+'â€“'+t2+tm,count:bc}
  }
  function render(){
    var el=document.getElementById('tz-ticker-items');if(!el)return;
    var ltz=Intl.DateTimeFormat().resolvedOptions().timeZone,h='';
    h+='<span class="tz-ticker-item"><span class="tz-ticker-item-label">You</span><span class="tz-ticker-item-value" style="font-weight:700">'+fmt(ltz)+'</span></span>';
    R.forEach(function(r){
      var s=st(r.t),dc=s==='active'?'tk-active':s==='ending'?'tk-ending':'tk-offline',vt;
      if(s==='active'){var ml=slp(r.t);vt=ml<180?'Active Â· ends '+dur(ml):'Active'}
      else if(s==='ending')vt='Ending Â· '+dur(slp(r.t));
      else vt='Online '+dur(wake(r.t));
      h+='<span class="tz-ticker-item"><span class="tz-ticker-dot '+dc+'"></span><span class="tz-ticker-item-label">'+r.l+'</span><span class="tz-ticker-item-value '+dc+'">'+vt+'</span></span>';
    });
    var w=bestWin(ltz),wt=w?w.time.split('(')[0].trim()+(w.count>=3?' Â· '+w.count+' regions':''): 'â€”';
    h+='<span class="tz-ticker-item"><span class="tz-ticker-item-label">Best window</span><span class="tz-ticker-item-value tk-window">'+wt+'</span></span>';
    el.innerHTML=h;
  }
  function init(){
    var hdr=document.querySelector('.site-header')||document.querySelector('header');
    document.documentElement.style.setProperty('--nav-h',(hdr?hdr.offsetHeight:56)+'px');
    window.addEventListener('resize',function(){var h2=document.querySelector('.site-header')||document.querySelector('header');document.documentElement.style.setProperty('--nav-h',(h2?h2.offsetHeight:56)+'px')});
    render();setInterval(render,30000);
  }
  document.readyState==='loading'?document.addEventListener('DOMContentLoaded',init):init();
})();
</script>
</body>
</html>
