<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SaaS / Fintech Unit Economics ¬∑ FP&A Portfolio</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    /* Prevent horizontal overflow */
    html, body { overflow-x: clip; }

    /* Module-specific styles */
    .module-hero {
      padding: 48px 0 32px 0;
      border-bottom: 1px solid var(--border);
    }
    .module-label {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.05em;
      margin-bottom: 12px;
    }
    .module-title {
      font-size: 36px;
      line-height: 1.1;
      letter-spacing: -0.03em;
      margin-bottom: 10px;
    }
    .module-pill {
      display: inline-flex;
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(246,248,251,0.8);
      color: var(--text);
      margin-bottom: 12px;
    }
    .module-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin-bottom: 16px;
    }
    .module-problem {
      font-size: 15px;
      color: var(--text);
      font-weight: 520;
      max-width: 68ch;
      margin-bottom: 12px;
    }
    .module-role {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 14px;
    }
    .feature-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 16px;
    }
    .chip {
      font-size: 12px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(246,248,251,0.8);
      color: var(--text);
    }
    
    /* Main layout with sidebar */
    .module-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      align-items: start;
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }
    
    /* Sticky sidebar */
    .sidebar {
      position: sticky;
      top: 80px;
      padding: 20px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
    }
    .sidebar-section {
      margin-bottom: 24px;
    }
    .sidebar-section:last-child {
      margin-bottom: 0;
    }
    .sidebar-title {
      font-size: 13px;
      font-weight: 650;
      color: var(--text);
      margin-bottom: 12px;
      letter-spacing: 0.03em;
    }
    .data-badge {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-weight: 600;
      display: inline-block;
      margin-bottom: 12px;
    }
    .data-badge.random {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      color: #92400e;
    }
    .sidebar-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    /* Scenario tabs in sidebar */
    .scenario-tabs {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .scenario-tab {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
    }
    .scenario-tab:hover {
      border-color: rgba(12, 23, 45, 0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .scenario-tab.active {
      background: var(--text);
      color: white;
      border-color: var(--text);
    }
    
    /* Main content area */
    .main-content {
      min-width: 0;
    }
    
    /* Module sections */
    .module-section {
      padding: 0 0 48px 0;
    }
    .module-section-title {
      font-size: 24px;
      margin-bottom: 20px;
      letter-spacing: -0.02em;
    }
    .module-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-soft);
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .card-title {
      font-size: 18px;
      font-weight: 650;
    }
    .card-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    /* Buttons */
    .btn-small {
      padding: 8px 14px;
      font-size: 13px;
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      transition: all 140ms ease;
      white-space: nowrap;
    }
    .btn-small:hover {
      border-color: rgba(12, 23, 45, 0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .btn-small:active {
      transform: translateY(1px);
    }
    .btn-primary {
      background: var(--text);
      color: white;
      border-color: var(--text);
    }
    .btn-primary:hover {
      box-shadow: 0 6px 18px rgba(11,18,32,0.12);
    }
    .btn-full {
      width: 100%;
      justify-content: center;
      display: flex;
    }
    
    /* KPI grid */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    .kpi-box {
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: rgba(246,248,251,0.6);
    }
    .kpi-box-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .kpi-box-value {
      font-size: 20px;
      font-weight: 650;
    }
    
    /* Tables */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin: 16px 0;
    }
    .data-table th {
      text-align: left;
      padding: 10px 12px;
      border-bottom: 2px solid var(--border);
      font-weight: 650;
      color: var(--text);
      font-size: 12px;
      letter-spacing: 0.02em;
    }
    .data-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    .data-table tr:last-child td {
      border-bottom: none;
    }
    .data-table tr:hover {
      background: rgba(246,248,251,0.5);
    }
    
    /* Charts - optimized for space */
    .chart-container {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: white;
      position: relative;
    }
    .chart-title {
      font-size: 14px;
      font-weight: 650;
      margin-bottom: 16px;
      color: var(--text);
    }
    .chart-wrapper {
      position: relative;
      width: 100%;
    }
    .chart-canvas {
      display: block;
      width: 100%;
      height: auto;
    }
    .chart-tooltip {
      position: absolute;
      background: rgba(11, 18, 32, 0.95);
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 150ms ease;
      z-index: 100;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .chart-tooltip.visible {
      opacity: 1;
    }
    .chart-tooltip strong {
      display: block;
      margin-bottom: 4px;
      font-size: 13px;
    }
    
    /* Input grid */
    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      margin-bottom: 20px;
    }
    .input-field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .input-field label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text);
    }
    .input-field input {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: var(--font-sans);
      background: white;
    }
    .input-field input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    /* Tooltips */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      border-bottom: 1px dotted var(--muted);
    }
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 8px 12px;
      background: var(--text);
      color: white;
      font-size: 12px;
      border-radius: 8px;
      white-space: nowrap;
      z-index: 100;
      margin-bottom: 6px;
    }
    
    /* Section header with tooltip */
    .section-header-with-help {
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      margin-bottom: 20px;
    }
    
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: rgba(15, 118, 110, 0.10);
      border: 1px solid rgba(15, 118, 110, 0.20);
      color: var(--accent);
      font-size: 13px;
      font-weight: 700;
      cursor: help;
      position: relative;
      flex-shrink: 0;
      margin-top: 2px; /* Fine-tune vertical alignment */
    }
    
    .help-icon::before {
      content: '?';
    }
    
    .help-icon:hover::after {
      content: attr(data-help);
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 8px;
      padding: 12px 16px;
      background: var(--text);
      color: white;
      font-size: 13px;
      line-height: 1.5;
      border-radius: 10px;
      white-space: normal;
      width: 320px;
      z-index: 1000;
      box-shadow: var(--shadow);
      font-weight: 400;
      text-align: left;
    }
    
    /* Inline term helper */
    .term-helper {
      position: relative;
      cursor: help;
      border-bottom: 1px dotted rgba(15, 118, 110, 0.4);
      color: var(--accent);
    }
    
    .term-helper:hover::after {
      content: attr(data-definition);
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 6px;
      padding: 10px 14px;
      background: var(--text);
      color: white;
      font-size: 12px;
      line-height: 1.5;
      border-radius: 8px;
      white-space: normal;
      width: 260px;
      z-index: 1000;
      box-shadow: var(--shadow);
      font-weight: 400;
    }
    
    /* Chart explanation */
    .chart-explanation {
      margin-top: 12px;
      padding: 10px 14px;
      background: rgba(15, 118, 110, 0.05);
      border-left: 3px solid var(--accent);
      border-radius: 6px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
    }
    
    .chart-explanation strong {
      color: var(--text);
      font-weight: 600;
    }
    
    /* File upload */
    .file-input-wrapper {
      position: relative;
      display: inline-block;
    }
    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    /* Demo section */
    .demo-section {
      padding: 32px 0;
      border-top: 1px solid var(--border);
    }
    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 14px;
    }
    .demo-card {
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: white;
    }
    .demo-card-title {
      font-size: 14px;
      font-weight: 650;
      margin-bottom: 8px;
    }
    .demo-card-text {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
    }
    
    /* Risk flags */
    .risk-flags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    .risk-flag {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(220, 38, 38, 0.10);
      border: 1px solid rgba(220, 38, 38, 0.20);
      color: #dc2626;
      font-weight: 600;
    }
    .risk-flag.ok {
      background: rgba(15, 118, 110, 0.10);
      border: 1px solid rgba(15, 118, 110, 0.20);
      color: var(--accent);
    }
    
    /* Sensitivity Table */
    .sensitivity-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 13px;
    }
    .sensitivity-table th {
      text-align: left;
      padding: 10px 12px;
      background: rgba(246,248,251,0.8);
      border: 1px solid var(--border);
      font-weight: 650;
      font-size: 12px;
      letter-spacing: 0.02em;
    }
    .sensitivity-table td {
      padding: 10px 12px;
      border: 1px solid var(--border);
      background: white;
    }
    .sensitivity-deterioration {
      color: #dc2626;
      font-weight: 600;
    }
    .sensitivity-improvement {
      color: #059669;
      font-weight: 600;
    }
    
    /* Cash & Runway Widget */
    .cash-widget {
      padding: 20px;
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.05) 0%, rgba(27, 77, 122, 0.05) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-top: 20px;
    }
    .cash-widget-title {
      font-size: 16px;
      font-weight: 650;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .runway-bar {
      height: 12px;
      background: rgba(220, 38, 38, 0.10);
      border-radius: 6px;
      overflow: hidden;
      margin: 12px 0;
      position: relative;
    }
    .runway-fill {
      height: 100%;
      background: linear-gradient(90deg, #059669 0%, #0f766e 50%, #dc2626 100%);
      transition: width 300ms ease;
    }
    .runway-months {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      margin: 8px 0;
    }
    .funding-warning {
      padding: 12px 16px;
      background: rgba(220, 38, 38, 0.10);
      border-left: 3px solid #dc2626;
      border-radius: 6px;
      margin-top: 12px;
      font-size: 13px;
      color: #dc2626;
      font-weight: 600;
    }
    .cash-generating {
      padding: 12px 16px;
      background: rgba(5, 150, 105, 0.10);
      border-left: 3px solid #059669;
      border-radius: 6px;
      margin-top: 12px;
      font-size: 13px;
      color: #059669;
      font-weight: 600;
    }
    
    /* Capital Efficiency Score */
    .efficiency-score-card {
      padding: 24px;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius);
      text-align: center;
      margin-top: 20px;
      min-height: 240px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .efficiency-score {
      font-size: 48px;
      font-weight: 700;
      line-height: 1;
      margin: 12px 0;
    }
    .efficiency-score.strong {
      color: #059669;
    }
    .efficiency-score.moderate {
      color: #d97706;
    }
    .efficiency-score.fragile {
      color: #dc2626;
    }
    .efficiency-rating {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.05em;
      margin-bottom: 12px;
    }
    .efficiency-interpretation {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
      max-width: 500px;
      margin: 0 auto;
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Integration Diagram */
    .integration-diagram {
      padding: 24px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-top: 20px;
    }
    .flow-step {
      padding: 16px;
      background: rgba(246,248,251,0.7);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
      position: relative;
    }
    .flow-step:last-child {
      margin-bottom: 0;
    }
    .flow-arrow {
      text-align: center;
      color: var(--accent);
      font-size: 20px;
      margin: 8px 0;
    }
    .flow-label {
      font-weight: 650;
      font-size: 14px;
      margin-bottom: 6px;
    }
    .flow-description {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
    }
    
    /* Strategic callout */
    .strategic-callout {
      padding: 20px;
      background: rgba(27, 77, 122, 0.05);
      border-left: 4px solid var(--accent-2);
      border-radius: 8px;
      margin: 20px 0;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text);
    }
    .strategic-callout strong {
      color: var(--accent-2);
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .module-layout {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: relative;
        top: 0;
      }
      .scenario-tabs {
        flex-direction: row;
      }
      .sidebar-buttons {
        flex-direction: row;
        flex-wrap: wrap;
      }
    }
    
    /* Board View Styles */
    .board-view-container {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow-soft);
      min-height: 520px;
    }
    
    .board-kpi-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .board-kpi-card {
      padding: 16px;
      background: rgba(246, 248, 251, 0.5);
      border: 1px solid var(--border);
      border-radius: 12px;
      text-align: center;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .board-kpi-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 8px;
      letter-spacing: 0.02em;
    }
    
    .board-kpi-value {
      font-size: 28px;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 6px;
      min-height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .board-kpi-value.strong {
      color: #059669;
    }
    
    .board-kpi-value.moderate {
      color: #d97706;
    }
    
    .board-kpi-value.fragile {
      color: #dc2626;
    }
    
    .board-kpi-value.cash-generating {
      color: #059669;
    }
    
    .board-kpi-value.near-breakeven {
      color: #d97706;
    }
    
    .board-kpi-value.normal-burn {
      color: var(--text);
    }
    
    .board-kpi-note {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.4;
      min-height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .board-narrative-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }
    
    .board-narrative-card {
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }
    
    .board-narrative-title {
      font-size: 13px;
      font-weight: 650;
      color: var(--text);
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    
    .board-narrative-content {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text);
      flex: 1;
      overflow-y: auto;
    }
    
    @media (max-width: 1024px) {
      .board-kpi-grid,
      .board-narrative-grid {
        grid-template-columns: 1fr;
      }
      
      .board-view-container {
        min-height: auto;
      }
      
      .board-kpi-card,
      .board-narrative-card {
        min-height: auto;
      }
    }
    
    /* Capital Allocation & Working Capital Styles */
    .allocation-results,
    .wc-results {
      transition: opacity 0.3s ease;
    }
    
    .allocation-results .strong,
    .wc-results .strong {
      color: #059669;
      font-weight: 600;
    }
    
    .allocation-results .moderate,
    .wc-results .moderate {
      color: #d97706;
      font-weight: 600;
    }
    
    .allocation-results .fragile,
    .wc-results .fragile {
      color: #dc2626;
      font-weight: 600;
    }

    /* ‚îÄ‚îÄ Standardized Decision Box ‚îÄ‚îÄ */
    .decision-box {
      border: 1.5px solid var(--accent, #0f766e);
      border-radius: 18px;
      padding: 20px 24px;
      margin-bottom: 24px;
      background: white;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.08), 0 8px 18px rgba(11,18,32,0.06);
      transition: border-color 200ms ease, box-shadow 200ms ease, background 200ms ease;
    }
    .decision-box--positive {
      border-color: #0f766e; background: #f0fdf9;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.10), 0 8px 18px rgba(11,18,32,0.06);
    }
    .decision-box--positive .decision-box-eyebrow { color: #0f766e; }
    .decision-box--positive .verdict-action        { color: #0f766e; }
    .decision-box--positive .decision-box-bullets li::before { color: #0f766e; }
    .decision-box--warning {
      border-color: #d97706; background: #fffbeb;
      box-shadow: 0 0 0 4px rgba(217,119,6,0.10), 0 8px 18px rgba(11,18,32,0.06);
    }
    .decision-box--warning .decision-box-eyebrow { color: #d97706; }
    .decision-box--warning .verdict-action        { color: #d97706; }
    .decision-box--warning .decision-box-bullets li::before { color: #d97706; }
    .decision-box--negative {
      border-color: #dc2626; background: #fef2f2;
      box-shadow: 0 0 0 4px rgba(220,38,38,0.10), 0 8px 18px rgba(11,18,32,0.06);
    }
    .decision-box--negative .decision-box-eyebrow { color: #dc2626; }
    .decision-box--negative .verdict-action        { color: #dc2626; }
    .decision-box--negative .decision-box-bullets li::before { color: #dc2626; }
    .decision-box-eyebrow {
      font-size: 11px; font-weight: 700; text-transform: uppercase;
      letter-spacing: 0.07em; color: #0f766e; margin-bottom: 8px;
    }
    .decision-box-verdict {
      font-size: 20px; font-weight: 700; letter-spacing: -0.02em;
      color: #0b1220; margin-bottom: 12px;
    }
    .decision-box-verdict .verdict-action { color: #0f766e; }
    .decision-box-bullets {
      list-style: none; margin: 0 0 10px 0; padding: 0;
      display: flex; flex-direction: column; gap: 6px;
    }
    .decision-box-bullets li {
      font-size: 13px; color: #5d6b7a;
      display: flex; align-items: flex-start; gap: 8px; line-height: 1.4;
    }
    .decision-box-bullets li::before {
      content: '‚Ä∫'; color: #0f766e; font-weight: 700; flex-shrink: 0;
    }
    .decision-box-next {
      font-size: 12px; font-weight: 600; color: #5d6b7a;
      border-top: 1px solid rgba(12,23,45,0.10); padding-top: 10px;
    }
    .decision-box-next span { color: #1b4d7a; }
  
    /* ‚îÄ‚îÄ Data-needed strip ‚îÄ‚îÄ */
    .data-needed-section {
      padding: 0 0 0 0;
      border-bottom: 1px solid var(--border, #e5e8ef);
    }
    .data-needed-wrap {
      max-width: var(--max-w, 1200px);
      margin: 0 auto;
      padding: 20px 32px 24px;
    }
    .data-needed-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--muted, #6b7280);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .data-needed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(185px, 1fr));
      gap: 8px;
    }
    .data-needed-item {
      padding: 10px 12px;
      border: 1px solid var(--border, #e5e8ef);
      border-radius: 9px;
      display: flex;
      align-items: flex-start;
      gap: 9px;
      background: #fafbfc;
    }
    .data-needed-icon {
      width: 26px;
      height: 26px;
      font-size: 13px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }
    .data-needed-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text, #0b1220);
      margin-bottom: 3px;
      line-height: 1.35;
    }
    .data-needed-desc {
      font-size: 10px;
      color: var(--muted, #6b7280);
      line-height: 1.5;
    }

</style>
</head>
<body>

  <a href="#main-content" class="skip-link">Skip to content</a>

  <!-- Header -->
  <header class="site-header">
    <div class="container">
      <nav class="nav" aria-label="Main navigation">
        <a href="index.html" class="brand">
          <span class="brand-mark" aria-hidden="true"></span>
          FP&A Portfolio
        </a>
        <div class="nav-cta">
          <a href="index.html#card-unit-economics" class="btn btn-ghost">‚Üê Back to Portfolio</a>
        </div>
      </nav>
    </div>
  </header>

  <main id="main-content">
    
    <!-- Hero -->
    <section class="module-hero">
      <div class="container">
        <div class="module-label">Growth & scalability</div>
        <h1 class="module-title">SaaS / Fintech Unit Economics</h1>
        <div class="module-pill">Unit economics</div>
        <p class="module-subtitle">Understanding growth, profitability, and scalability.</p>
        <p class="module-problem">Translate growth into margin and cash reality‚Äîso scale doesn't hide risk.</p>
        <p class="module-role">SaaS FP&A ‚Ä¢ Fintech Finance ‚Ä¢ Growth Analytics</p>
        <div class="feature-chips">
          <span class="chip">CAC / LTV</span>
          <span class="chip">Contribution margin</span>
          <span class="chip">Run-rate forecasting</span>
          <span class="chip">Scenario toggles</span>
        </div>
      </div>
    </section>

  <!-- DATA NEEDED STRIP -->
  <div class="data-needed-section">
    <div class="data-needed-wrap">
      <div class="data-needed-label">üìÇ &nbsp;Data needed for this module</div>
      <div class="data-needed-grid">
        <div class="data-needed-item"><div class="data-needed-icon" style="background:#eff6ff;">üí∏</div><div><div class="data-needed-name">CAC by Channel</div><div class="data-needed-desc">Marketing &amp; sales spend per channel vs. new customers won ‚Üí CAC</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f0fdf9;">üìÖ</div><div><div class="data-needed-name">Cohort Retention Data</div><div class="data-needed-desc">Monthly revenue retained per cohort ‚Üí LTV curve shape</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fef3c7;">üßæ</div><div><div class="data-needed-name">COGS Breakdown</div><div class="data-needed-desc">Direct costs to serve one customer ‚Üí contribution margin per unit</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f5f3ff;">üìä</div><div><div class="data-needed-name">P&L / Income Statement</div><div class="data-needed-desc">Revenue, gross margin &amp; OpEx ‚Üí payback &amp; profitability context</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fdf2f8;">üìà</div><div><div class="data-needed-name">Growth &amp; Churn Metrics</div><div class="data-needed-desc">Monthly new, churned &amp; expanded customers ‚Üí run-rate forecast</div></div></div>
      </div>
    </div>
  </div>

    <!-- Main Layout with Sidebar -->
    <div class="module-layout">
      
      <!-- Sticky Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-title">Data Mode</div>
          <div class="data-badge" id="dataModeBadge">Sample Data</div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-title">Actions</div>
          <div class="sidebar-buttons">
            <button onclick="useSampleData()" class="btn-small btn-full">Use Sample</button>
            <button onclick="randomizeAll()" class="btn-small btn-primary btn-full">üé≤ Randomize All</button>
            <button onclick="downloadAllTemplates()" class="btn-small btn-full">Download Templates</button>
          </div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-title">Scenario</div>
          <div class="scenario-tabs">
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="scenario-tab active" onclick="setScenario('base')" data-scenario="base" style="flex: 1;">Base Case</button>
              <span class="help-icon" id="baseScenarioHelp" data-help="Loading..." style="flex-shrink: 0;"></span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="scenario-tab" onclick="setScenario('upside')" data-scenario="upside" style="flex: 1;">Upside</button>
              <span class="help-icon" id="upsideScenarioHelp" data-help="Loading..." style="flex-shrink: 0;"></span>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <button class="scenario-tab" onclick="setScenario('downside')" data-scenario="downside" style="flex: 1;">Downside</button>
              <span class="help-icon" id="downsideScenarioHelp" data-help="Loading..." style="flex-shrink: 0;"></span>
            </div>
          </div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-title">Cash Controls</div>
          <div style="margin-bottom: 8px;">
            <label style="font-size: 12px; font-weight: 600; color: var(--muted); display: block; margin-bottom: 4px;">
              <span class="term-helper" data-definition="Starting Cash Balance: The amount of cash you have today before adding future profit or burn. Used to estimate runway and funding requirements.">Starting Cash</span> ($)
            </label>
            <input type="number" id="cashBalance" value="2400000" onchange="computeCashRunway(); renderBoardView(); computeCapitalAllocation(); computeWorkingCapital();" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="main-content">

        <!-- Board View - Executive Summary -->

          <!-- ‚îÄ‚îÄ Decision Box ‚îÄ‚îÄ -->
          <div class="decision-box" id="decisionBox">
            <div class="decision-box-eyebrow">Decision</div>
            <div id="decisionContent">
              <div class="decision-box-verdict" id="decisionVerdict">Load data to see the decision.</div>
              <ul class="decision-box-bullets" id="decisionBullets"></ul>
              <div class="decision-box-next" id="decisionNext"></div>
            </div>
          </div>
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title"><span class="term-helper" data-definition="Board View: Executive summary of your business's financial health, runway, and key priorities. Designed for quick board-level decision making without diving into detailed metrics.">Board View</span> ‚Äî Executive Summary</h2>
          </div>
          
          <div class="board-view-container">
            <!-- Headline KPIs -->
            <div class="board-kpi-grid">
              <div class="board-kpi-card">
                <div class="board-kpi-label"><span class="term-helper" data-definition="Capital Health: Overall assessment of your unit economics and capital efficiency. Strong means you create more value than you consume. Fragile means growth requires significant external capital.">Capital Health</span></div>
                <div class="board-kpi-value" id="boardCapitalHealth">‚Äî</div>
                <div class="board-kpi-note" id="boardCapitalNote"></div>
              </div>
              
              <div class="board-kpi-card">
                <div class="board-kpi-label"><span class="term-helper" data-definition="Runway: Number of months your business can operate before depleting cash reserves at the current burn rate. Critical for planning fundraising timing and managing liquidity risk.">Runway</span></div>
                <div class="board-kpi-value" id="boardRunway">‚Äî</div>
                <div class="board-kpi-note" id="boardRunwayDate"></div>
              </div>
              
              <div class="board-kpi-card">
                <div class="board-kpi-label"><span class="term-helper" data-definition="Funding Requirement: Amount of capital needed to extend runway to a healthy 12+ months. Zero means you're already well-funded or profitable. Higher amounts indicate urgent fundraising needs.">Funding Requirement</span></div>
                <div class="board-kpi-value" id="boardFundingGap">‚Äî</div>
                <div class="board-kpi-note" id="boardFundingNote"></div>
              </div>
            </div>
            
            <!-- Executive Narrative -->
            <div class="board-narrative-grid">
              <div class="board-narrative-card">
                <div class="board-narrative-title"><span class="term-helper" data-definition="Primary Risk: The most critical financial risk facing your business right now based on current metrics. This is where management attention should focus first.">Primary Risk</span></div>
                <div class="board-narrative-content" id="boardRisk">‚Äî</div>
              </div>
              
              <div class="board-narrative-card">
                <div class="board-narrative-title"><span class="term-helper" data-definition="Top Levers: The 1-2 most impactful actions you can take to improve unit economics and capital efficiency. These are prioritized based on your current weak points.">Top Levers</span></div>
                <div class="board-narrative-content" id="boardLevers">‚Äî</div>
              </div>
              
              <div class="board-narrative-card">
                <div class="board-narrative-title"><span class="term-helper" data-definition="Recommendation: Plain-English strategic guidance based on your current financial position. Tells you whether to prioritize efficiency, scale cautiously, or invest in growth.">Recommendation</span></div>
                <div class="board-narrative-content" id="boardRecommendation">‚Äî</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Capital Allocation: Growth Investment Scenario -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title"><span class="term-helper" data-definition="Capital Allocation: Evaluate the financial impact of a proposed growth investment. Helps determine if incremental spending creates or destroys value based on your unit economics.">Capital Allocation</span> ‚Äî Growth Investment Scenario</h2>
          </div>
          
          <div class="module-card">
            <p style="font-size: 13px; color: var(--muted); margin-bottom: 16px;">
              Model the operational impact of a growth investment without complex valuation math. Focused on payback and runway impact.
            </p>
            
            <div class="input-grid" style="grid-template-columns: repeat(2, 1fr);">
              <div class="input-field">
                <label><span class="term-helper" data-definition="Growth Investment: One-time or staged capital deployment for expansion. Examples: hiring sales team, launching new market, building product feature.">Growth Investment</span> ($)</label>
                <input type="number" id="growthInvestment" value="500000" onchange="computeCapitalAllocation()">
              </div>
              <div class="input-field">
                <label><span class="term-helper" data-definition="Expected New Customers: Incremental customers from this investment over the measurement period (typically 12 months).">Expected New Customers</span></label>
                <input type="number" id="expectedNewCustomers" value="250" onchange="computeCapitalAllocation()">
              </div>
            </div>
            
            <!-- Results Display -->
            <div class="allocation-results" id="allocationResults" style="margin-top: 20px;">
              <!-- Populated by JS -->
            </div>
          </div>
        </section>

        <!-- Working Capital Impact -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title"><span class="term-helper" data-definition="Working Capital: Cash tied up between spending money and collecting it. Includes AR (money owed to you), AP (money you owe), and deferred revenue (cash received but not yet earned).">Working Capital</span> ‚Äî Cash Flow Timing Impact</h2>
          </div>
          
          <div class="module-card">
            <p style="font-size: 13px; color: var(--muted); margin-bottom: 16px;">
              Simple approximation for planning purposes. Not a full balance sheet model.
            </p>
            
            <div class="input-grid" style="grid-template-columns: repeat(3, 1fr);">
              <div class="input-field">
                <label><span class="term-helper" data-definition="AR Days: Average time customers take to pay. Higher AR days delays cash collection. Typical SaaS: 30-60 days.">AR Days</span></label>
                <input type="number" id="arDays" value="45" onchange="computeWorkingCapital()">
              </div>
              <div class="input-field">
                <label><span class="term-helper" data-definition="AP Days: Average time you take to pay vendors. Higher AP days keeps cash longer. Typical: 30-60 days.">AP Days</span></label>
                <input type="number" id="apDays" value="30" onchange="computeWorkingCapital()">
              </div>
              <div class="input-field">
                <label><span class="term-helper" data-definition="Deferred Revenue %: Cash collected before service is delivered. Higher % can improve near-term cash. Common in SaaS with annual contracts.">Deferred Revenue</span> (%)</label>
                <input type="number" step="1" id="deferredRevPct" value="40" onchange="computeWorkingCapital()">
              </div>
            </div>
            
            <!-- Results Display -->
            <div class="wc-results" id="wcResults" style="margin-top: 20px;">
              <!-- Populated by JS -->
            </div>
          </div>
        </section>

        <!-- CAC / LTV Engine -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title">1. CAC / LTV Engine</h2>
            <span class="help-icon" data-help="CAC/LTV measures how much it costs to acquire a customer versus how much revenue they generate over their lifetime. It's crucial for understanding if your growth is profitable and sustainable. A healthy ratio is 3:1 or higher (LTV is 3x greater than CAC)."></span>
          </div>
          
          <div class="module-card">
            <div class="card-header">
              <h3 class="card-title">Customer Acquisition Economics</h3>
              <div class="card-actions">
                <button onclick="downloadCACLTVCSV()" class="btn-small">Export Results</button>
                <button onclick="downloadCACLTVTemplate()" class="btn-small">Download Template</button>
                <div class="file-input-wrapper">
                  <button class="btn-small btn-primary">Upload CSV</button>
                  <input type="file" id="cacLtvUpload" accept=".csv" onchange="handleCACLTVUpload(event)">
                </div>
              </div>
            </div>

            <div class="input-grid">
              <div class="input-field">
                <label>New Customers Acquired</label>
                <input type="number" id="newCustomers" value="120" onchange="computeCACLTV()">
              </div>
              <div class="input-field">
                <label>Marketing Spend ($)</label>
                <input type="number" id="marketingSpend" value="48000" onchange="computeCACLTV()">
              </div>
              <div class="input-field">
                <label>Sales Spend ($)</label>
                <input type="number" id="salesSpend" value="72000" onchange="computeCACLTV()">
              </div>
              <div class="input-field">
                <label>ARPA ($/customer/month)</label>
                <input type="number" id="arpa" value="120" onchange="computeCACLTV()">
              </div>
              <div class="input-field">
                <label>Gross Margin (%)</label>
                <input type="number" step="0.1" id="grossMargin" value="72" onchange="computeCACLTV()">
              </div>
              <div class="input-field">
                <label>Monthly Churn (%)</label>
                <input type="number" step="0.1" id="churnRate" value="3.5" onchange="computeCACLTV()">
              </div>
            </div>

            <div class="kpi-grid" id="cacLtvKPIs">
              <!-- KPIs populated by JS -->
            </div>
            
            <!-- Capital Efficiency & Sensitivity Section - Fixed height to prevent layout shift -->
            <div style="min-height: 550px;">
              <!-- Capital Efficiency Score -->
              <div class="efficiency-score-card" id="efficiencyScore">
                <!-- Populated by JS -->
              </div>
              
              <!-- Payback Sensitivity Analysis -->
              <div style="margin-top: 24px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                  <h3 style="font-size: 16px; font-weight: 650; margin: 0;">
                    <span class="term-helper" data-definition="Sensitivity analysis tests how much an outcome changes when one assumption moves slightly. It reveals which assumptions are most critical and where your model is most fragile.">Payback Sensitivity</span> ‚Äî Stress Testing Assumptions
                  </h3>
                  <span class="help-icon" data-help="These scenarios test common real-world shocks that directly impact payback: Churn +1% (retention risk), Gross Margin -5% (unit economics pressure), and ARPA -10% (revenue quality).

Why these values? Churn +1pp is a typical retention slip. Gross margin -5pp reflects cost pressure from vendor price increases or infrastructure scaling. ARPA -10% models competitive pricing pressure or customer downgrades." style="margin-left: auto;"></span>
                </div>
                <div style="overflow-x:auto;"><table class="sensitivity-table" id="sensitivityTable">
                  <!-- Populated by JS -->
                </table></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Contribution Margin -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title">2. Contribution Margin Analysis</h2>
            <span class="help-icon" data-help="Contribution Margin shows how much profit each sale generates after covering variable costs (like hosting, support, transaction fees). It's the money available to cover fixed costs and generate profit. Higher contribution margin means better unit economics and faster path to profitability."></span>
          </div>
          
          <div class="module-card">
            <div class="card-header">
              <h3 class="card-title">Monthly Contribution</h3>
              <div class="card-actions">
                <button onclick="downloadContributionCSV()" class="btn-small">Export Data</button>
                <button onclick="downloadContributionTemplate()" class="btn-small">Download Template</button>
                <div class="file-input-wrapper">
                  <button class="btn-small btn-primary">Upload CSV</button>
                  <input type="file" id="contributionUpload" accept=".csv" onchange="handleContributionUpload(event)">
                </div>
              </div>
            </div>

            <div class="chart-container">
              <div class="chart-title">Contribution Margin Trend</div>
              <div class="chart-wrapper">
                <canvas id="contributionChart" class="chart-canvas"></canvas>
                <div class="chart-tooltip" id="contributionTooltip"></div>
              </div>
              <div class="chart-explanation" id="cmChartExplanation">
                <!-- Dynamic explanation populated by JavaScript -->
              </div>
            </div>

            <div style="overflow-x:auto;"><table class="data-table" id="contributionTable">
              <!-- Table populated by JS -->
            </table></div>
          </div>
        </section>

        <!-- Run-rate Forecasting -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title">3. Run-rate Forecasting</h2>
            <span class="help-icon" data-help="Run-rate Forecasting projects your monthly recurring revenue (MRR) and customer growth based on current trends. It answers 'Where will we be in 12 months if we keep growing at this pace?' Essential for planning resources, fundraising, and setting realistic targets."></span>
          </div>
          
          <div class="module-card">
            <div class="card-header">
              <h3 class="card-title">Forward Projection</h3>
              <div class="card-actions">
                <button onclick="downloadRunrateCSV()" class="btn-small">Export Forecast</button>
                <button onclick="downloadRunrateTemplate()" class="btn-small">Download Template</button>
                <div class="file-input-wrapper">
                  <button class="btn-small btn-primary">Upload CSV</button>
                  <input type="file" id="runrateUpload" accept=".csv" onchange="handleRunrateUpload(event)">
                </div>
              </div>
            </div>

            <div class="kpi-grid" id="runrateKPIs">
              <!-- KPIs populated by JS -->
            </div>

            <div class="risk-flags" id="riskFlags">
              <!-- Risk flags populated by JS -->
            </div>

            <div class="chart-container">
              <div class="chart-title">MRR & Customer Projection</div>
              <div class="chart-wrapper">
                <canvas id="runrateChart" class="chart-canvas"></canvas>
                <div class="chart-tooltip" id="runrateTooltip"></div>
              </div>
            </div>

            <div style="overflow-x:auto;"><table class="data-table" id="runrateTable">
              <!-- Table populated by JS -->
            </table></div>
          </div>
        </section>

        <!-- Cash & Runway Impact -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title">4. Cash & Runway Impact</h2>
            <span class="help-icon" data-help="Runway analysis connects your growth metrics to enterprise survival. It shows how many months you can operate before running out of cash, helping you plan fundraising timing and make capital allocation decisions."></span>
          </div>
          
          <div class="module-card">
            <div class="card-header">
              <h3 class="card-title">Liquidity & Survival Analysis</h3>
            </div>

            <div class="cash-widget" id="cashWidget">
              <!-- Populated by JS -->
            </div>
            
            <div class="strategic-callout">
              <strong>Strategic Implication:</strong> Understanding runway is critical for capital allocation decisions. If runway < 12 months, growth initiatives compete with survival. If runway > 24 months, you can invest aggressively in scaling.
            </div>
          </div>
        </section>

        <!-- Enterprise Integration -->
        <section class="module-section">
          <div class="section-header-with-help">
            <h2 class="module-section-title">5. Integration Into Enterprise Financial Model</h2>
            <span class="help-icon" data-help="This shows how unit economics flows into your company's overall financial model. Every metric here has downstream impacts on revenue forecasts, operating budgets, and cash planning."></span>
          </div>
          
          <div class="module-card">
            <p style="font-size: 14px; color: var(--muted); margin-bottom: 20px;">
              Unit economics doesn't live in isolation. Each metric feeds into enterprise-level planning and decision-making.
            </p>
            
            <div class="integration-diagram">
              <div class="flow-step">
                <div class="flow-label">
                  <span class="term-helper" data-definition="CAC (Customer Acquisition Cost) flows directly into your operating expense budget as Sales & Marketing spend. This impacts your OpEx forecast and EBITDA.">CAC</span> ‚Üí Operating Expense
                </div>
                <div class="flow-description">
                  Customer acquisition costs flow into Sales & Marketing budgets. Rising CAC increases <span class="term-helper" data-definition="OpEx: Operating Expenses - all the costs of running your business excluding cost of goods sold.">OpEx</span> and pressures <span class="term-helper" data-definition="EBITDA: Earnings Before Interest, Taxes, Depreciation, and Amortization - a measure of operating profitability.">EBITDA</span> margins.
                </div>
              </div>
              
              <div class="flow-arrow">‚Üì</div>
              
              <div class="flow-step">
                <div class="flow-label">
                  <span class="term-helper" data-definition="Churn: The percentage of customers who cancel each month. High churn erodes revenue growth and makes growth expensive.">Churn</span> ‚Üí Revenue Forecast
                </div>
                <div class="flow-description">
                  Monthly churn directly reduces <span class="term-helper" data-definition="ARR: Annual Recurring Revenue - the predictable revenue you can expect over the next 12 months from current subscriptions.">ARR</span> growth. A 5% churn rate means you lose 5% of your revenue base every month, requiring constant new customer acquisition just to maintain revenue.
                </div>
              </div>
              
              <div class="flow-arrow">‚Üì</div>
              
              <div class="flow-step">
                <div class="flow-label">
                  <span class="term-helper" data-definition="Payback Period: How long it takes to recover customer acquisition costs through gross profit. Critical for cash planning.">Payback</span> ‚Üí Cash Flow Timing
                </div>
                <div class="flow-description">
                  Longer payback periods create working capital needs. If payback is 18 months but you're growing 10% monthly, you need external capital to fund the <span class="term-helper" data-definition="Working Capital: The cash tied up in your business operations between spending money (CAC) and getting it back (subscription revenue).">working capital</span> gap.
                </div>
              </div>
              
              <div class="flow-arrow">‚Üì</div>
              
              <div class="flow-step">
                <div class="flow-label">
                  <span class="term-helper" data-definition="Burn: How much cash you're consuming each month. Negative burn (profit) means you're generating cash. Positive burn means you're spending more than you earn.">Burn</span> ‚Üí Balance Sheet & Capital Needs
                </div>
                <div class="flow-description">
                  Monthly burn determines how much cash you need on the balance sheet. High burn with long payback means frequent fundraising. Low burn with short payback enables organic growth without dilution.
                </div>
              </div>
            </div>
            
            <div class="strategic-callout" style="margin-top: 20px;">
              <strong>CFO Takeaway:</strong> Unit economics is the engine that drives the entire financial model. Improving LTV:CAC by 20% doesn't just make sales more efficient‚Äîit reduces OpEx, extends runway, delays the next fundraise, and improves company valuation by demonstrating capital efficiency.
            </div>
            
            <div class="strategic-callout" style="margin-top: 24px;">
              <strong>Scope Note:</strong> This module focuses on SaaS unit economics and cash runway. It does not fully model <span class="term-helper" data-definition="Working Capital: The cash tied up between spending money (like paying vendors or acquiring customers) and collecting it (like customer payments). Includes AR, AP, deferred revenue, and inventory timing.">working capital</span> schedules such as:
              <ul style="margin: 8px 0 0 20px; line-height: 1.8;">
                <li><span class="term-helper" data-definition="AR: Accounts Receivable - money customers owe you but haven't paid yet. Common in B2B SaaS with annual contracts invoiced upfront.">AR (Accounts Receivable)</span> timing and collection</li>
                <li><span class="term-helper" data-definition="Deferred Revenue: Cash received from customers that you haven't yet earned (future service delivery). Common in SaaS with annual prepayments. This is a liability on the balance sheet.">Deferred Revenue</span> unwinding</li>
                <li><span class="term-helper" data-definition="AP: Accounts Payable - money you owe vendors but haven't paid yet. Managing AP timing (paying later while collecting AR faster) helps optimize cash flow.">AP (Accounts Payable)</span> payment timing</li>
                <li><span class="term-helper" data-definition="Inventory: Physical goods held for sale. Not applicable to pure SaaS, but critical for hardware/physical product companies.">Inventory</span> (not applicable to SaaS)</li>
              </ul>
              <div style="margin-top: 12px; font-size: 13px; color: var(--muted);">
                <strong style="color: var(--text);">Future Enhancement:</strong> Full working capital modeling would connect billing cycles, payment terms, and cash conversion cycles to provide a more complete liquidity picture.
              </div>
            </div>
          </div>
        </section>

        <!-- What This Demonstrates -->
        <section class="demo-section">
          <h2 class="module-section-title">What This Demonstrates</h2>
          <div class="demo-grid">
            <div class="demo-card">
              <div class="demo-card-title">Growth Analytics That Doesn't Lie</div>
              <div class="demo-card-text">
                Moving beyond vanity metrics to understand true unit profitability, payback dynamics, and sustainable scaling models.
              </div>
            </div>
            <div class="demo-card">
              <div class="demo-card-title">Finance-Grade Unit Economics</div>
              <div class="demo-card-text">
                CAC/LTV with churn sensitivity, contribution margin decomposition, and run-rate forecasting built for decision-making.
              </div>
            </div>
            <div class="demo-card">
              <div class="demo-card-title">Scenario-Driven Risk Visibility</div>
              <div class="demo-card-text">
                Instant upside/downside modeling with risk flagging for churn spikes, negative CM, and extended payback periods.
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>

  
  <!-- ‚îÄ‚îÄ Next Module ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <nav class="next-module-bar" aria-label="Next recommended module">
    <div>
      <div class="next-module-label">Next recommended</div>
      <div class="next-module-title">Working Capital FP&amp;A</div>
      <div class="next-module-why">Unit economics look good ‚Äî now see how collections, payables and inventory affect your cash.</div>
    </div>
    <div class="next-module-actions">
      <a class="btn btn-solid" href="working-capital.html">Open Working Capital ‚Üí</a>
      <a class="btn btn-ghost" href="index.html">‚Üê Back to Portfolio</a>
    </div>
  </nav>

</main>

  <a href="#" class="to-top" aria-label="Back to top">‚Üë</a>

  <script src="./main.js"></script>
  <script>
    /* =========================================
       Unit Economics - JavaScript
       Optimized charts with smart label positioning
       ========================================= */

    // ========== GLOBAL STATE ==========
    
    let currentScenario = 'base';
    let dataMode = 'sample';
    
    // Immutable sample assumptions - always restore from this
    const SAMPLE_ASSUMPTIONS = {
      base: { newCustomers: 120, marketingSpend: 48000, salesSpend: 72000, arpa: 120, grossMargin: 72, churnRate: 3.5 },
      upside: { newCustomers: 180, marketingSpend: 48000, salesSpend: 72000, arpa: 135, grossMargin: 75, churnRate: 2.8 },
      downside: { newCustomers: 80, marketingSpend: 48000, salesSpend: 72000, arpa: 105, grossMargin: 68, churnRate: 5.2 }
    };
    
    let cacLtvInputs = {
      base: { ...SAMPLE_ASSUMPTIONS.base },
      upside: { ...SAMPLE_ASSUMPTIONS.upside },
      downside: { ...SAMPLE_ASSUMPTIONS.downside }
    };
    
    let contributionData = { base: [], upside: [], downside: [] };
    let runrateData = { base: [], upside: [], downside: [] };
    let contributionChartPoints = [];
    let runrateChartPoints = [];
    
    // ========== UTILITY FUNCTIONS ==========
    
    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    
    function randFloat(min, max) {
      return Math.random() * (max - min) + min;
    }
    
    function clamp(val, min, max) {
      return Math.max(min, Math.min(max, val));
    }
    
    function formatCurrency(val) {
      return '$' + Math.round(val).toLocaleString();
    }
    
    function formatPercent(val) {
      return val.toFixed(1) + '%';
    }
    
    // ========== CSV PARSING ==========
    
    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
      const data = [];
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
        const row = {};
        headers.forEach((h, idx) => {
          row[h] = values[idx] || '';
        });
        data.push(row);
      }
      return { headers, data };
    }
    
    function validateHeaders(actual, required) {
      return required.every(h => actual.includes(h));
    }
    
    function downloadCSV(filename, headers, rows) {
      let csv = headers.join(',') + '\n';
      rows.forEach(row => {
        csv += headers.map(h => row[h] !== undefined ? row[h] : '').join(',') + '\n';
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
    }
    
    // ========== SCENARIO MANAGEMENT ==========
    
    function setScenario(scenario) {
      currentScenario = scenario;
      document.querySelectorAll('.scenario-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.scenario === scenario);
      });
      loadScenarioInputs();
      renderAll();
    }
    
    function loadScenarioInputs() {
      const inputs = cacLtvInputs[currentScenario];
      document.getElementById('newCustomers').value = inputs.newCustomers;
      document.getElementById('marketingSpend').value = inputs.marketingSpend;
      document.getElementById('salesSpend').value = inputs.salesSpend;
      document.getElementById('arpa').value = inputs.arpa;
      document.getElementById('grossMargin').value = inputs.grossMargin;
      document.getElementById('churnRate').value = inputs.churnRate;
    }
    
    function saveScenarioInputs() {
      cacLtvInputs[currentScenario] = {
        newCustomers: parseFloat(document.getElementById('newCustomers').value) || 0,
        marketingSpend: parseFloat(document.getElementById('marketingSpend').value) || 0,
        salesSpend: parseFloat(document.getElementById('salesSpend').value) || 0,
        arpa: parseFloat(document.getElementById('arpa').value) || 0,
        grossMargin: parseFloat(document.getElementById('grossMargin').value) || 0,
        churnRate: parseFloat(document.getElementById('churnRate').value) || 0
      };
    }
    
    // ========== DATA INITIALIZATION ==========
    
    function initializeSampleData() {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      ['base', 'upside', 'downside'].forEach(scenario => {
        contributionData[scenario] = months.map((month, i) => {
          const baseMult = scenario === 'upside' ? 1.15 : scenario === 'downside' ? 0.85 : 1.0;
          const revenue = (80000 + i * 5000) * baseMult;
          const cogs = revenue * (scenario === 'upside' ? 0.22 : scenario === 'downside' ? 0.35 : 0.28);
          const paymentFees = revenue * 0.025;
          const supportCost = (500 + i * 50) * baseMult;
          const infraCost = (300 + i * 30) * baseMult;
          return { month, revenue, cogs, paymentFees, supportCost, infraCost };
        });
      });
      
      ['base', 'upside', 'downside'].forEach(scenario => {
        const baseCustomers = scenario === 'upside' ? 450 : scenario === 'downside' ? 280 : 350;
        const baseMRR = scenario === 'upside' ? 52000 : scenario === 'downside' ? 32000 : 42000;
        const baseChurn = scenario === 'upside' ? 2.5 : scenario === 'downside' ? 5.5 : 3.8;
        const baseExpansion = scenario === 'upside' ? 2.2 : scenario === 'downside' ? 0.8 : 1.5;
        const baseGM = scenario === 'upside' ? 76 : scenario === 'downside' ? 65 : 71;
        const baseOpEx = scenario === 'upside' ? 180000 : scenario === 'downside' ? 220000 : 200000;
        
        runrateData[scenario] = [];
        for (let i = 0; i < 24; i++) {
          const customers = baseCustomers + i * (scenario === 'upside' ? 22 : scenario === 'downside' ? 8 : 15);
          const mrr = baseMRR + i * (scenario === 'upside' ? 6500 : scenario === 'downside' ? 2200 : 4500);
          const expansion = baseExpansion + (i * 0.03);
          const churn = baseChurn - (i * 0.015);
          const gm = baseGM + (i * 0.1);
          const opex = baseOpEx + (i * 2000);
          runrateData[scenario].push({
            month: i + 1,
            customers: Math.round(customers),
            mrr: Math.round(mrr),
            expansion,
            churn: Math.max(1.0, churn),
            gm: Math.min(88, gm),
            opex: Math.round(opex)
          });
        }
      });
    }
    
    function useSampleData() {
      dataMode = 'sample';
      document.getElementById('dataModeBadge').textContent = 'Sample Data';
      document.getElementById('dataModeBadge').classList.remove('random');
      
      // HARD RESET: Restore cacLtvInputs from immutable constant
      cacLtvInputs = {
        base: { ...SAMPLE_ASSUMPTIONS.base },
        upside: { ...SAMPLE_ASSUMPTIONS.upside },
        downside: { ...SAMPLE_ASSUMPTIONS.downside }
      };
      
      // Restore all contribution and runrate data
      initializeSampleData();
      
      // Reload inputs into UI
      loadScenarioInputs();
      
      // Refresh all KPIs/charts/tables
      renderAll();
    }
    
    function randomizeAll() {
      dataMode = 'random';
      document.getElementById('dataModeBadge').textContent = 'Randomized Data';
      document.getElementById('dataModeBadge').classList.add('random');
      
      ['base', 'upside', 'downside'].forEach(scenario => {
        const mult = scenario === 'upside' ? 1.15 : scenario === 'downside' ? 0.85 : 1.0;
        cacLtvInputs[scenario] = {
          newCustomers: Math.round(randInt(80, 200) * mult),
          marketingSpend: Math.round(randInt(30000, 80000) * mult),
          salesSpend: Math.round(randInt(40000, 100000) * mult),
          arpa: Math.round(randFloat(80, 180) * mult),
          grossMargin: clamp(randFloat(62, 78) * (scenario === 'upside' ? 1.05 : scenario === 'downside' ? 0.93 : 1.0), 55, 88),
          churnRate: clamp(randFloat(2.5, 6.5) * (scenario === 'upside' ? 0.75 : scenario === 'downside' ? 1.3 : 1.0), 1.5, 9)
        };
      });
      
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      ['base', 'upside', 'downside'].forEach(scenario => {
        const mult = scenario === 'upside' ? 1.2 : scenario === 'downside' ? 0.8 : 1.0;
        let prevRev = randInt(60000, 100000) * mult;
        contributionData[scenario] = months.map((month, i) => {
          const revenue = prevRev * randFloat(1.02, 1.08);
          prevRev = revenue;
          const cogs = revenue * randFloat(0.20, 0.35);
          const paymentFees = revenue * randFloat(0.015, 0.030);
          const supportCost = randInt(400, 1200) * mult;
          const infraCost = randInt(250, 900) * mult;
          return { month, revenue, cogs, paymentFees, supportCost, infraCost };
        });
      });
      
      ['base', 'upside', 'downside'].forEach(scenario => {
        const mult = scenario === 'upside' ? 1.25 : scenario === 'downside' ? 0.75 : 1.0;
        let customers = randInt(250, 450) * mult;
        let mrr = randInt(30000, 60000) * mult;
        let churn = randFloat(2.5, 6.5) * (scenario === 'upside' ? 0.7 : scenario === 'downside' ? 1.4 : 1.0);
        let gm = randFloat(65, 78) * (scenario === 'upside' ? 1.05 : scenario === 'downside' ? 0.92 : 1.0);
        
        runrateData[scenario] = [];
        for (let i = 0; i < 24; i++) {
          customers = customers * randFloat(1.02, 1.06);
          mrr = mrr * randFloat(1.03, 1.07);
          churn = clamp(churn + randFloat(-0.15, 0.15), 1.5, 9);
          gm = clamp(gm + randFloat(-0.3, 0.3), 55, 88);
          const expansion = randFloat(0.5, 3.0);
          const opex = randInt(150000, 300000) * mult;
          
          runrateData[scenario].push({
            month: i + 1,
            customers: Math.round(customers),
            mrr: Math.round(mrr),
            expansion,
            churn,
            gm,
            opex
          });
        }
      });
      
      loadScenarioInputs();
      renderAll();
    }
    
    // ========== CAPITAL EFFICIENCY EVALUATOR (Centralized) ==========
    
    /**
     * Centralized capital efficiency scoring function
     * Returns consistent scoring across all views (CAC/LTV card, Board View, etc.)
     * 
     * Thresholds (Director-level standards):
     * - LTV:CAC: >=4 strong, >=3 moderate, <3 weak
     * - Payback: <=12 strong, <=18 moderate, >18 weak  
     * - Gross Margin: >=70 strong, >=60 moderate, <60 weak
     * 
     * Weighting: 40% LTV:CAC, 30% Payback, 30% Gross Margin
     */
    function evaluateCapitalEfficiency({ ltvToCac, paybackMonths, grossMargin }) {
      let score = 0;
      let ltvScore = 0;
      let paybackScore = 0;
      let marginScore = 0;
      
      // Factor 1: LTV:CAC Ratio (0-40 points)
      if (ltvToCac >= 4) {
        ltvScore = 40;
      } else if (ltvToCac >= 3) {
        ltvScore = 30;
      } else if (ltvToCac >= 2) {
        ltvScore = 20;
      } else if (ltvToCac >= 1) {
        ltvScore = 10;
      }
      
      // Factor 2: Payback Period (0-30 points)
      if (paybackMonths <= 6) {
        paybackScore = 30;
      } else if (paybackMonths <= 12) {
        paybackScore = 25;
      } else if (paybackMonths <= 18) {
        paybackScore = 15;
      } else if (paybackMonths <= 24) {
        paybackScore = 5;
      }
      
      // Factor 3: Gross Margin (0-30 points)
      if (grossMargin >= 70) {
        marginScore = 30;
      } else if (grossMargin >= 60) {
        marginScore = 20;
      } else if (grossMargin >= 55) {
        marginScore = 10;
      }
      
      score = ltvScore + paybackScore + marginScore;
      
      // Determine rating
      let rating = '';
      let interpretation = '';
      
      if (score >= 75) {
        rating = 'Strong';
        interpretation = 'Your growth creates significantly more value than it consumes. You can scale efficiently without requiring constant external capital. Investors see this as a compounding machine.';
      } else if (score >= 50) {
        rating = 'Moderate';
        interpretation = 'Your unit economics support sustainable growth, but you\'ll need periodic capital injections to fund expansion. Focus on improving either LTV (reduce churn, increase ARPA) or CAC (improve conversion rates).';
      } else {
        rating = 'Fragile';
        interpretation = 'Growth requires significant external capital to sustain. Each new customer consumes more cash than it generates in the short term. You must either improve unit economics or secure substantial funding before scaling aggressively.';
      }
      
      return {
        score,
        rating,
        interpretation,
        breakdown: {
          ltvScore,
          paybackScore,
          marginScore
        }
      };
    }
    
    // ========== CAC/LTV FUNCTIONS ==========
    
    function computeCACLTV() {
      saveScenarioInputs();
      const inputs = cacLtvInputs[currentScenario];
      
      const cac = (inputs.marketingSpend + inputs.salesSpend) / inputs.newCustomers;
      const ltv = (inputs.arpa * (inputs.grossMargin / 100)) / (inputs.churnRate / 100);
      const ratio = ltv / cac;
      const payback = cac / (inputs.arpa * (inputs.grossMargin / 100));
      
      document.getElementById('cacLtvKPIs').innerHTML = `
        <div class="kpi-box">
          <div class="kpi-box-label"><span class="term-helper" data-definition="Customer Acquisition Cost: The total cost (marketing + sales expenses) divided by number of new customers. Think of it as: 'How much did we spend to get one new customer?'">CAC</span></div>
          <div class="kpi-box-value">${formatCurrency(cac)}</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label"><span class="term-helper" data-definition="Lifetime Value: The total profit a customer generates over their entire relationship with you. Calculated as: monthly revenue per customer √ó gross margin √∑ churn rate. Basically: 'How much money will this customer make us?'">LTV</span></div>
          <div class="kpi-box-value">${formatCurrency(ltv)}</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label"><span class="term-helper" data-definition="LTV:CAC Ratio: How many times more value a customer generates compared to what it cost to acquire them. A 3:1 ratio means customers are worth 3x what you spent to get them. Higher is better! Under 3x is risky.">LTV:CAC Ratio</span></div>
          <div class="kpi-box-value">${ratio.toFixed(1)}x</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label"><span class="term-helper" data-definition="Payback Period: How many months it takes to recover the cost of acquiring a customer through their monthly profit contribution. Example: If CAC is $1,200 and monthly profit is $100, payback is 12 months. Shorter is better!">Payback Period</span></div>
          <div class="kpi-box-value">${payback.toFixed(1)} mo</div>
        </div>
      `;
      
      // === CAPITAL EFFICIENCY SCORE (using centralized evaluator) ===
      const efficiency = evaluateCapitalEfficiency({
        ltvToCac: ratio,
        paybackMonths: payback,
        grossMargin: inputs.grossMargin
      });
      
      const scoreClass = efficiency.rating.toLowerCase();
      document.getElementById('efficiencyScore').innerHTML = `
        <div class="efficiency-rating" style="color: var(--muted);">
          <span class="term-helper" data-definition="This score combines three key signals: LTV:CAC ratio (40 points max), payback period (30 points max), and gross margin (30 points max). Total 100 points possible. Higher score means growth creates value faster than it consumes cash. 75+ is strong, 50-74 is moderate, under 50 needs improvement.">Capital Efficiency</span> Score
        </div>
        <div class="efficiency-score ${scoreClass}">${efficiency.score}/100</div>
        <div class="efficiency-rating ${scoreClass}">${efficiency.rating}</div>
        <div class="efficiency-interpretation">${efficiency.interpretation}</div>
      `;
      
      // === PAYBACK SENSITIVITY TABLE ===
      const scenarios = [
        { label: 'Baseline', tooltip: 'Current assumptions with no stress applied', churnAdj: 0, gmAdj: 0, arpaAdj: 0 },
        { label: 'Churn <span style="color: #059669;">+1%</span>', tooltip: 'What if monthly churn increases by 1 percentage point? Tests retention risk.', churnAdj: 1, gmAdj: 0, arpaAdj: 0 },
        { label: 'Gross Margin <span style="color: #dc2626;">-5%</span>', tooltip: 'What if gross margin drops by 5 percentage points? Tests unit economics pressure from rising costs.', churnAdj: 0, gmAdj: -5, arpaAdj: 0 },
        { label: 'ARPA <span style="color: #dc2626;">-10%</span>', tooltip: 'What if average revenue per account drops 10%? Tests pricing pressure and revenue quality.', churnAdj: 0, gmAdj: 0, arpaAdj: -0.10 }
      ];
      
      let sensitivityHTML = `
        <thead>
          <tr>
            <th><span class="term-helper" data-definition="Different stress scenarios to test how fragile your payback period is to small changes in key assumptions.">Scenario</span></th>
            <th>Payback (months)</th>
            <th>Change</th>
            <th>% Impact</th>
          </tr>
        </thead>
        <tbody>
      `;
      
      scenarios.forEach(s => {
        const stressedChurn = inputs.churnRate + s.churnAdj;
        const stressedGM = inputs.grossMargin + s.gmAdj;
        const stressedARPA = inputs.arpa * (1 + s.arpaAdj);
        const stressedPayback = cac / (stressedARPA * (stressedGM / 100));
        const change = stressedPayback - payback;
        const pctChange = (change / payback) * 100;
        
        const changeClass = change > 0.5 ? 'sensitivity-deterioration' : change < -0.5 ? 'sensitivity-improvement' : '';
        const changeSymbol = change > 0 ? '+' : '';
        
        sensitivityHTML += `
          <tr>
            <td><strong><span class="term-helper" data-definition="${s.tooltip}">${s.label}</span></strong></td>
            <td>${stressedPayback.toFixed(1)}</td>
            <td class="${changeClass}">${changeSymbol}${change.toFixed(1)} mo</td>
            <td class="${changeClass}">${changeSymbol}${pctChange.toFixed(1)}%</td>
          </tr>
        `;
      });
      
      sensitivityHTML += '</tbody>';
      document.getElementById('sensitivityTable').innerHTML = sensitivityHTML;
    }
    
    // ========== CONTRIBUTION FUNCTIONS ==========
    
    function renderContribution() {
      const data = contributionData[currentScenario];
      
      let tableHTML = `
        <thead>
          <tr>
            <th>Month</th>
            <th>Revenue</th>
            <th>COGS</th>
            <th>Payment Fees</th>
            <th>Support</th>
            <th>Infra</th>
            <th>Contrib. Margin $</th>
            <th>CM %</th>
          </tr>
        </thead>
        <tbody>
      `;
      data.forEach(d => {
        const totalVarCost = d.cogs + d.paymentFees + d.supportCost + d.infraCost;
        const cm = d.revenue - totalVarCost;
        const cmPct = (cm / d.revenue) * 100;
        tableHTML += `
          <tr>
            <td>${d.month}</td>
            <td>${formatCurrency(d.revenue)}</td>
            <td>${formatCurrency(d.cogs)}</td>
            <td>${formatCurrency(d.paymentFees)}</td>
            <td>${formatCurrency(d.supportCost)}</td>
            <td>${formatCurrency(d.infraCost)}</td>
            <td>${formatCurrency(cm)}</td>
            <td>${formatPercent(cmPct)}</td>
          </tr>
        `;
      });
      tableHTML += '</tbody>';
      document.getElementById('contributionTable').innerHTML = tableHTML;
      
      renderContributionChart();
    }
    
    function renderContributionChart() {
      const data = contributionData[currentScenario];
      const canvas = document.getElementById('contributionChart');
      const container = canvas.parentElement.parentElement;
      const containerWidth = container.clientWidth - 40;
      
      canvas.width = containerWidth;
      canvas.height = 350;
      
      const ctx = canvas.getContext('2d');
      const w = canvas.width;
      const h = canvas.height;
      const dpr = window.devicePixelRatio || 1;
      
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.scale(dpr, dpr);
      
      ctx.clearRect(0, 0, w, h);
      
      const cmValues = data.map(d => {
        const totalVarCost = d.cogs + d.paymentFees + d.supportCost + d.infraCost;
        return (d.revenue - totalVarCost) / d.revenue * 100;
      });
      
      const avgCM = cmValues.reduce((sum, val) => sum + val, 0) / cmValues.length;
      
      const maxVal = Math.max(...cmValues) + 2;
      const minVal = Math.min(...cmValues) - 2;
      const range = maxVal - minVal || 1;
      
      const chartArea = {
        left: 48,
        right: w - 28,
        top: 24,
        bottom: h - 32,
        width: w - 48 - 28,
        height: h - 24 - 32
      };
      
      const pointGap = chartArea.width / (data.length - 1);
      
      contributionChartPoints = [];
      
      // Helper for rounded rectangles
      function roundRect(ctx, x, y, width, height, radius) {
        ctx.beginPath();
        ctx.moveTo(x + radius, y);
        ctx.lineTo(x + width - radius, y);
        ctx.arcTo(x + width, y, x + width, y + radius, radius);
        ctx.lineTo(x + width, y + height - radius);
        ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
        ctx.lineTo(x + radius, y + height);
        ctx.arcTo(x, y + height, x, y + height - radius, radius);
        ctx.lineTo(x, y + radius);
        ctx.arcTo(x, y, x + radius, y, radius);
        ctx.closePath();
      }
      
      // Grid lines
      ctx.strokeStyle = 'rgba(12, 23, 45, 0.08)';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = chartArea.top + (i / 4) * chartArea.height;
        ctx.beginPath();
        ctx.moveTo(chartArea.left, y);
        ctx.lineTo(chartArea.right, y);
        ctx.stroke();
      }
      
      // Y-axis labels
      ctx.fillStyle = '#5d6b7a';
      ctx.font = '12px sans-serif';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      for (let i = 0; i <= 4; i++) {
        const val = maxVal - (range * (i / 4));
        const y = chartArea.top + (i / 4) * chartArea.height;
        ctx.fillText(val.toFixed(1) + '%', chartArea.left - 10, y);
      }
      
      // Draw main line FIRST (bottom layer)
      ctx.beginPath();
      ctx.strokeStyle = '#0f766e';
      ctx.lineWidth = 3;
      data.forEach((d, i) => {
        const x = chartArea.left + i * pointGap;
        const y = chartArea.top + chartArea.height - ((cmValues[i] - minVal) / range) * chartArea.height;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
      
      // Draw average CM line SECOND (dashed red) - appears on top of main line
      const avgY = chartArea.top + chartArea.height - ((avgCM - minVal) / range) * chartArea.height;
      ctx.setLineDash([5, 5]);
      ctx.strokeStyle = 'rgba(214, 69, 69, 0.8)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(chartArea.left, avgY);
      ctx.lineTo(chartArea.right, avgY);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Average label with rounded background THIRD - appears on top
      const avgText = `Avg ${avgCM.toFixed(1)}%`;
      ctx.font = 'bold 11px sans-serif';
      const avgTextWidth = ctx.measureText(avgText).width;
      const avgLabelX = chartArea.right - avgTextWidth - 8;
      const avgLabelY = avgY;
      
      // Background for avg label
      ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
      ctx.strokeStyle = 'rgba(214, 69, 69, 0.4)';
      ctx.lineWidth = 1;
      roundRect(ctx, avgLabelX - 6, avgLabelY - 10, avgTextWidth + 12, 18, 4);
      ctx.fill();
      ctx.stroke();
      
      ctx.fillStyle = 'rgba(214, 69, 69, 0.95)';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';
      ctx.fillText(avgText, avgLabelX, avgLabelY);
      
      // Draw points and labels LAST (top layer)
      data.forEach((d, i) => {
        const x = chartArea.left + i * pointGap;
        const y = chartArea.top + chartArea.height - ((cmValues[i] - minVal) / range) * chartArea.height;
        
        contributionChartPoints.push({
          x, y,
          month: d.month,
          value: cmValues[i],
          revenue: d.revenue
        });
        
        // Point
        ctx.fillStyle = '#0f766e';
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // Outer ring
        ctx.strokeStyle = 'rgba(15, 118, 110, 0.3)';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(x, y, 9, 0, Math.PI * 2);
        ctx.stroke();
        
        // Month labels
        ctx.fillStyle = '#5d6b7a';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText(d.month, x, chartArea.bottom + 10);
        
        // Value labels with rounded background - alternate above/below
        const labelText = cmValues[i].toFixed(1) + '%';
        ctx.font = 'bold 11px sans-serif';
        const labelWidth = ctx.measureText(labelText).width;
        const labelY = (i % 2 === 0) ? y - 12 : y + 12;
        
        // Background for value label (fix readability on gridlines)
        ctx.fillStyle = 'rgba(255, 255, 255, 0.85)';
        ctx.strokeStyle = 'rgba(200, 200, 200, 0.4)';
        ctx.lineWidth = 1;
        roundRect(ctx, x - labelWidth/2 - 5, labelY - 9, labelWidth + 10, 16, 4);
        ctx.fill();
        ctx.stroke();
        
        ctx.fillStyle = '#0b1220';
        ctx.textBaseline = 'middle';
        ctx.fillText(labelText, x, labelY);
      });
      
      // Title
      ctx.fillStyle = '#0b1220';
      ctx.font = 'bold 13px sans-serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText('CM %', chartArea.left, 10);
      
      // Generate chart explanation (unchanged logic)
      const firstCM = cmValues[0];
      const lastCM = cmValues[cmValues.length - 1];
      const cmChange = lastCM - firstCM;
      
      let trendText = '';
      let interpretation = '';
      
      if (cmChange > 2) {
        trendText = '<strong>Uptrend:</strong> Your contribution margin is improving over time.';
        interpretation = 'This is excellent! You\'re getting better at controlling variable costs or increasing prices. Each sale is becoming more profitable.';
      } else if (cmChange < -2) {
        trendText = '<strong>Downtrend:</strong> Your contribution margin is declining.';
        interpretation = 'This needs attention. Variable costs might be rising, or you\'re discounting too much. Review your cost structure and pricing.';
      } else {
        trendText = '<strong>Stable:</strong> Your contribution margin is relatively consistent.';
        interpretation = 'Good stability. You have predictable unit economics, which helps with forecasting and planning.';
      }
      
      document.getElementById('cmChartExplanation').innerHTML = `
        ${trendText} Average: <strong>${avgCM.toFixed(1)}%</strong>. ${interpretation}
      `;
    }
    
    // ========== RUN-RATE FUNCTIONS ==========
    
    function renderRunrate() {
      const data = runrateData[currentScenario];
      const lastMonth = data[data.length - 1];
      const runrateARR = lastMonth.mrr * 12;
      
      const forecast = [];
      let customers = lastMonth.customers;
      let mrr = lastMonth.mrr;
      for (let i = 0; i < 6; i++) {
        const netGrowth = (lastMonth.expansion - lastMonth.churn) / 100;
        customers = customers * (1 + netGrowth);
        mrr = mrr * (1 + netGrowth);
        forecast.push({ month: lastMonth.month + i + 1, customers: Math.round(customers), mrr: Math.round(mrr) });
      }
      
      const forecastARR = forecast[5].mrr * 12;
      const avgOpEx = data.reduce((sum, d) => sum + d.opex, 0) / data.length;
      const avgRev = data.reduce((sum, d) => sum + d.mrr, 0) / data.length;
      const avgGM = data.reduce((sum, d) => sum + d.gm, 0) / data.length;
      const monthlyBurn = avgOpEx - (avgRev * (avgGM / 100));
      
      document.getElementById('runrateKPIs').innerHTML = `
        <div class="kpi-box">
          <div class="kpi-box-label">
            <span class="term-helper" data-definition="Annual Recurring Revenue at current run-rate. This is your MRR (Monthly Recurring Revenue) √ó 12. It shows what your yearly revenue would be if you maintained this month's performance.">Run-rate ARR (Current)</span>
          </div>
          <div class="kpi-box-value">${formatCurrency(runrateARR)}</div>
          <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">Based on latest MRR</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label">
            <span class="term-helper" data-definition="Projected ARR in 6 months if your current growth rate continues. Calculated by extrapolating your recent expansion and churn trends. Helps answer: 'Where will we be by mid-year?'">Forecast ARR (6mo)</span>
          </div>
          <div class="kpi-box-value">${formatCurrency(forecastARR)}</div>
          <div style="font-size: 11px; color: ${forecastARR > runrateARR ? '#059669' : '#d97706'}; margin-top: 4px;">
            ${((forecastARR - runrateARR) / runrateARR * 100).toFixed(1)}% growth
          </div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label">
            <span class="term-helper" data-definition="Gross Burn: Total operating expenses per month, before accounting for any revenue. This is the raw cash going out the door to run the business (salaries, rent, software, marketing, etc).">Gross Burn</span>
          </div>
          <div class="kpi-box-value">${formatCurrency(avgOpEx)}</div>
          <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">Operating expenses/mo</div>
        </div>
        <div class="kpi-box">
          <div class="kpi-box-label">
            <span class="term-helper" data-definition="Net Burn: Cash consumed per month after accounting for revenue. Formula: Operating Expenses minus Gross Profit (Revenue √ó Gross Margin). Negative means you're profitable!">Net Burn</span>
          </div>
          <div class="kpi-box-value">${formatCurrency(Math.abs(monthlyBurn))}</div>
          <div style="font-size: 11px; color: ${monthlyBurn < 0 ? '#059669' : '#d97706'}; margin-top: 4px;">
            ${monthlyBurn < 0 ? 'Profitable!' : 'Burning cash'}
          </div>
        </div>
      `;
      
      const avgChurn = data.slice(-6).reduce((sum, d) => sum + d.churn, 0) / 6;
      const inputs = cacLtvInputs[currentScenario];
      const cac = (inputs.marketingSpend + inputs.salesSpend) / inputs.newCustomers;
      const payback = cac / (inputs.arpa * (inputs.grossMargin / 100));
      const avgCM = (avgRev * (avgGM / 100) - avgRev * 0.25) / avgRev * 100;
      
      let flagsHTML = '';
      if (avgChurn > 5) {
        flagsHTML += '<div class="risk-flag">‚ö†Ô∏è High Churn (' + avgChurn.toFixed(1) + '%)</div>';
      } else {
        flagsHTML += '<div class="risk-flag ok">‚úì Churn Healthy</div>';
      }
      if (payback > 12) {
        flagsHTML += '<div class="risk-flag">‚ö†Ô∏è Long Payback (' + payback.toFixed(1) + ' mo)</div>';
      } else {
        flagsHTML += '<div class="risk-flag ok">‚úì Payback Acceptable</div>';
      }
      if (avgCM < 40) {
        flagsHTML += '<div class="risk-flag">‚ö†Ô∏è Low Contribution Margin</div>';
      } else {
        flagsHTML += '<div class="risk-flag ok">‚úì CM Healthy</div>';
      }
      document.getElementById('riskFlags').innerHTML = flagsHTML;
      
      const displayData = data.slice(-12).concat(forecast);
      let tableHTML = `
        <thead>
          <tr>
            <th>Month</th>
            <th>Customers</th>
            <th>MRR</th>
            <th>Expansion %</th>
            <th>Churn %</th>
            <th>GM %</th>
            <th>OpEx</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody>
      `;
      displayData.forEach((d, i) => {
        const isForecast = i >= 12;
        tableHTML += `
          <tr${isForecast ? ' style="background: rgba(15,118,110,0.05);"' : ''}>
            <td>${d.month}</td>
            <td>${d.customers.toLocaleString()}</td>
            <td>${formatCurrency(d.mrr)}</td>
            <td>${d.expansion !== undefined ? formatPercent(d.expansion) : '-'}</td>
            <td>${d.churn !== undefined ? formatPercent(d.churn) : '-'}</td>
            <td>${d.gm !== undefined ? formatPercent(d.gm) : '-'}</td>
            <td>${d.opex !== undefined ? formatCurrency(d.opex) : '-'}</td>
            <td>${isForecast ? 'Forecast' : 'Actual'}</td>
          </tr>
        `;
      });
      tableHTML += '</tbody>';
      document.getElementById('runrateTable').innerHTML = tableHTML;
      
      renderRunrateChart(displayData);
      
      // Also trigger cash runway calculation
      computeCashRunway();
    }
    
    // ========== CASH & RUNWAY FUNCTIONS ==========
    
    function computeCashRunway() {
      const cashBalance = parseFloat(document.getElementById('cashBalance').value) || 0;
      const data = runrateData[currentScenario];
      
      // Calculate net burn (OpEx minus Gross Profit)
      const avgOpEx = data.reduce((sum, d) => sum + d.opex, 0) / data.length;
      const avgRev = data.reduce((sum, d) => sum + d.mrr, 0) / data.length;
      const avgGM = data.reduce((sum, d) => sum + d.gm, 0) / data.length;
      const netBurn = avgOpEx - (avgRev * (avgGM / 100));
      
      const EPSILON = 100; // Near-breakeven threshold ($100/mo)
      let widgetHTML = '';
      
      if (netBurn <= 0) {
        // Cash generating - profitable
        widgetHTML = `
          <div class="cash-widget-title">
            <span>üí∞</span>
            <span>Cash Position: <span class="term-helper" data-definition="Your business is profitable - generating more cash than burning each month. This means infinite runway and no need for external capital.">Cash Generating</span></span>
          </div>
          <div class="cash-generating">
            ‚úì Your business is profitable! You generate <strong>${formatCurrency(Math.abs(netBurn))}/month</strong> in positive cash flow. No external capital needed.
          </div>
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); font-size: 13px; line-height: 1.6; color: var(--muted);">
            <strong style="color: var(--text);">Cash Flow Breakdown:</strong><br>
            Starting Cash: ${formatCurrency(cashBalance)}<br>
            Gross Profit (Revenue √ó <span class="term-helper" data-definition="GM: Gross Margin - the percentage of revenue left after variable costs. Higher GM means more cash from each dollar of revenue.">GM</span>%): +${formatCurrency(avgRev * (avgGM / 100))}<br>
            <span class="term-helper" data-definition="OpEx: Operating Expenses - all the costs to run your business (salaries, rent, marketing, etc), excluding cost of goods sold.">OpEx</span>: -${formatCurrency(avgOpEx)}<br>
            Net Cash Flow: <span style="color: #059669;">+${formatCurrency(Math.abs(netBurn))}/mo</span>
          </div>
        `;
      } else if (netBurn > 0 && netBurn < EPSILON) {
        // Near breakeven - cap runway display
        widgetHTML = `
          <div class="cash-widget-title">
            <span>‚öñÔ∏è</span>
            <span><span class="term-helper" data-definition="Runway: The number of months you can continue operating before running out of cash at your current burn rate.">Cash Runway</span>: Near Breakeven</span>
          </div>
          <div class="runway-months">60+ months</div>
          <div style="font-size: 13px; color: var(--muted); margin-bottom: 12px;">
            Effective runway is very long due to minimal <span class="term-helper" data-definition="Net Burn: Cash consumed per month after revenue. Very low burn means you're close to self-sustaining.">net burn</span> (${formatCurrency(netBurn)}/mo)
          </div>
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); font-size: 13px; line-height: 1.6; color: var(--muted);">
            <strong style="color: var(--text);">Cash Flow Breakdown:</strong><br>
            Starting Cash: ${formatCurrency(cashBalance)}<br>
            Gross Profit (Revenue √ó GM%): +${formatCurrency(avgRev * (avgGM / 100))}<br>
            OpEx: -${formatCurrency(avgOpEx)}<br>
            Net Burn: <span style="color: #d97706;">-${formatCurrency(netBurn)}/mo</span>
          </div>
        `;
      } else {
        // Normal burn - calculate runway
        const runwayMonths = cashBalance / netBurn;
        const runwayPercent = Math.min(100, (runwayMonths / 24) * 100);
        
        const today = new Date();
        const cashZeroDate = new Date(today);
        cashZeroDate.setMonth(cashZeroDate.getMonth() + Math.floor(runwayMonths));
        const dateStr = cashZeroDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        
        widgetHTML = `
          <div class="cash-widget-title">
            <span>‚è±Ô∏è</span>
            <span><span class="term-helper" data-definition="Runway: The number of months you can continue operating before running out of cash at your current burn rate. Critical for planning fundraising timing.">Cash Runway</span></span>
          </div>
          <div class="runway-months">${runwayMonths.toFixed(1)} months</div>
          <div class="runway-bar">
            <div class="runway-fill" style="width: ${runwayPercent}%"></div>
          </div>
          <div style="font-size: 13px; color: var(--muted); margin-bottom: 12px;">
            Cash depletes: <strong>${dateStr}</strong> | Monthly <span class="term-helper" data-definition="Burn Rate: How much cash your business consumes each month after accounting for revenue. High burn requires frequent fundraising.">burn</span>: <strong>${formatCurrency(netBurn)}</strong>
          </div>
        `;
        
        if (runwayMonths < 12) {
          const fundingNeed = netBurn * (18 - runwayMonths);
          widgetHTML += `
            <div class="funding-warning">
              ‚ö†Ô∏è <strong>Funding Alert:</strong> Runway < 12 months. Consider raising <span class="term-helper" data-definition="The amount of capital needed to extend your runway to a comfortable 18+ months, giving you breathing room for growth and fundraising.">~${formatCurrency(fundingNeed)}</span> to extend runway to 18 months.
            </div>
          `;
        }
        
        widgetHTML += `
          <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border); font-size: 13px; line-height: 1.6; color: var(--muted);">
            <strong style="color: var(--text);">Cash Flow Breakdown:</strong><br>
            Starting Cash: ${formatCurrency(cashBalance)}<br>
            Gross Profit (Revenue √ó GM%): +${formatCurrency(avgRev * (avgGM / 100))}<br>
            OpEx: -${formatCurrency(avgOpEx)}<br>
            Net Burn: <span style="color: #dc2626;">-${formatCurrency(netBurn)}/mo</span>
          </div>
        `;
      }
      
      document.getElementById('cashWidget').innerHTML = widgetHTML;
    }
    
    function renderRunrateChart(displayData) {
      const canvas = document.getElementById('runrateChart');
      const container = canvas.parentElement.parentElement;
      const containerWidth = container.clientWidth - 40;
      
      canvas.width = containerWidth;
      canvas.height = 350;
      
      const ctx = canvas.getContext('2d');
      const w = canvas.width;
      const h = canvas.height;
      const dpr = window.devicePixelRatio || 1;
      
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.scale(dpr, dpr);
      
      ctx.clearRect(0, 0, w, h);
      
      const mrrValues = displayData.map(d => d.mrr);
      const customerValues = displayData.map(d => d.customers);
      
      const maxMRR = Math.max(...mrrValues);
      const maxCustomers = Math.max(...customerValues);
      
      const paddingLeft = 70;
      const paddingRight = 90;
      const paddingTop = 50;
      const paddingBottom = 50;
      const chartW = w - paddingLeft - paddingRight;
      const chartH = h - paddingTop - paddingBottom;
      const pointGap = chartW / (displayData.length - 1);
      
      runrateChartPoints = [];
      
      // Grid lines
      ctx.strokeStyle = 'rgba(12, 23, 45, 0.08)';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = paddingTop + (i / 4) * chartH;
        ctx.beginPath();
        ctx.moveTo(paddingLeft, y);
        ctx.lineTo(w - paddingRight, y);
        ctx.stroke();
      }
      
      // Y-axis labels (MRR - left)
      ctx.fillStyle = '#1b4d7a';
      ctx.font = 'bold 11px sans-serif';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'middle';
      for (let i = 0; i <= 4; i++) {
        const val = maxMRR * (1 - i / 4);
        const y = paddingTop + (i / 4) * chartH;
        ctx.fillText('$' + (val / 1000).toFixed(0) + 'K', paddingLeft - 10, y);
      }
      
      // Y-axis labels (Customers - right)
      ctx.fillStyle = '#0f766e';
      ctx.textAlign = 'left';
      for (let i = 0; i <= 4; i++) {
        const val = maxCustomers * (1 - i / 4);
        const y = paddingTop + (i / 4) * chartH;
        ctx.fillText(Math.round(val).toLocaleString(), w - paddingRight + 10, y);
      }
      
      // Draw MRR line
      ctx.beginPath();
      ctx.strokeStyle = '#1b4d7a';
      ctx.lineWidth = 3;
      displayData.forEach((d, i) => {
        const x = paddingLeft + i * pointGap;
        const y = paddingTop + chartH - (d.mrr / maxMRR) * chartH;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
      
      // Draw MRR points
      displayData.forEach((d, i) => {
        const x = paddingLeft + i * pointGap;
        const y = paddingTop + chartH - (d.mrr / maxMRR) * chartH;
        
        runrateChartPoints.push({ x, y, month: d.month, mrr: d.mrr, customers: d.customers, type: 'mrr' });
        
        ctx.fillStyle = '#1b4d7a';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
      
      // Draw customer line (dashed)
      ctx.beginPath();
      ctx.strokeStyle = '#0f766e';
      ctx.lineWidth = 3;
      ctx.setLineDash([6, 6]);
      displayData.forEach((d, i) => {
        const x = paddingLeft + i * pointGap;
        const y = paddingTop + chartH - (d.customers / maxCustomers) * chartH;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Draw customer points
      displayData.forEach((d, i) => {
        const x = paddingLeft + i * pointGap;
        const y = paddingTop + chartH - (d.customers / maxCustomers) * chartH;
        
        runrateChartPoints.push({ x, y, month: d.month, mrr: d.mrr, customers: d.customers, type: 'customers' });
        
        ctx.fillStyle = '#0f766e';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
      
      // Month labels (every 3rd)
      ctx.fillStyle = '#5d6b7a';
      ctx.font = '11px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      displayData.forEach((d, i) => {
        if (i % 3 === 0) {
          const x = paddingLeft + i * pointGap;
          ctx.fillText('M' + d.month, x, h - paddingBottom + 10);
        }
      });
      
      // Legend
      ctx.fillStyle = '#1b4d7a';
      ctx.fillRect(paddingLeft, 20, 20, 3);
      ctx.fillStyle = '#0b1220';
      ctx.font = '12px sans-serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';
      ctx.fillText('MRR', paddingLeft + 25, 22);
      
      ctx.fillStyle = '#0f766e';
      ctx.fillRect(paddingLeft + 70, 20, 20, 3);
      ctx.fillText('Customers', paddingLeft + 95, 22);
    }
    
    // ========== CHART INTERACTION ==========
    
    function setupChartInteractions() {
      const contributionCanvas = document.getElementById('contributionChart');
      const contributionTooltip = document.getElementById('contributionTooltip');
      
      contributionCanvas.addEventListener('mousemove', (e) => {
        const rect = contributionCanvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (contributionCanvas.width / rect.width) / (window.devicePixelRatio || 1);
        const y = (e.clientY - rect.top) * (contributionCanvas.height / rect.height) / (window.devicePixelRatio || 1);
        
        let closest = null;
        let minDist = 25;
        
        contributionChartPoints.forEach(point => {
          const dist = Math.sqrt((x - point.x) ** 2 + (y - point.y) ** 2);
          if (dist < minDist) {
            minDist = dist;
            closest = point;
          }
        });
        
        if (closest) {
          contributionTooltip.innerHTML = `
            <strong>${closest.month}</strong><br>
            CM: ${closest.value.toFixed(1)}%<br>
            Revenue: ${formatCurrency(closest.revenue)}
          `;
          contributionTooltip.style.left = (e.clientX - rect.left + 15) + 'px';
          contributionTooltip.style.top = (e.clientY - rect.top - 10) + 'px';
          contributionTooltip.classList.add('visible');
        } else {
          contributionTooltip.classList.remove('visible');
        }
      });
      
      contributionCanvas.addEventListener('mouseleave', () => {
        contributionTooltip.classList.remove('visible');
      });
      
      const runrateCanvas = document.getElementById('runrateChart');
      const runrateTooltip = document.getElementById('runrateTooltip');
      
      runrateCanvas.addEventListener('mousemove', (e) => {
        const rect = runrateCanvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (runrateCanvas.width / rect.width) / (window.devicePixelRatio || 1);
        const y = (e.clientY - rect.top) * (runrateCanvas.height / rect.height) / (window.devicePixelRatio || 1);
        
        let closest = null;
        let minDist = 25;
        
        runrateChartPoints.forEach(point => {
          const dist = Math.sqrt((x - point.x) ** 2 + (y - point.y) ** 2);
          if (dist < minDist) {
            minDist = dist;
            closest = point;
          }
        });
        
        if (closest) {
          runrateTooltip.innerHTML = `
            <strong>Month ${closest.month}</strong><br>
            MRR: ${formatCurrency(closest.mrr)}<br>
            Customers: ${closest.customers.toLocaleString()}
          `;
          runrateTooltip.style.left = (e.clientX - rect.left + 15) + 'px';
          runrateTooltip.style.top = (e.clientY - rect.top - 10) + 'px';
          runrateTooltip.classList.add('visible');
        } else {
          runrateTooltip.classList.remove('visible');
        }
      });
      
      runrateCanvas.addEventListener('mouseleave', () => {
        runrateTooltip.classList.remove('visible');
      });
    }
    
    // ========== CSV HANDLERS ==========
    
    function handleCACLTVUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const { headers, data } = parseCSV(e.target.result);
          const required = ['newCustomers', 'marketingSpend', 'salesSpend', 'arpa', 'grossMargin', 'churnRate'];
          if (!validateHeaders(headers, required)) {
            alert('Invalid CSV. Required headers: ' + required.join(', '));
            return;
          }
          const row = data[0];
          cacLtvInputs[currentScenario] = {
            newCustomers: parseFloat(row.newCustomers) || 0,
            marketingSpend: parseFloat(row.marketingSpend) || 0,
            salesSpend: parseFloat(row.salesSpend) || 0,
            arpa: parseFloat(row.arpa) || 0,
            grossMargin: parseFloat(row.grossMargin) || 0,
            churnRate: parseFloat(row.churnRate) || 0
          };
          dataMode = 'uploaded';
          document.getElementById('dataModeBadge').textContent = 'Uploaded Data';
          loadScenarioInputs();
          computeCACLTV();
          alert('CAC/LTV data uploaded!');
        } catch (err) {
          alert('Error: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
    
    function handleContributionUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const { headers, data } = parseCSV(e.target.result);
          const required = ['month', 'revenue', 'cogs', 'paymentFees', 'supportCost', 'infraCost'];
          if (!validateHeaders(headers, required)) {
            alert('Invalid CSV. Required headers: ' + required.join(', '));
            return;
          }
          contributionData[currentScenario] = data.map(d => ({
            month: d.month,
            revenue: parseFloat(d.revenue) || 0,
            cogs: parseFloat(d.cogs) || 0,
            paymentFees: parseFloat(d.paymentFees) || 0,
            supportCost: parseFloat(d.supportCost) || 0,
            infraCost: parseFloat(d.infraCost) || 0
          }));
          dataMode = 'uploaded';
          document.getElementById('dataModeBadge').textContent = 'Uploaded Data';
          renderContribution();
          alert('Contribution data uploaded!');
        } catch (err) {
          alert('Error: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
    
    function handleRunrateUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const { headers, data } = parseCSV(e.target.result);
          const required = ['month', 'customers', 'mrr', 'expansion', 'churn', 'gm', 'opex'];
          if (!validateHeaders(headers, required)) {
            alert('Invalid CSV. Required headers: ' + required.join(', '));
            return;
          }
          runrateData[currentScenario] = data.map(d => ({
            month: parseInt(d.month) || 0,
            customers: parseInt(d.customers) || 0,
            mrr: parseFloat(d.mrr) || 0,
            expansion: parseFloat(d.expansion) || 0,
            churn: parseFloat(d.churn) || 0,
            gm: parseFloat(d.gm) || 0,
            opex: parseFloat(d.opex) || 0
          }));
          dataMode = 'uploaded';
          document.getElementById('dataModeBadge').textContent = 'Uploaded Data';
          renderRunrate();
          alert('Run-rate data uploaded!');
        } catch (err) {
          alert('Error: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
    
    // ========== BOARD VIEW RENDER ==========
    

  // ‚îÄ‚îÄ Standardized Decision Box helper ‚îÄ‚îÄ
  function setDecisionBox(state, verdict, verdictAction, bullets, next) {
    var box = document.getElementById('decisionBox');
    if (!box) return;
    box.classList.remove('decision-box--positive','decision-box--warning','decision-box--negative');
    box.classList.add('decision-box--' + state);
    document.getElementById('decisionVerdict').innerHTML =
      verdict + ' <span class="verdict-action">' + verdictAction + '</span>';
    document.getElementById('decisionBullets').innerHTML =
      bullets.map(function(b){ return '<li>' + b + '</li>'; }).join('');
    document.getElementById('decisionNext').innerHTML =
      'Top driver: <span>' + next + '</span>';
  }

    function renderBoardView() {
      // Get current inputs and computed values
      const inputs = cacLtvInputs[currentScenario];
      const cashBalance = parseFloat(document.getElementById('cashBalance').value) || 0;
      
      // Recompute key metrics (matching computeCACLTV logic)
      const cac = (inputs.marketingSpend + inputs.salesSpend) / inputs.newCustomers;
      const ltv = (inputs.arpa * (inputs.grossMargin / 100)) / (inputs.churnRate / 100);
      const ltvCacRatio = ltv / cac;
      const payback = cac / (inputs.arpa * (inputs.grossMargin / 100));
      
      // Get run-rate data for burn calculation
      const data = runrateData[currentScenario];
      const avgOpEx = data.reduce((sum, d) => sum + d.opex, 0) / data.length;
      const avgRev = data.reduce((sum, d) => sum + d.mrr, 0) / data.length;
      const avgGM = data.reduce((sum, d) => sum + d.gm, 0) / data.length;
      const netBurn = avgOpEx - (avgRev * (avgGM / 100));
      
      // Capital Efficiency Score (using centralized evaluator)
      const efficiency = evaluateCapitalEfficiency({
        ltvToCac: ltvCacRatio,
        paybackMonths: payback,
        grossMargin: inputs.grossMargin
      });
      
      // === 1. CAPITAL HEALTH KPI ===
      const healthElement = document.getElementById('boardCapitalHealth');
      healthElement.textContent = efficiency.rating;
      healthElement.className = 'board-kpi-value ' + efficiency.rating.toLowerCase();
      
      document.getElementById('boardCapitalNote').textContent = `${efficiency.score}/100 efficiency score`;
      
      // === 2. RUNWAY KPI ===
      const EPSILON = 100;
      let runwayText = '';
      let runwayClass = '';
      let runwayNote = '';
      
      if (netBurn <= 0) {
        runwayText = 'Cash Generating';
        runwayClass = 'cash-generating';
        runwayNote = `+${formatCurrency(Math.abs(netBurn))}/mo positive cash flow`;
      } else if (netBurn > 0 && netBurn < EPSILON) {
        runwayText = '60+ months';
        runwayClass = 'near-breakeven';
        runwayNote = `Near breakeven (${formatCurrency(netBurn)}/mo burn)`;
      } else {
        const runwayMonths = cashBalance / netBurn;
        runwayText = `${runwayMonths.toFixed(1)} months`;
        runwayClass = 'normal-burn';
        
        const today = new Date();
        const depletionDate = new Date(today);
        depletionDate.setMonth(depletionDate.getMonth() + Math.floor(runwayMonths));
        const dateStr = depletionDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        runwayNote = `Cash depletes: ${dateStr}`;
      }
      
      const runwayElement = document.getElementById('boardRunway');
      runwayElement.textContent = runwayText;
      runwayElement.className = 'board-kpi-value ' + runwayClass;
      document.getElementById('boardRunwayDate').textContent = runwayNote;
      
      // === 3. FUNDING REQUIREMENT KPI ===
      const targetMonths = 12;
      let fundingGap = 0;
      let fundingNote = '';
      
      if (netBurn <= 0) {
        fundingGap = 0;
        fundingNote = 'No funding needed (profitable)';
      } else if (netBurn < EPSILON) {
        fundingGap = 0;
        fundingNote = 'No funding needed (near breakeven)';
      } else {
        const runwayMonths = cashBalance / netBurn;
        if (runwayMonths >= targetMonths) {
          fundingGap = 0;
          fundingNote = `Runway already >${targetMonths} months`;
        } else {
          fundingGap = netBurn * (targetMonths - runwayMonths);
          fundingNote = `To reach ${targetMonths} months runway`;
        }
      }
      
      document.getElementById('boardFundingGap').textContent = fundingGap === 0 ? '$0' : `~${formatCurrency(fundingGap)}`;
      
      // PART 2: Add bridge math explanation
      const bridgeMath = `<div style="font-size: 11px; color: var(--muted); margin-top: 4px; font-style: italic;">Net Burn = OpEx ‚àí (MRR √ó <span class="term-helper" data-definition="GM (Gross Margin) is used here as a proxy for contribution margin. It represents revenue after variable costs but does not include all costs below gross profit. For precise cash planning, consider full variable cost structure.">GM</span>%) = ${formatCurrency(avgOpEx)} ‚àí ${formatCurrency(avgRev * (avgGM / 100))} = ${formatCurrency(netBurn)}/mo</div>`;
      
      document.getElementById('boardFundingNote').innerHTML = fundingNote + bridgeMath;

      // ‚îÄ‚îÄ Decision Box ‚îÄ‚îÄ
      const runwayMonthsUE = (netBurn > 0 && cashBalance > 0) ? cashBalance / netBurn : 99;
      let ueState, ueVerdict, ueBullets, ueDriver;
      if (runwayMonthsUE < 6 || inputs.churnRate >= 5) {
        ueState = 'negative';
        ueVerdict = 'Immediate action required';
        ueBullets = [
          'Runway < 6 months or churn > 5%/mo ‚Äî survival mode, not growth mode',
          'Pause acquisition spend; every dollar must go to extending runway',
          'Churn at ' + inputs.churnRate.toFixed(1) + '%/mo = ~' + (Math.min(1-Math.pow(1-inputs.churnRate/100,12),1)*100).toFixed(0) + '% annual ‚Äî fix retention first'
        ];
        ueDriver = 'Monthly churn (' + inputs.churnRate.toFixed(1) + '%) ‚Äî the single biggest destroyer of unit economics';
      } else if (ltvCacRatio < 3 || payback > 18 || inputs.churnRate > 2.5) {
        ueState = 'warning';
        ueVerdict = 'Optimize unit economics before scaling';
        ueBullets = [
          'LTV/CAC of ' + ltvCacRatio.toFixed(1) + 'x ‚Äî below 3x industry minimum for sustainable growth',
          'Payback of ' + payback.toFixed(1) + ' months ‚Äî reduce CAC or increase ARPA to accelerate',
          inputs.grossMargin < 70 ? 'Gross margin at ' + inputs.grossMargin.toFixed(0) + '% ‚Äî improve to reduce CAC payback' : 'Gross margin healthy ‚Äî focus on CAC reduction'
        ];
        ueDriver = 'LTV/CAC ratio (' + ltvCacRatio.toFixed(1) + 'x) ‚Äî determines how efficiently capital converts to growth';
      } else {
        ueState = 'positive';
        ueVerdict = 'Scale acquisition aggressively';
        ueBullets = [
          'LTV/CAC of ' + ltvCacRatio.toFixed(1) + 'x ‚Äî strong unit economics support growth investment',
          'Payback at ' + payback.toFixed(1) + ' months ‚Äî fast enough to compound efficiently',
          'Runway and margins support increasing acquisition spend now'
        ];
        ueDriver = 'LTV/CAC (' + ltvCacRatio.toFixed(1) + 'x) ‚Äî every $1 of CAC returns $' + ltvCacRatio.toFixed(1) + ' in lifetime value';
      }
      setDecisionBox(ueState, 'Verdict:', ueVerdict, ueBullets, ueDriver);

      
      // === 4. PRIMARY RISK ===
      let riskText = '';
      
      if (inputs.churnRate >= 5.0) {
        riskText = `<strong>Retention Risk:</strong> ${inputs.churnRate.toFixed(1)}% monthly churn is elevated. Losing ${Math.round(inputs.churnRate)}% of customers each month erodes revenue and increases CAC burden. Focus on product-market fit and customer success.`;
      } else if (payback > 18) {
        riskText = `<strong>Payback Risk:</strong> ${payback.toFixed(1)} month payback period is long. You're waiting ${Math.round(payback)} months to recover acquisition costs. Improve conversion efficiency or increase ARPA to accelerate payback.`;
      } else if (inputs.grossMargin < 60) {
        riskText = `<strong>Margin Pressure:</strong> ${inputs.grossMargin.toFixed(0)}% gross margin is compressed. Limited cushion for operating expenses and profit. Evaluate COGS, infrastructure costs, and pricing power.`;
      } else if (netBurn > 0 && cashBalance / netBurn < 12) {
        riskText = `<strong>Liquidity Risk:</strong> Less than 12 months runway. Plan fundraising now or aggressively reduce burn. Missing fundraising windows can force down-rounds or emergency cuts.`;
      } else {
        riskText = `<strong>No Critical Red Flags:</strong> Key metrics are within acceptable ranges. Continue monitoring CAC trends, churn rates, and gross margin sustainability as you scale.`;
      }
      
      document.getElementById('boardRisk').innerHTML = riskText;
      
      // === 5. TOP LEVERS ===
      let leversText = '';
      const leversList = [];
      
      if (inputs.churnRate >= 4.5) {
        leversList.push(`<strong>Reduce Churn:</strong> Target ${Math.max(2.5, inputs.churnRate - 2).toFixed(1)}% churn through better onboarding, proactive support, and product improvements.`);
      }
      
      if (inputs.grossMargin < 65) {
        leversList.push(`<strong>Improve Gross Margin:</strong> Target 70%+ margin by optimizing infrastructure costs, renegotiating vendor contracts, or increasing pricing.`);
      }
      
      if (ltvCacRatio < 3 || cac > inputs.arpa * 12) {
        leversList.push(`<strong>CAC Efficiency:</strong> LTV:CAC is ${ltvCacRatio.toFixed(1)}x. Improve conversion rates, reduce sales cycle length, or optimize marketing spend to lower CAC.`);
      }
      
      if (leversList.length === 0) {
        leversText = `<strong>Maintain Discipline:</strong> Unit economics are healthy. Focus on maintaining current efficiency as you scale. Monitor CAC, churn, and margin vigilantly during growth phases.`;
      } else {
        leversText = leversList.slice(0, 2).join('<br><br>');
      }
      
      document.getElementById('boardLevers').innerHTML = leversText;
      
      // === 6. RECOMMENDATION (using centralized rating) ===
      let recommendation = '';
      
      if (efficiency.rating === 'Fragile' || (netBurn > 0 && cashBalance / netBurn < 12)) {
        recommendation = `<strong>Prioritize Efficiency Before Scaling:</strong> Current unit economics are fragile and/or runway is short. Focus on improving LTV:CAC, reducing churn, and extending runway before aggressive growth investments. Prove model sustainability first.`;
      } else if (efficiency.rating === 'Moderate' && (netBurn <= 0 || cashBalance / netBurn >= 12)) {
        recommendation = `<strong>Scale Selectively:</strong> Unit economics support sustainable growth, but maintain CAC and churn discipline. Expand cautiously into proven channels. Avoid over-hiring or premature market expansion that could compress margins.`;
      } else if (efficiency.rating === 'Strong' && (netBurn <= 0 || cashBalance / netBurn >= 12)) {
        recommendation = `<strong>Invest in Growth with Guardrails:</strong> Strong unit economics and healthy runway support aggressive scaling. Invest in new channels, geographies, or products‚Äîbut maintain rigorous monitoring of CAC, churn, and payback to avoid efficiency erosion.`;
      } else {
        recommendation = `<strong>Improve Efficiency and Extend Runway:</strong> Focus on the top levers identified above. Balance growth ambitions with the need to demonstrate capital efficiency and reach a comfortable runway before next fundraise.`;
      }
      
      document.getElementById('boardRecommendation').innerHTML = recommendation;
    }
    
    // ========== CAPITAL ALLOCATION FUNCTIONS ==========
    
    function computeCapitalAllocation() {
      const investment = parseFloat(document.getElementById('growthInvestment').value) || 0;
      const newCustomers = parseFloat(document.getElementById('expectedNewCustomers').value) || 0;
      const inputs = cacLtvInputs[currentScenario];
      
      if (investment <= 0 || newCustomers <= 0) {
        document.getElementById('allocationResults').innerHTML = '<div style="font-size: 13px; color: var(--muted); font-style: italic;">Enter growth investment and expected new customers to see analysis.</div>';
        return;
      }
      
      // Reuse existing unit economics
      const arpa = inputs.arpa;
      const grossMargin = inputs.grossMargin;
      const churnRate = inputs.churnRate;
      
      // Compute incremental metrics
      const effectiveCAC = investment / newCustomers;
      const monthlyGrossProfit = arpa * (grossMargin / 100);
      const paybackMonths = effectiveCAC / monthlyGrossProfit;
      
      // Incremental annual revenue (accounting for churn)
      const avgCustomerLifeMonths = 1 / (churnRate / 100);
      const incrementalRevenue = newCustomers * arpa * Math.min(avgCustomerLifeMonths, 12);
      const incrementalGrossProfit = incrementalRevenue * (grossMargin / 100);
      
      // Impact on runway (assumes investment increases monthly OpEx via amortization)
      const data = runrateData[currentScenario];
      const avgOpEx = data.reduce((sum, d) => sum + d.opex, 0) / data.length;
      const avgRev = data.reduce((sum, d) => sum + d.mrr, 0) / data.length;
      const avgGM = data.reduce((sum, d) => sum + d.gm, 0) / data.length;
      const currentNetBurn = avgOpEx - (avgRev * (avgGM / 100));
      
      // Adjusted burn (adds new customers to revenue, amortizes investment over 12 months)
      const monthlyInvestmentCost = investment / 12;
      const newMRR = newCustomers * arpa;
      const adjustedNetBurn = (avgOpEx + monthlyInvestmentCost) - ((avgRev + newMRR) * (avgGM / 100));
      
      const cashBalance = parseFloat(document.getElementById('cashBalance').value) || 0;
      const currentRunway = currentNetBurn > 0 ? cashBalance / currentNetBurn : 999;
      const adjustedRunway = adjustedNetBurn > 0 ? cashBalance / adjustedNetBurn : 999;
      const runwayImpact = adjustedRunway - currentRunway;
      
      // Decision logic
      let decision = '';
      let decisionClass = '';
      
      if (paybackMonths <= 12 && runwayImpact >= -3) {
        decision = 'Accretive Growth';
        decisionClass = 'strong';
      } else if (paybackMonths > 24 || runwayImpact < -6) {
        decision = 'Capital Destructive';
        decisionClass = 'fragile';
      } else {
        decision = 'Neutral / Proceed with Caution';
        decisionClass = 'moderate';
      }
      
      // Display results
      document.getElementById('allocationResults').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px;">
          <div class="kpi-box">
            <div class="kpi-box-label">Effective CAC</div>
            <div class="kpi-box-value" style="font-size: 20px;">${formatCurrency(effectiveCAC)}</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label"><span class="term-helper" data-definition="Simple Payback: Months to recover investment through gross profit. Does not include time value of money or discount rates.">Simple Payback</span></div>
            <div class="kpi-box-value" style="font-size: 20px;">${paybackMonths.toFixed(1)} mo</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">Incremental Gross Profit (12mo)</div>
            <div class="kpi-box-value" style="font-size: 20px;">${formatCurrency(incrementalGrossProfit)}</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label"><span class="term-helper" data-definition="Runway Impact: Change in months of runway after accounting for investment cost and new revenue. Negative means runway shortens; positive means it extends.">Runway Impact</span></div>
            <div class="kpi-box-value" style="font-size: 20px; color: ${runwayImpact >= 0 ? '#059669' : '#dc2626'};">${runwayImpact >= 0 ? '+' : ''}${runwayImpact.toFixed(1)} mo</div>
          </div>
        </div>
        
        <div style="padding: 16px; background: rgba(246, 248, 251, 0.5); border: 1px solid var(--border); border-radius: 12px;">
          <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--text);">
            Decision: <span class="${decisionClass}" style="font-size: 16px;">${decision}</span>
          </div>
          <div style="font-size: 13px; line-height: 1.6; color: var(--muted);">
            ${paybackMonths <= 12 
              ? `Quick payback (${paybackMonths.toFixed(1)} months) suggests this investment recovers quickly through gross profit.`
              : paybackMonths > 24
              ? `Long payback (${paybackMonths.toFixed(1)} months) means extended cash drag before break-even.`
              : `Moderate payback (${paybackMonths.toFixed(1)} months) is manageable but requires monitoring.`
            }
            ${runwayImpact >= 0
              ? ` Investment extends runway by ${runwayImpact.toFixed(1)} months‚Äîrevenue growth outpaces burn increase.`
              : Math.abs(runwayImpact) > 6
              ? ` <strong>Warning:</strong> Runway shortens by ${Math.abs(runwayImpact).toFixed(1)} months‚Äîsignificant liquidity risk.`
              : ` Runway shortens by ${Math.abs(runwayImpact).toFixed(1)} months‚Äîacceptable if ROI materializes.`
            }
          </div>
        </div>
      `;
    }
    
    // ========== WORKING CAPITAL FUNCTIONS ==========
    
    function computeWorkingCapital() {
      const arDays = parseFloat(document.getElementById('arDays').value) || 0;
      const apDays = parseFloat(document.getElementById('apDays').value) || 0;
      const deferredRevPct = parseFloat(document.getElementById('deferredRevPct').value) || 0;
      
      const data = runrateData[currentScenario];
      const avgRev = data.reduce((sum, d) => sum + d.mrr, 0) / data.length;
      const avgGM = data.reduce((sum, d) => sum + d.gm, 0) / data.length;
      const avgOpEx = data.reduce((sum, d) => sum + d.opex, 0) / data.length;
      
      // Approximate COGS from gross margin
      const cogs = avgRev * (1 - avgGM / 100);
      
      // Working capital components
      const arImpact = (avgRev * arDays) / 30; // Cash tied up in receivables
      const apBenefit = (cogs * apDays) / 30; // Cash preserved by delaying payment
      const deferredRevBenefit = (avgRev * (deferredRevPct / 100)); // Cash received upfront
      
      const netWCImpact = -arImpact + apBenefit + deferredRevBenefit;
      
      // Adjusted runway
      const cashBalance = parseFloat(document.getElementById('cashBalance').value) || 0;
      const netBurn = avgOpEx - (avgRev * (avgGM / 100));
      
      const baseRunway = netBurn > 0 ? cashBalance / netBurn : 999;
      const adjustedCash = cashBalance + netWCImpact;
      const adjustedRunway = netBurn > 0 ? adjustedCash / netBurn : 999;
      const runwayDelta = adjustedRunway - baseRunway;
      
      // Display results
      document.getElementById('wcResults').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px;">
          <div class="kpi-box">
            <div class="kpi-box-label">AR Impact</div>
            <div class="kpi-box-value" style="font-size: 18px; color: #dc2626;">-${formatCurrency(Math.abs(arImpact))}</div>
            <div style="font-size: 11px; color: var(--muted);">Cash tied up</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">AP Benefit</div>
            <div class="kpi-box-value" style="font-size: 18px; color: #059669;">+${formatCurrency(apBenefit)}</div>
            <div style="font-size: 11px; color: var(--muted);">Payment delay</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">Deferred Rev</div>
            <div class="kpi-box-value" style="font-size: 18px; color: #059669;">+${formatCurrency(deferredRevBenefit)}</div>
            <div style="font-size: 11px; color: var(--muted);">Upfront cash</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">Net WC Impact</div>
            <div class="kpi-box-value" style="font-size: 18px; color: ${netWCImpact >= 0 ? '#059669' : '#dc2626'};">${netWCImpact >= 0 ? '+' : ''}${formatCurrency(netWCImpact)}</div>
          </div>
        </div>
        
        <div style="padding: 16px; background: rgba(246, 248, 251, 0.5); border: 1px solid var(--border); border-radius: 12px;">
          <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--text);">
            Adjusted Runway: ${adjustedRunway > 900 ? 'Cash Generating' : adjustedRunway.toFixed(1) + ' months'}
            <span style="color: ${runwayDelta >= 0 ? '#059669' : '#dc2626'}; margin-left: 8px;">
              (${runwayDelta >= 0 ? '+' : ''}${runwayDelta.toFixed(1)} mo from WC)
            </span>
          </div>
          <div style="font-size: 13px; line-height: 1.6; color: var(--muted);">
            ${netWCImpact > 0 
              ? `Positive WC (${formatCurrency(netWCImpact)}) provides liquidity cushion‚Äîdeferred revenue and AP outweigh AR drag.`
              : `Negative WC (${formatCurrency(Math.abs(netWCImpact))}) consumes cash‚Äîreceivables collection lags outpace payment delays.`
            }
            <div style="margin-top: 8px; font-style: italic;">Working capital approximation for planning purposes.</div>
          </div>
        </div>
      `;
    }
    
    // ========== CSV DOWNLOADS ==========
    
    function downloadCACLTVCSV() {
      const inputs = cacLtvInputs[currentScenario];
      const cac = (inputs.marketingSpend + inputs.salesSpend) / inputs.newCustomers;
      const ltv = (inputs.arpa * (inputs.grossMargin / 100)) / (inputs.churnRate / 100);
      const ratio = ltv / cac;
      const payback = cac / (inputs.arpa * (inputs.grossMargin / 100));
      
      const headers = ['metric', 'value'];
      const rows = [
        { metric: 'CAC', value: cac.toFixed(2) },
        { metric: 'LTV', value: ltv.toFixed(2) },
        { metric: 'LTV:CAC', value: ratio.toFixed(2) },
        { metric: 'Payback_Months', value: payback.toFixed(2) }
      ];
      downloadCSV('cac_ltv_results.csv', headers, rows);
    }
    
    function downloadCACLTVTemplate() {
      const headers = ['newCustomers', 'marketingSpend', 'salesSpend', 'arpa', 'grossMargin', 'churnRate'];
      const rows = [{ newCustomers: 120, marketingSpend: 48000, salesSpend: 72000, arpa: 120, grossMargin: 72, churnRate: 3.5 }];
      downloadCSV('cac_ltv_template.csv', headers, rows);
    }
    
    function downloadContributionCSV() {
      const data = contributionData[currentScenario];
      const headers = ['month', 'revenue', 'cogs', 'paymentFees', 'supportCost', 'infraCost', 'contributionMargin', 'cmPercent'];
      const rows = data.map(d => {
        const totalVarCost = d.cogs + d.paymentFees + d.supportCost + d.infraCost;
        const cm = d.revenue - totalVarCost;
        const cmPct = (cm / d.revenue) * 100;
        return {
          month: d.month,
          revenue: d.revenue.toFixed(2),
          cogs: d.cogs.toFixed(2),
          paymentFees: d.paymentFees.toFixed(2),
          supportCost: d.supportCost.toFixed(2),
          infraCost: d.infraCost.toFixed(2),
          contributionMargin: cm.toFixed(2),
          cmPercent: cmPct.toFixed(2)
        };
      });
      downloadCSV('contribution_margin.csv', headers, rows);
    }
    
    function downloadContributionTemplate() {
      const headers = ['month', 'revenue', 'cogs', 'paymentFees', 'supportCost', 'infraCost'];
      const rows = [
        { month: 'Jan', revenue: 80000, cogs: 22400, paymentFees: 2000, supportCost: 500, infraCost: 300 },
        { month: 'Feb', revenue: 85000, cogs: 23800, paymentFees: 2125, supportCost: 550, infraCost: 330 }
      ];
      downloadCSV('contribution_template.csv', headers, rows);
    }
    
    function downloadRunrateCSV() {
      const data = runrateData[currentScenario];
      const headers = ['month', 'customers', 'mrr', 'expansion', 'churn', 'gm', 'opex'];
      const rows = data.map(d => ({
        month: d.month,
        customers: d.customers,
        mrr: d.mrr.toFixed(2),
        expansion: d.expansion.toFixed(2),
        churn: d.churn.toFixed(2),
        gm: d.gm.toFixed(2),
        opex: d.opex.toFixed(2)
      }));
      downloadCSV('runrate_forecast.csv', headers, rows);
    }
    
    function downloadRunrateTemplate() {
      const headers = ['month', 'customers', 'mrr', 'expansion', 'churn', 'gm', 'opex'];
      const rows = [
        { month: 1, customers: 350, mrr: 42000, expansion: 1.5, churn: 3.8, gm: 71, opex: 200000 },
        { month: 2, customers: 365, mrr: 46500, expansion: 1.53, churn: 3.785, gm: 71.1, opex: 202000 }
      ];
      downloadCSV('runrate_template.csv', headers, rows);
    }
    
    function downloadAllTemplates() {
      downloadCACLTVTemplate();
      setTimeout(() => downloadContributionTemplate(), 300);
      setTimeout(() => downloadRunrateTemplate(), 600);
    }
    
    // ========== RENDER ALL ==========
    
    function renderAll() {
      updateScenarioTooltips();
      computeCACLTV();
      computeCapitalAllocation();
      computeWorkingCapital();
      renderContribution();
      renderRunrate();
      renderBoardView();
    }
    
    // Update scenario tooltips with current data
    function updateScenarioTooltips() {
      ['base', 'upside', 'downside'].forEach(scenario => {
        const inputs = cacLtvInputs[scenario];
        const cac = (inputs.marketingSpend + inputs.salesSpend) / inputs.newCustomers;
        const payback = cac / (inputs.arpa * (inputs.grossMargin / 100));
        
        let description = '';
        let comparison = '';
        
        if (scenario === 'base') {
          description = 'Base Case: Standard performance with balanced assumptions.';
          comparison = '';
        } else if (scenario === 'upside') {
          const baseCac = (cacLtvInputs.base.marketingSpend + cacLtvInputs.base.salesSpend) / cacLtvInputs.base.newCustomers;
          const conversionPct = ((inputs.newCustomers / cacLtvInputs.base.newCustomers - 1) * 100).toFixed(0);
          const arpaPct = ((inputs.arpa / cacLtvInputs.base.arpa - 1) * 100).toFixed(0);
          description = 'Upside: Optimistic scenario.';
          comparison = ` ${conversionPct > 0 ? '+' : ''}${conversionPct}% conversion,`;
        } else {
          const conversionPct = ((inputs.newCustomers / cacLtvInputs.base.newCustomers - 1) * 100).toFixed(0);
          const arpaPct = ((inputs.arpa / cacLtvInputs.base.arpa - 1) * 100).toFixed(0);
          description = 'Downside: Conservative scenario.';
          comparison = ` ${conversionPct}% conversion,`;
        }
        
        const tooltip = `${description}${comparison} ${inputs.churnRate.toFixed(1)}% churn, $${Math.round(inputs.arpa)} ARPA, ${inputs.grossMargin.toFixed(0)}% gross margin, ~${payback.toFixed(1)} month payback.`;
        
        const helpIcon = document.getElementById(`${scenario}ScenarioHelp`);
        if (helpIcon) {
          helpIcon.setAttribute('data-help', tooltip);
        }
      });
    }
    
    // ========== INIT ==========
    
    window.addEventListener('DOMContentLoaded', () => {
      initializeSampleData();
      loadScenarioInputs();
      renderAll();
      setupChartInteractions();
    });
    
    window.addEventListener('resize', () => {
      renderContribution();
      renderRunrate();
    });
  </script>

</body>
</html>
