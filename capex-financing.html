<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Capex & Financing Decisions ¬∑ FP&A Portfolio</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/png" href="favicon.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* module-hero, module-label, module-title, module-subtitle, feature-chips, chip ‚Äî all in style.css */
    .module-layout { display: grid; grid-template-columns: 300px 1fr; gap: 24px; align-items: start; max-width: 1400px; margin: 0 auto; padding: 32px 24px; }
    .btn-small { padding: 8px 14px; font-size: 13px; border-radius: 999px; font-weight: 600; border: 1px solid var(--border); background: white; cursor: pointer; transition: all 140ms ease; width: 100%; text-align: left; }
    .btn-small:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .btn-small:active { transform: translateY(1px); }
    .btn-primary { background: var(--text); color: white; border-color: var(--text); }
    .input-row { display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }
    .input-row label { font-size: 12px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 6px; }
    .input-row input { padding: 9px 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 13px; font-family: var(--font-sans); background: white; width: 100%; }
    .input-row input:focus { outline: none; border-color: var(--accent); }
    .main-content { min-width: 0; }
    
    
    
    
    
    
    
    
    .decision-driver strong { color: rgba(255,255,255,0.9); }
    .module-section { padding: 0 0 40px 0; }
    .module-section-title { font-size: 22px; margin-bottom: 18px; letter-spacing: -0.02em; font-weight: 700; }
    .module-card { background: white; border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow-soft); }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 20px; }
    .kpi-box { padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: rgba(246,248,251,0.6); }
    .kpi-box-label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .kpi-box-value { font-size: 20px; font-weight: 700; }
    .kpi-box-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .kpi-box.highlight { border-color: var(--accent); background: rgba(15,118,110,0.06); }
    .board-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 16px; }
    .board-block { padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: rgba(246,248,251,0.5); }
    .board-block-title { font-size: 12px; color: var(--muted); font-weight: 600; margin-bottom: 8px; letter-spacing: 0.04em; }
    .board-block ul { margin: 0; padding: 0 0 0 16px; display: grid; gap: 6px; }
    .board-block ul li { font-size: 13px; }
    .what-means { margin-bottom: 16px; padding: 14px; border-left: 3px solid var(--accent); background: rgba(15,118,110,0.04); border-radius: 6px; }
    .what-means p { font-size: 14px; color: var(--text); line-height: 1.6; }
    .chart-wrap { position: relative; width: 100%; overflow-anchor: none; }
    .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .data-table th { text-align: left; padding: 10px 12px; border-bottom: 2px solid var(--border); font-weight: 650; font-size: 12px; }
    .data-table td { padding: 9px 12px; border-bottom: 1px solid var(--border); }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover { background: rgba(246,248,251,0.5); }
    .section-header-with-help { display: flex; align-items: center; gap: 10px; margin-bottom: 18px; }
    .data-badge { font-size: 12px; padding: 6px 12px; border-radius: 999px; background: rgba(15,118,110,0.10); border: 1px solid rgba(15,118,110,0.20); color: var(--accent); font-weight: 600; display: inline-block; margin-bottom: 10px; }
    .data-badge.random { background: #fef3c7; border: 1px solid #fbbf24; color: #92400e; }
    .option-tabs { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-bottom: 20px; }
    .option-tab { padding: 12px; border: 1px solid var(--border); border-radius: var(--radius-sm); text-align: center; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 140ms; }
    .option-tab.best { border-color: var(--accent); background: rgba(15,118,110,0.08); color: var(--accent); }
    @media (max-width: 860px) { .module-layout { grid-template-columns: 1fr; }
 .board-grid { grid-template-columns: 1fr; } }
  
    /* ---- Decision Box (matches commercial-sales.html) ---- */
    .decision-box {
      background: white;
      border: 1.5px solid var(--accent);
      border-radius: var(--radius);
      padding: 20px 24px;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.08), var(--shadow-soft);
      margin-bottom: 24px;
      transition: border-color 200ms ease, box-shadow 200ms ease, background 200ms ease;
    }
    .decision-box--positive {
      border-color: #0f766e;
      background: #f0fdf9;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.10), var(--shadow-soft);
    }
    .decision-box--positive .decision-box-eyebrow { color: #0f766e; }
    .decision-box--positive .verdict-action        { color: #0f766e; }
    .decision-box--positive .decision-box-bullets li::before { color: #0f766e; }
    .decision-box--warning {
      border-color: #d97706;
      background: #fffbeb;
      box-shadow: 0 0 0 4px rgba(217,119,6,0.10), var(--shadow-soft);
    }
    .decision-box--warning .decision-box-eyebrow { color: #d97706; }
    .decision-box--warning .verdict-action        { color: #d97706; }
    .decision-box--warning .decision-box-bullets li::before { color: #d97706; }
    .decision-box--negative {
      border-color: #dc2626;
      background: #fef2f2;
      box-shadow: 0 0 0 4px rgba(220,38,38,0.10), var(--shadow-soft);
    }
    .decision-box--negative .decision-box-eyebrow { color: #dc2626; }
    .decision-box--negative .verdict-action        { color: #dc2626; }
    .decision-box--negative .decision-box-bullets li::before { color: #dc2626; }
    .decision-box-eyebrow {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--accent);
      margin-bottom: 8px;
    }
    .decision-box-verdict {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text);
      margin-bottom: 12px;
    }
    .decision-box-verdict .verdict-action { color: var(--accent); }
    .decision-box-bullets {
      list-style: none;
      margin: 0 0 10px 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .decision-box-bullets li {
      font-size: 13px;
      color: var(--muted);
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.4;
    }
    .decision-box-bullets li::before {
      content: '‚Ä∫';
      color: var(--accent);
      font-weight: 700;
      flex-shrink: 0;
    }
    .decision-box-next {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      border-top: 1px solid var(--border);
      padding-top: 10px;
    }
    .decision-box-next span { color: var(--accent-2); }
    .decision-box-fallback {
      font-size: 14px;
      color: var(--muted);
      font-style: italic;
    }

      .main-content { overflow-anchor: none; }
    .module-card { overflow-anchor: none; }
    .data-table { overflow-anchor: none; }
  
    /* ‚îÄ‚îÄ Data-needed strip ‚îÄ‚îÄ */
    .data-needed-section {
      padding: 0 0 0 0;
      border-bottom: 1px solid var(--border, #e5e8ef);
    }
    .data-needed-wrap {
      max-width: var(--max-w, 1200px);
      margin: 0 auto;
      padding: 20px 32px 24px;
    }
    .data-needed-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--muted, #6b7280);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .data-needed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(185px, 1fr));
      gap: 8px;
      align-items: stretch;
    }
    .data-needed-item {
      padding: 10px 12px;
      border: 1px solid var(--border, #e5e8ef);
      border-radius: 9px;
      display: flex;
      align-items: flex-start;
      gap: 9px;
      background: #fafbfc;
      min-height: 88px;
      box-sizing: border-box;
    }
    .data-needed-icon {
      width: 26px;
      height: 26px;
      font-size: 13px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }
    .data-needed-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text, #0b1220);
      margin-bottom: 3px;
      line-height: 1.35;
    }
    .data-needed-desc {
      font-size: 10px;
      color: var(--muted, #6b7280);
      line-height: 1.5;
    }


    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIDEBAR ‚Äî Accordion (shared across all modules)
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .sidebar {
      position: sticky;
      top: 80px;
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      max-height: calc(100vh - 100px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(12,23,45,0.15) transparent;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(12,23,45,0.15); border-radius: 4px; }
    .sidebar::-webkit-scrollbar-thumb:hover { background: rgba(12,23,45,0.28); }

    /* Static top section (data mode badge + always-visible controls) */
    .sb-static {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .sb-static-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    /* Accordion group */
    .sb-acc-group {
      border-bottom: 1px solid var(--border);
    }
    .sb-acc-group:last-child { border-bottom: none; }

    .sb-acc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      transition: color 120ms ease;
    }
    .sb-acc-header:hover { color: var(--text); }
    .sb-acc-header.open  { color: var(--text); }
    .sb-acc-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 200ms ease;
      flex-shrink: 0;
    }
    .sb-acc-header.open .sb-acc-chevron {
      transform: rotate(180deg);
      color: var(--text);
    }
    .sb-acc-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft, rgba(15,118,110,0.10));
      color: var(--accent, #0f766e);
      flex-shrink: 0;
      margin-left: auto;
    }

    .sb-acc-body {
      display: none;
      padding-bottom: 14px;
    }
    .sb-acc-body.open { display: block; }

    /* Buttons inside accordion */
    .sb-acc-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: all 140ms ease;
      text-align: left;
      white-space: nowrap;
      font-family: inherit;
    }
    .sb-acc-btn:first-child { margin-top: 0; }
    .sb-acc-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .sb-acc-btn:active { transform: translateY(1px); }
    .sb-acc-btn.primary { background: var(--text, #0b1220); color: white; border-color: var(--text, #0b1220); }
    .sb-acc-btn.primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-acc-btn.accent  { background: var(--accent, #0f766e); color: white; border-color: var(--accent, #0f766e); }

    /* Scenario tabs inside accordion */
    .sb-acc-tabs { display: flex; flex-direction: column; gap: 6px; }
    .sb-acc-tab {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }
    .sb-acc-tab:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-tab.active { background: var(--text, #0b1220); color: white; border-color: var(--text, #0b1220); }

    /* Input rows inside accordion */
    .sb-acc-input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .sb-acc-input-row:last-child { margin-bottom: 0; }
    .sb-acc-input-row label {
      font-size: 11px;
      color: var(--muted, #5d6b7a);
      flex: 1;
      line-height: 1.3;
    }
    .sb-acc-input-row input[type="number"] {
      width: 76px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: inherit;
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .sb-acc-input-row input[type="number"]::-webkit-outer-spin-button,
    .sb-acc-input-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sb-acc-input-row input[type="number"]:focus {
      outline: none;
      border-color: var(--accent, #0f766e);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .sb-acc-sub {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 8px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* Responsive: on mobile sidebar goes full width, no sticky, no scroll */
    @media (max-width: 860px) {
      .sidebar {
        position: static;
        max-height: none;
        overflow-y: visible;
      }
    }

  
    /* ‚îÄ‚îÄ Tooltip engine: body-level fixed div, never clipped by overflow ‚îÄ‚îÄ */
    /* Kill ALL CSS ::after tooltip rules ‚Äî they clip inside overflow containers */
    .help-icon::after,
    .help-icon:hover::after,
    .help-icon[data-help]::after,
    [data-tt]::after,
    [data-tt]:hover::after,
    .term-helper::after,
    .term-helper:hover::after {
      content: none !important;
      display: none !important;
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
    }

    /* #tt-root ‚Äî single fixed tooltip bubble appended to <body> by JS */
    #tt-root {
      position: fixed;
      z-index: 99999;
      pointer-events: none;
      padding: 9px 13px;
      background: rgba(11,18,32,0.95);
      color: #f0f4f8;
      font-size: 12px;
      font-weight: 400;
      line-height: 1.55;
      border-radius: 9px;
      white-space: normal;
      width: 260px;
      max-width: calc(100vw - 24px);
      box-shadow: 0 4px 18px rgba(0,0,0,0.28);
      text-align: left;
      opacity: 0;
      transition: opacity 120ms ease;
    }
    #tt-root.tt-visible { opacity: 1; }

    /* .help-icon visual ‚Äî keep the badge, remove position:relative (no longer needed) */
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-size: 11px;
      font-weight: 700;
      cursor: help;
      flex-shrink: 0;
      position: static;   /* was relative ‚Äî not needed with body-level tooltip */
    }
    .help-icon::before { content: '?'; line-height: 1; }

  
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SHARED SIDEBAR SHELL ‚Äî standardised across all modules
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Layout */
    .module-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      align-items: start;
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .main-content { min-width: 0; }

    /* Mobile Controls Toggle Button */
    .mobile-controls-btn {
      display: none;
      align-items: center;
      gap: 10px;
      width: 100%;
      padding: 12px 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      cursor: pointer;
      margin-bottom: 4px;
      box-shadow: var(--shadow-soft);
      transition: all 140ms ease;
    }
    .mobile-controls-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: var(--shadow);
    }
    .mobile-controls-btn .mcb-icon { font-size: 16px; flex-shrink: 0; }
    .mobile-controls-btn .mcb-label { flex: 1; text-align: left; }
    .mobile-controls-btn .mcb-chevron {
      font-size: 11px; color: var(--muted);
      transition: transform 200ms ease;
    }
    .mobile-controls-btn[aria-expanded="true"] .mcb-chevron { transform: rotate(180deg); }

    /* Sidebar shell */
    .sidebar {
      position: sticky;
      top: calc(var(--nav-h, 56px) + 36px);
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      max-height: calc(100vh - var(--nav-h, 56px) - 52px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(12,23,45,0.15) transparent;
      width: 280px;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(12,23,45,0.15); border-radius: 4px; }
    .sidebar::-webkit-scrollbar-thumb:hover { background: rgba(12,23,45,0.28); }

    /* Static section (Data Mode etc ‚Äî always visible) */
    .sb-static {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .sb-static-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    /* ‚îÄ‚îÄ Data Mode segmented control (fixed height, no wrapping) ‚îÄ‚îÄ */
    .sb-data-mode-row {
      display: flex;
      gap: 0;
      height: 34px;              /* fixed height ‚Äî prevents layout shift */
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-muted);
      flex-wrap: nowrap;         /* never wrap */
    }
    .sb-data-mode-btn {
      flex: 1;
      min-width: 0;
      height: 100%;
      padding: 0 4px;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: inherit;
    }
    .sb-data-mode-btn:last-child { border-right: none; }
    .sb-data-mode-btn:hover { background: rgba(12,23,45,0.04); color: var(--text); }
    .sb-data-mode-btn.active {
      background: var(--text);
      color: white;
    }

    /* Mode pills (2-option) ‚Äî also fixed height */
    .sb-mode-pills {
      display: flex;
      gap: 0;
      height: 34px;
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-muted);
      flex-wrap: nowrap;
    }
    .sb-mode-pill {
      flex: 1;
      height: 100%;
      padding: 0 6px;
      border: none;
      border-right: 1px solid var(--border);
      background: transparent;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: inherit;
      text-align: center;
    }
    .sb-mode-pill:last-child { border-right: none; }
    .sb-mode-pill:hover { background: rgba(12,23,45,0.04); color: var(--text); }
    .sb-mode-pill.active { background: var(--text); color: white; }

    /* Badge */
    .data-badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-weight: 600;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .data-badge.random {
      background: #fef3c7;
      border-color: #fbbf24;
      color: #92400e;
    }

    /* Accordion groups */
    .sb-acc-group {
      border-bottom: 1px solid var(--border);
    }
    .sb-acc-group:last-child { border-bottom: none; }

    .sb-acc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      transition: color 120ms ease;
      font-family: inherit;
    }
    .sb-acc-header:hover { color: var(--text); }
    .sb-acc-header.open  { color: var(--text); }
    .sb-acc-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 200ms ease;
      flex-shrink: 0;
    }
    .sb-acc-header.open .sb-acc-chevron { transform: rotate(180deg); color: var(--text); }
    .sb-acc-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      flex-shrink: 0;
      margin-left: auto;
    }

    .sb-acc-body {
      display: none;
      padding-bottom: 14px;
    }
    .sb-acc-body.open { display: block; }

    /* Buttons inside accordion */
    .sb-acc-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: all 140ms ease;
      text-align: left;
      white-space: nowrap;
      font-family: inherit;
    }
    .sb-acc-btn:first-child { margin-top: 0; }
    .sb-acc-btn:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-btn:active { transform: translateY(1px); }
    .sb-acc-btn.primary { background: var(--text); color: white; border-color: var(--text); }
    .sb-acc-btn.primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-acc-btn.accent  { background: var(--accent); color: white; border-color: var(--accent); }

    /* Tabs (scenario selectors etc.) */
    .sb-acc-tabs { display: flex; flex-direction: column; gap: 6px; }
    .sb-acc-tab {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }
    .sb-acc-tab:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-tab.active { background: var(--text); color: white; border-color: var(--text); }

    /* Input rows */
    .sb-acc-input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .sb-acc-input-row:last-child { margin-bottom: 0; }
    .sb-acc-input-row label {
      font-size: 11px;
      color: var(--muted);
      flex: 1;
      line-height: 1.3;
    }
    .sb-acc-input-row input[type="number"] {
      width: 76px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: inherit;
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .sb-acc-input-row input[type="number"]::-webkit-outer-spin-button,
    .sb-acc-input-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sb-acc-input-row input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .sb-acc-sub {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 8px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* Action buttons (full-width) */
    .sb-action-btn {
      display: flex; align-items: center; gap: 8px;
      width: 100%; padding: 7px 12px;
      border-radius: 999px; border: 1px solid var(--border);
      background: white; font-size: 12px; font-weight: 600;
      cursor: pointer; margin-top: 6px;
      transition: all 140ms ease; text-align: left;
      white-space: nowrap; font-family: inherit;
    }
    .sb-action-btn:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-action-btn:active { transform: translateY(1px); }
    .sb-action-btn.sb-action-primary { background: var(--text); color: white; border-color: var(--text); }
    .sb-action-btn.sb-action-primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-action-btn.sb-action-accent  { background: var(--accent); color: white; border-color: var(--accent); }
    .sb-file-hidden { position: absolute; opacity: 0; width: 0; height: 0; }

    /* Sliders */
    .control-item { margin-bottom: 16px; }
    .control-item:last-child { margin-bottom: 0; }
    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text);
    }
    .control-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-2);
      font-family: var(--font-mono, monospace);
    }
    .control-input {
      -webkit-appearance: none; appearance: none;
      width: 100%; height: 6px;
      border-radius: 3px;
      background: var(--bg-muted);
      outline: none; cursor: pointer;
    }
    .control-input::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,118,110,0.3);
      transition: all 140ms ease;
    }
    .control-input::-webkit-slider-thumb:hover { transform: scale(1.1); }
    .control-input::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,118,110,0.3); border: none;
    }

    /* ‚îÄ‚îÄ Mobile responsive ‚îÄ‚îÄ */
    @media (max-width: 860px) {
      .module-layout {
        grid-template-columns: 1fr;
        padding: 16px;
      }
      .mobile-controls-btn { display: flex; }
      .sidebar {
        position: static;
        top: 0;
        width: 100%;
        max-height: none;
        overflow-y: visible;
        display: none;            /* hidden by default; JS toggles */
        border-radius: var(--radius-sm);
        margin-bottom: 8px;
      }
      .sidebar.mobile-open { display: block; }
    }

    @media (max-width: 560px) {
      .module-layout { padding: 12px; }
    }


</style>
<style>
/* ‚îÄ‚îÄ Global Time Ticker ‚îÄ‚îÄ */
.tz-live-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:#10b981;box-shadow:0 0 0 0 rgba(16,185,129,.4);animation:tzPulse 2.4s ease-in-out infinite;flex-shrink:0}
@keyframes tzPulse{0%{box-shadow:0 0 0 0 rgba(16,185,129,.4)}60%{box-shadow:0 0 0 5px rgba(16,185,129,0)}100%{box-shadow:0 0 0 0 rgba(16,185,129,0)}}
.tz-ticker{position:sticky;top:var(--nav-h,56px);z-index:89;background:rgba(250,251,252,.96);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-bottom:1px solid var(--border);height:36px;display:flex;align-items:center;opacity:0;pointer-events:none;transform:translateY(-4px);transition:opacity 220ms ease,transform 220ms ease}
.tz-ticker.tz-ticker--visible{opacity:1;pointer-events:auto;transform:translateY(0)}
.tz-ticker-inner{max-width:900px;width:100%;margin:0 auto;padding:0 24px;display:flex;align-items:center;overflow:hidden}
.tz-ticker-brand{display:inline-flex;align-items:center;gap:5px;font-size:10px;font-weight:750;letter-spacing:.07em;text-transform:uppercase;color:var(--accent);text-decoration:none;flex-shrink:0;padding-right:10px}
.tz-ticker-brand:hover{opacity:.75}
.tz-ticker-divider{width:1px;height:16px;background:var(--border);flex-shrink:0;margin-right:10px}
.tz-ticker-items{display:flex;align-items:center;overflow-x:auto;scrollbar-width:none;-ms-overflow-style:none;flex:1;min-width:0}
.tz-ticker-items::-webkit-scrollbar{display:none}
.tz-ticker-item{display:inline-flex;align-items:center;gap:5px;padding:0 12px;height:36px;font-size:11px;flex-shrink:0;border-right:1px solid var(--border);white-space:nowrap}
.tz-ticker-item:first-child{padding-left:0}.tz-ticker-item:last-child{border-right:none}
.tz-ticker-item-label{font-size:9px;font-weight:700;letter-spacing:.07em;text-transform:uppercase;color:var(--muted)}
.tz-ticker-item-value{font-size:11px;font-weight:620;color:var(--text);font-variant-numeric:tabular-nums}
.tz-ticker-item-value.tk-active{color:#059669;font-weight:700}.tz-ticker-item-value.tk-ending{color:#d97706;font-weight:700}.tz-ticker-item-value.tk-offline{color:#94a3b8}.tz-ticker-item-value.tk-window{color:var(--accent);font-weight:680}
.tz-ticker-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0}
.tz-ticker-dot.tk-active{background:#059669}.tz-ticker-dot.tk-ending{background:#d97706}.tz-ticker-dot.tk-offline{background:#cbd5e1}
@media(max-width:640px){.tz-ticker-inner{padding:0 12px}.tz-ticker-item{padding:0 9px}}
</style>
</head>
<body>
<a class="skip-link" href="#main">Skip to content</a>
<header class="site-header">
  <div class="container">
    <nav class="nav" aria-label="Main navigation">
      <a href="index.html" class="brand">
        <span class="brand-mark" aria-hidden="true"></span>
        Ralph Patrick Divina
      </a>
      <div class="nav-cta">
        <a href="index.html#card-capex-financing" class="btn btn-ghost">&larr; Back to Portfolio</a>
      </div>
    </nav>
  </div>
</header>
</header>
<!-- Global Time Ticker -->
<div class="tz-ticker tz-ticker--visible" id="tz-ticker" aria-label="Global time coordination summary">
  <div class="tz-ticker-inner">
    <a class="tz-ticker-brand" href="index.html#tz-world" aria-label="Go to Time section">
      <span class="tz-live-dot"></span>
      <span>Time</span>
    </a>
    <div class="tz-ticker-divider"></div>
    <div class="tz-ticker-items" id="tz-ticker-items"><!-- JS-rendered --></div>
  </div>
</div>

<main id="main">
  <section class="module-hero">
    <div class="container">
      <div class="module-eyebrow">Capex &bull; Capital Decisions</div>
      <h1 class="module-title">Capex &amp; Financing Decisions</h1>
      <p class="module-subtitle">Compare buy vs loan vs lease and see impact on cash, NPV, and payback.</p>
      <div class="feature-chips">
        <span class="chip">Cash vs Finance</span>
        <span class="chip">NPV</span>
        <span class="chip">Payback</span>
        <span class="chip">Depreciation</span>
      </div>
    </div>
  </section>

  <!-- DATA NEEDED STRIP -->
  <div class="data-needed-section">
    <div class="data-needed-wrap">
      <div class="data-needed-label">üìÇ &nbsp;Data needed for this module</div>
      <div class="data-needed-grid">
        <div class="data-needed-item"><div class="data-needed-icon" style="background:#eff6ff;">üè∑Ô∏è</div><div><div class="data-needed-name">Asset Quote / Cost Estimate</div><div class="data-needed-desc">Purchase price or project cost ‚Üí the capex amount being evaluated</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f0fdf9;">üè¶</div><div><div class="data-needed-name">Loan / Lease Term Sheet</div><div class="data-needed-desc">Interest rate, term, residual value ‚Üí financing option inputs</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fef3c7;">üìä</div><div><div class="data-needed-name">Depreciation Policy</div><div class="data-needed-desc">Useful life &amp; method (straight-line etc.) ‚Üí depreciation schedule</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f5f3ff;">üíµ</div><div><div class="data-needed-name">Cash Flow Forecast</div><div class="data-needed-desc">Available cash &amp; burn rate ‚Üí assesses cash purchase feasibility</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fdf2f8;">üìà</div><div><div class="data-needed-name">Discount Rate / WACC</div><div class="data-needed-desc">Cost of capital for the business ‚Üí NPV &amp; IRR comparison</div></div></div>
      </div>
    </div>
  </div>

  <div class="module-layout">
        <!-- Mobile Controls Toggle (hidden on desktop) -->
    <button class="mobile-controls-btn" id="mobileControlsBtn" aria-expanded="false">
      <span class="mcb-icon">&#9881;</span>
      <span class="mcb-label">Controls</span>
      <span class="mcb-chevron">&#9660;</span>
    </button>
    <aside class="sidebar" id="sidebarPanel">

      <!-- Data Mode ‚Äî always visible -->
      <div class="sb-static">
        <div class="sb-static-title">
          <span>DATA MODE</span>
          <span id="dataModeBadge" class="data-badge">SAMPLE</span>
        </div>
        <div style="display:flex;gap:0;height:34px;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--bg-muted);flex-wrap:nowrap;">
          <button id="btnSampleMode" onclick="loadSample()" style="flex:1;height:100%;padding:0 4px;background:var(--text);color:white;border:none;border-right:1px solid var(--border);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;">Sample</button>
          <button id="btnRandomMode" onclick="randomizeData()" style="flex:1;height:100%;padding:0 4px;background:transparent;border:none;font-size:12px;font-weight:600;color:var(--muted);cursor:pointer;font-family:inherit;">Random</button>
        </div>
        <div style="font-size:10px;color:var(--muted);margin-top:6px;line-height:1.4;">Sample = fixed demo dataset &bull; Random = generated dataset</div>
      </div>

      <!-- Scenario ‚Äî standard accordion with badge and tooltips -->
      <div class="sb-acc-group">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Scenario</span>
          <span id="sbScenarioLabel" class="sb-acc-badge">Base Case</span>
          <span class="sb-acc-chevron">‚ñº</span>
        </button>
        <div class="sb-acc-body">
          <div class="sb-acc-tabs">
            <div style="display:flex;align-items:center;gap:8px;">
              <button class="sb-acc-tab active" onclick="setCapexScenario('base')" data-scenario="base" style="flex:1;">Base Case</button>
              <span class="help-icon" data-help="Base Case: Standard market conditions ‚Äî loan rate at entered value, lease at entered monthly, asset cost as specified. Use as your planning baseline." style="flex-shrink:0;"></span>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <button class="sb-acc-tab" onclick="setCapexScenario('upside')" data-scenario="upside" style="flex:1;">Upside</button>
              <span class="help-icon" data-help="Upside (+15% savings): Favourable financing ‚Äî loan rate -15% lower, lease payment -15% lower. Models a strong negotiating position or competitive lender market. Metrics improving: NPV cost drops, monthly payment falls, more options become viable." style="flex-shrink:0;"></span>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <button class="sb-acc-tab" onclick="setCapexScenario('downside')" data-scenario="downside" style="flex:1;">Downside</button>
              <span class="help-icon" data-help="Downside (-15% worse): Tighter credit conditions ‚Äî loan rate +15% higher, lease payment +15% higher. Models rising rates or weak negotiating position. Metrics impacted: NPV cost rises, monthly payment increases, cash purchase becomes relatively more attractive." style="flex-shrink:0;"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Asset Details -->
      <div class="sb-acc-group">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Asset Details</span>
          <span class="sb-acc-chevron">‚ñº</span>
        </button>
        <div class="sb-acc-body" style="padding-top:6px;">
          <div class="sb-acc-input-row">
            <label>Asset Cost ($) <span class="help-icon" data-help="The total purchase price of the asset ‚Äî e.g., a machine, vehicle, or equipment."></span></label>
            <input type="number" id="inp-cost" value="250000" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Useful Life (years) <span class="help-icon" data-help="How many years the asset will be used before it's replaced or worn out."></span></label>
            <input type="number" id="inp-life" value="5" step="1" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Salvage Value ($) <span class="help-icon" data-help="What the asset is worth at the end of its useful life ‚Äî what you can sell it for."></span></label>
            <input type="number" id="inp-salvage" value="25000" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Starting Cash ($) <span class="help-icon" data-help="How much cash the business has before making this financing decision."></span></label>
            <input type="number" id="inp-startcash" value="600000" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Discount Rate (%) <span class="help-icon" data-help="Your cost of capital ‚Äî used to discount future cash flows to today's value (NPV)."></span></label>
            <input type="number" id="inp-discount" value="10" step="0.5" oninput="withStableScroll(compute)">
          </div>
        </div>
      </div>

      <!-- Loan Options -->
      <div class="sb-acc-group">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Option B ‚Äî Loan</span>
          <span class="sb-acc-chevron">‚ñº</span>
        </button>
        <div class="sb-acc-body" style="padding-top:6px;">
          <div class="sb-acc-input-row">
            <label>Interest Rate (%) <span class="help-icon" data-help="Annual interest rate on the loan. The bank's fee for lending you money."></span></label>
            <input type="number" id="inp-rate" value="8" step="0.5" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Loan Term (months) <span class="help-icon" data-help="How many months to repay the loan. Longer = smaller payments but more total interest."></span></label>
            <input type="number" id="inp-term" value="48" step="6" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Down Payment ($) <span class="help-icon" data-help="How much you pay upfront when taking the loan. Reduces the amount financed."></span></label>
            <input type="number" id="inp-down" value="50000" oninput="withStableScroll(compute)">
          </div>
        </div>
      </div>

      <!-- Lease Options -->
      <div class="sb-acc-group">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Option C ‚Äî Lease</span>
          <span class="sb-acc-chevron">‚ñº</span>
        </button>
        <div class="sb-acc-body" style="padding-top:6px;">
          <div class="sb-acc-input-row">
            <label>Monthly Lease ($) <span class="help-icon" data-help="Fixed monthly payment to use the asset without owning it. Like renting."></span></label>
            <input type="number" id="inp-lease" value="5200" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Lease Term (months) <span class="help-icon" data-help="How long the lease agreement lasts. After this, return or renew."></span></label>
            <input type="number" id="inp-leaseTerm" value="60" step="6" oninput="withStableScroll(compute)">
          </div>
        </div>
      </div>

    </aside>

    <div class="main-content">
            <div class="decision-box" id="decisionBox">
        <div class="decision-box-eyebrow">Decision</div>
        <div class="decision-box-fallback" id="decisionFallback">Load sample data or adjust assumptions to see the decision.</div>
        <div id="decisionContent" style="display:none;">
          <div class="decision-box-verdict" id="decisionVerdict"></div>
          <ul class="decision-box-bullets" id="decisionBullets"></ul>
          <div class="decision-box-next" id="decisionNext"></div>
        </div>
      </div>

      <!-- Option comparison tabs -->
      <div class="option-tabs" id="option-tabs">
        <div class="option-tab" id="tab-cash"><strong>Option A: Pay Cash</strong><div style="font-size:11px;margin-top:4px;color:var(--muted)" id="tab-cash-sub">‚Äî</div></div>
        <div class="option-tab" id="tab-loan"><strong>Option B: Loan</strong><div style="font-size:11px;margin-top:4px;color:var(--muted)" id="tab-loan-sub">‚Äî</div></div>
        <div class="option-tab" id="tab-lease"><strong>Option C: Lease</strong><div style="font-size:11px;margin-top:4px;color:var(--muted)" id="tab-lease-sub">‚Äî</div></div>
      </div>

      <!-- Board View -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Board View</h2>
          <span class="help-icon" data-help="Executive summary comparing all three financing options."></span>
        </div>
        <div class="kpi-grid">
          <div class="kpi-box"><div class="kpi-box-label">Recommended</div><div class="kpi-box-value" id="kpi-rec" style="font-size:16px">‚Äî</div><div class="kpi-box-sub">best option</div></div>
          <div class="kpi-box"><div class="kpi-box-label">Cash Option NPV</div><div class="kpi-box-value" id="kpi-npv-cash">‚Äî</div><div class="kpi-box-sub">total cost (PV)</div></div>
          <div class="kpi-box"><div class="kpi-box-label">Loan Option NPV</div><div class="kpi-box-value" id="kpi-npv-loan">‚Äî</div><div class="kpi-box-sub">total cost (PV)</div></div>
          <div class="kpi-box"><div class="kpi-box-label">Lease Option NPV</div><div class="kpi-box-value" id="kpi-npv-lease">‚Äî</div><div class="kpi-box-sub">total cost (PV)</div></div>
          <div class="kpi-box"><div class="kpi-box-label">Monthly Payment</div><div class="kpi-box-value" id="kpi-loanpmt">‚Äî</div><div class="kpi-box-sub">loan monthly</div></div>
          <div class="kpi-box"><div class="kpi-box-label">Annual Depreciation</div><div class="kpi-box-value" id="kpi-depr">‚Äî</div><div class="kpi-box-sub">straight-line</div></div>
        </div>
        <div class="module-card">
          <div id="what-means" class="what-means"><p>Load data to see summary.</p></div>
          <div class="board-grid">
            <div class="board-block"><div class="board-block-title">‚ö† RISKS & WATCHOUTS</div><ul id="risks-list"><li>‚Äî</li></ul></div>
            <div class="board-block"><div class="board-block-title">üîß LEVERS TO PULL</div><ul id="levers-list"><li>‚Äî</li></ul></div>
          </div>
        </div>
      </div>

      <!-- Cash Impact Chart -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Cash Balance Impact Over Time</h2>
          <span class="help-icon" data-help="How each financing option affects your cash balance month by month over the full comparison period."></span>
        </div>
        <div class="module-card">
          <div class="chart-wrap"><canvas id="chart-cash" height="180"></canvas></div>
          <!-- Cash Impact Explainer -->
          <div id="cashimpact-explainer" style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px; display:none;">
            <div id="cashimpact-live-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">Recommended Option</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="cashimpact-rec-value" style="font-size:26px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">‚Äî</span>
                  <span id="cashimpact-live-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Cash Headroom</div>
                <div id="cashimpact-headroom-label" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>
            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">üìñ WHAT YOU'RE LOOKING AT</div>
            <div id="cashimpact-verdict-block" style="padding:12px 16px; border-radius:10px; font-size:13px; line-height:1.6; margin-bottom:10px;"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              This chart shows how your starting cash balance changes over time under each option. <strong>Pay Cash</strong> (blue) drops immediately but has no ongoing cost. <strong>Loan</strong> (green) uses a down payment then bleeds monthly. <strong>Lease</strong> (orange) preserves the most cash upfront but costs most over time. The recommended option is the lowest NPV-cost path given your current cash position.
            </div>
          </div>
        </div>
      </div>

      <!-- Monthly Payment Comparison -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Monthly Cash Outflow Comparison</h2>
          <span class="help-icon" data-help="Compares the monthly cash you spend under each option. Cash option has no ongoing payments after purchase."></span>
        </div>
        <div class="module-card">
          <div class="chart-wrap"><canvas id="chart-payments" height="120"></canvas></div>
          <!-- Monthly Outflow Explainer -->
          <div id="outflow-explainer" style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px; display:none;">
            <div id="outflow-live-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">Loan vs. Lease Monthly Difference</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="outflow-diff-value" style="font-size:32px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">‚Äî</span>
                  <span id="outflow-live-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Cheapest Monthly</div>
                <div id="outflow-cheapest-label" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>
            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">üìñ WHAT YOU'RE LOOKING AT</div>
            <div id="outflow-verdict-block" style="padding:12px 16px; border-radius:10px; font-size:13px; line-height:1.6; margin-bottom:10px;"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              This bar shows the <strong>recurring monthly cash outflow</strong> for each option during the payment period. Pay Cash shows $0/mo (the cost is all upfront). A lower bar means less monthly cash pressure ‚Äî important for businesses with tight operating cash flow. Compare this against your average monthly net cash flow to assess affordability.
            </div>
          </div>
        </div>
      </div>

      <!-- Depreciation Schedule -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Straight-Line Depreciation Schedule</h2>
          <span class="help-icon" data-help="Straight-line depreciation spreads the cost evenly over the asset's useful life. This affects P&L, not cash directly."></span>
        </div>
        <div class="module-card" style="overflow-x:auto;">
          <table class="data-table" id="depr-table">
            <thead><tr><th>Year</th><th>Opening BV</th><th>Depreciation</th><th>Closing BV</th></tr></thead>
            <tbody id="depr-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Next Module ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <nav class="next-module-bar" aria-label="Next recommended module">
    <div>
      <div class="next-module-label">Next recommended</div>
      <div class="next-module-title">KPI Tree &amp; Driver Sensitivity</div>
      <div class="next-module-why">Asset decision is made ‚Äî now rank which levers across the whole business move profit most.</div>
    </div>
    <div class="next-module-actions">
      <a class="btn btn-solid" href="kpi-tree-sensitivity.html">Open KPI Tree ‚Üí</a>
      <a class="btn btn-ghost" href="index.html">‚Üê Back to Portfolio</a>
    </div>
  </nav>

</main>

<a class="to-top" href="#main" aria-label="Back to top">‚Üë</a>
<script src="main.js"></script>
<script>
  let chartCash = null, chartPay = null;
  const fmtK = (n) => { const abs=Math.abs(n); const sign=n<0?'-':''; if(abs>=1000000) return sign+'$'+(abs/1000000).toFixed(1)+'M'; if(abs>=1000) return sign+'$'+(abs/1000).toFixed(0)+'K'; return sign+'$'+Math.round(abs); };
  const fmt = (n) => '$' + Math.round(n).toLocaleString();

  const SAMPLE = { cost:250000, life:5, salvage:25000, startcash:600000, discount:10, rate:8, term:48, down:50000, lease:5200, leaseTerm:60 };

  function getInputs() {
    return {
      cost: +document.getElementById('inp-cost').value,
      life: +document.getElementById('inp-life').value,
      salvage: +document.getElementById('inp-salvage').value,
      startcash: +document.getElementById('inp-startcash').value,
      discount: +document.getElementById('inp-discount').value / 100,
      rate: +document.getElementById('inp-rate').value / 100,
      term: +document.getElementById('inp-term').value,
      down: +document.getElementById('inp-down').value,
      lease: +document.getElementById('inp-lease').value,
      leaseTerm: +document.getElementById('inp-leaseTerm').value,
    };
  }

  function setInputs(v) {
    Object.keys(v).forEach(k => { const el = document.getElementById('inp-' + k); if (el) el.value = v[k]; });
  }

  function _setDataMode(mode) {
    var badge = document.getElementById('dataModeBadge');
    var s = document.getElementById('btnSampleMode');
    var r = document.getElementById('btnRandomMode');
    var isSample = mode === 'sample';
    if (badge) { badge.textContent = isSample ? 'SAMPLE' : 'RANDOM'; badge.className = isSample ? 'data-badge' : 'data-badge random'; }
    if (s) { s.style.background = isSample ? 'var(--text)' : 'transparent'; s.style.color = isSample ? 'white' : 'var(--muted)'; }
    if (r) { r.style.background = !isSample ? 'var(--text)' : 'transparent'; r.style.color = !isSample ? 'white' : 'var(--muted)'; }
  }
  function loadSample() {
    withStableScroll(function(){
      setInputs(SAMPLE);
      _baseRate = SAMPLE.rate; _baseLease = SAMPLE.lease;
      capexScenario = 'base';
      document.querySelectorAll('.sb-acc-tab[data-scenario]').forEach(t => t.classList.toggle('active', t.dataset.scenario === 'base'));
      var lbl = document.getElementById('sbScenarioLabel'); if (lbl) lbl.textContent = 'Base Case';
      _setDataMode('sample'); compute();
    });
  }
  function randomizeData() {
    withStableScroll(function(){
    const r=(a,b,s=1)=>Math.round((a+Math.random()*(b-a))/s)*s;
    var vals = { cost:r(50000,1000000,10000), life:r(3,10,1), salvage:r(0,50000,5000), startcash:r(100000,2000000,50000), discount:r(6,15,0.5), rate:r(4,15,0.5), term:r(24,72,12), down:r(0,100000,5000), lease:r(500,20000,100), leaseTerm:r(24,84,12) };
    setInputs(vals);
    _baseRate = vals.rate; _baseLease = vals.lease;
    capexScenario = 'base';
    document.querySelectorAll('.sb-acc-tab[data-scenario]').forEach(t => t.classList.toggle('active', t.dataset.scenario === 'base'));
    var lbl = document.getElementById('sbScenarioLabel'); if (lbl) lbl.textContent = 'Base Case';
    _setDataMode('random'); compute();
    });
  }
  function resetDefaults() { withStableScroll(function(){ setInputs(SAMPLE); _baseRate = SAMPLE.rate; _baseLease = SAMPLE.lease; _setDataMode('sample'); compute(); }); }

  function loanPayment(principal, monthlyRate, months) {
    if (monthlyRate === 0) return principal / months;
    return principal * monthlyRate * Math.pow(1+monthlyRate, months) / (Math.pow(1+monthlyRate, months) - 1);
  }

  function npv(cashflows, rate) {
    const monthly = rate / 12;
    return cashflows.reduce((sum, cf, i) => sum + cf / Math.pow(1 + monthly, i + 1), 0);
  }

  function compute() {
    const inp = getInputs();
    const { cost, life, salvage, startcash, discount, rate, term, down, lease, leaseTerm } = inp;

    // Depreciation
    const annualDepr = (cost - salvage) / life;
    const deprRows = [];
    let bv = cost;
    for (let y = 1; y <= life; y++) {
      deprRows.push({ year: y, open: bv, depr: annualDepr, close: bv - annualDepr });
      bv -= annualDepr;
    }

    // Loan calcs
    const loanAmt = cost - down;
    const monthlyRate = rate / 12;
    const monthlyPayment = loanPayment(loanAmt, monthlyRate, term);
    const totalLoanCost = down + monthlyPayment * term;

    // Compare periods (use max of all terms)
    const periods = Math.max(term, leaseTerm, life * 12);
    const months = Math.min(periods, 72); // cap at 72 months for display

    // Cash balances
    const cashCashFlow = Array.from({length: months}, (_, i) => i === 0 ? startcash - cost : startcash - cost);
    const loanCashFlow = [];
    const leaseCashFlow = [];

    let cashBal = startcash - cost;
    let loanBal = startcash - down;
    let leaseBal = startcash;

    const cashBalArr = [], loanBalArr = [], leaseBalArr = [];
    const loanPayArr = [], leasePayArr = [];

    for (let i = 0; i < months; i++) {
      cashBalArr.push(cashBal);
      const lp = i < term ? monthlyPayment : 0;
      const lsp = i < leaseTerm ? lease : 0;
      loanBal -= lp;
      leaseBal -= lsp;
      loanBalArr.push(loanBal);
      leaseBalArr.push(leaseBal);
      loanPayArr.push(lp);
      leasePayArr.push(lsp);
    }

    // NPV of costs (negative cash out)
    const cashFlows_cash = Array.from({length: months}, (_,i) => i===0 ? cost : 0);
    cashFlows_cash[months-1] -= salvage; // salvage recovery at end
    const cashFlows_loan = [down, ...Array.from({length: months-1}, (_,i) => i < term-1 ? monthlyPayment : 0)];
    const cashFlows_lease = Array.from({length: months}, (_,i) => i < leaseTerm ? lease : 0);

    const npvCash = npv(cashFlows_cash, discount);
    const npvLoan = npv(cashFlows_loan, discount);
    const npvLease = npv(cashFlows_lease, discount);

    // Runway impact
    const runwayCash = startcash >= cost ? (startcash - cost) : -1;
    const runwayLoan = startcash - down;

    // Recommendation
    const minNPV = Math.min(npvCash, npvLoan, npvLease);
    let rec = '', recKey = '';
    if (startcash < cost) { rec = 'Option B: Loan'; recKey = 'loan'; }
    else if (minNPV === npvCash && startcash >= cost * 1.3) { rec = 'Option A: Pay Cash'; recKey = 'cash'; }
    else if (minNPV === npvLoan) { rec = 'Option B: Loan'; recKey = 'loan'; }
    else { rec = 'Option C: Lease'; recKey = 'lease'; }

    // Highlight best option tab
    ['cash','loan','lease'].forEach(opt => {
      const tab = document.getElementById('tab-' + opt);
      tab.className = 'option-tab' + (opt === recKey ? ' best' : '');
    });
    document.getElementById('tab-cash-sub').textContent = 'NPV cost: ' + fmtK(npvCash);
    document.getElementById('tab-loan-sub').textContent = 'NPV cost: ' + fmtK(npvLoan);
    document.getElementById('tab-lease-sub').textContent = 'NPV cost: ' + fmtK(npvLease);

    // KPIs
    document.getElementById('kpi-rec').textContent = rec;
    document.getElementById('kpi-npv-cash').textContent = fmtK(npvCash);
    document.getElementById('kpi-npv-loan').textContent = fmtK(npvLoan);
    document.getElementById('kpi-npv-lease').textContent = fmtK(npvLease);
    document.getElementById('kpi-loanpmt').textContent = fmtK(monthlyPayment);
    document.getElementById('kpi-depr').textContent = fmtK(annualDepr);

    // Decision
    const bullets = [
      `${rec} has lowest NPV cost at ${fmtK(minNPV)}`,
      startcash < cost ? `Cash purchase not viable ‚Äî only ${fmtK(startcash)} available vs ${fmtK(cost)} needed` : `Cash purchase leaves ${fmtK(startcash - cost)} in reserve`,
      `Loan: ${fmtK(down)} down + ${fmtK(monthlyPayment)}/mo √ó ${term}mo = ${fmtK(totalLoanCost)} total cost`,
      `Lease: ${fmtK(lease)}/mo √ó ${leaseTerm}mo = ${fmtK(lease*leaseTerm)} total ‚Äî no ownership`,
    ];
    const driver = `NPV spread: Cash ${fmtK(npvCash)} vs Loan ${fmtK(npvLoan)} vs Lease ${fmtK(npvLease)} ‚Äî difference of ${fmtK(Math.max(npvCash,npvLoan,npvLease)-minNPV)} over analysis period.`;

    // State: positive if cash is ample + good NPV, negative if cash is tight, warning otherwise
    const capexState = startcash < cost ? 'negative' : (startcash < cost * 1.2 ? 'warning' : 'positive');
    setDecisionBox(capexState, 'Recommendation:', `${rec} ‚Äî lowest NPV cost at ${fmtK(minNPV)}`, bullets, driver);

    document.getElementById('what-means').innerHTML = `<p>You are evaluating a <strong>${fmtK(cost)}</strong> asset with a <strong>${life}-year</strong> useful life and <strong>${fmtK(salvage)}</strong> salvage value. Straight-line depreciation is <strong>${fmtK(annualDepr)}/year</strong>. The <strong>${rec}</strong> minimizes the present value cost of acquiring this asset. ${startcash < cost ? 'Note: starting cash is insufficient for outright purchase.' : `Starting cash of ${fmtK(startcash)} is sufficient for any option.`}</p>`;

    document.getElementById('risks-list').innerHTML = [
      `Cash option ties up ${fmtK(cost)} immediately ‚Äî reduces flexibility`,
      `Loan exposes you to interest rate risk if variable ‚Äî total interest: ${fmtK(monthlyPayment*term - loanAmt)}`,
      `Lease has no residual value ‚Äî you own nothing after ${leaseTerm} months`,
    ].map(r=>`<li>${r}</li>`).join('');
    document.getElementById('levers-list').innerHTML = [
      `Negotiate down payment lower on loan to preserve cash`,
      `Compare lease vs buy at different useful life assumptions`,
      `Factor in tax depreciation benefits (asset ownership) vs lease deduction`,
    ].map(r=>`<li>${r}</li>`).join('');

    // Cash Balance Chart
    const labels = Array.from({length: months}, (_,i) => 'M'+(i+1));
    const cashCtx = document.getElementById('chart-cash').getContext('2d');
    if (chartCash) chartCash.destroy();
    chartCash = new Chart(cashCtx, {
      type: 'line',
      data: {
        labels,
        datasets: [
          { label: 'Pay Cash', data: cashBalArr, borderColor: 'rgba(27,77,122,0.9)', backgroundColor: 'rgba(27,77,122,0.05)', fill: true, tension: 0.2, pointRadius: 0 },
          { label: 'Loan', data: loanBalArr, borderColor: 'rgba(15,118,110,0.9)', backgroundColor: 'rgba(15,118,110,0.05)', fill: true, tension: 0.2, pointRadius: 0 },
          { label: 'Lease', data: leaseBalArr, borderColor: 'rgba(251,146,60,0.9)', backgroundColor: 'rgba(251,146,60,0.05)', fill: true, tension: 0.2, pointRadius: 0 },
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: 'top' }, tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + fmtK(ctx.parsed.y) } } },
        scales: { y: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { callback: v => fmtK(v) } }, x: { grid: { display: false }, ticks: { maxTicksLimit: 12 } } }
      }
    });

    // Payment comparison bar
    const payCtx = document.getElementById('chart-payments').getContext('2d');
    if (chartPay) chartPay.destroy();
    chartPay = new Chart(payCtx, {
      type: 'bar',
      data: {
        labels: ['Pay Cash (Upfront)', 'Loan (Monthly)', 'Lease (Monthly)'],
        datasets: [{
          label: '$',
          data: [0, monthlyPayment, lease],
          backgroundColor: ['rgba(27,77,122,0.7)', 'rgba(15,118,110,0.7)', 'rgba(251,146,60,0.7)'],
          borderRadius: 8,
        }]
      },
      options: {
        responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => fmtK(ctx.parsed.y) + '/mo' } } },
        scales: { y: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { callback: v => fmtK(v) } }, x: { grid: { display: false } } }
      }
    });

    // Depreciation table
    document.getElementById('depr-tbody').innerHTML = deprRows.map(r =>
      `<tr><td>Year ${r.year}</td><td>${fmt(r.open)}</td><td>${fmt(r.depr)}</td><td>${fmt(r.close)}</td></tr>`
    ).join('');

    // ‚îÄ‚îÄ Cash Balance Impact Explainer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.getElementById('cashimpact-explainer').style.display = '';
    const cashReserve = startcash < cost ? 0 : startcash - cost;
    const capexColor = startcash < cost ? '#dc2626' : (startcash < cost * 1.2 ? '#d97706' : '#0f766e');
    const capexBg = startcash < cost ? 'rgba(220,38,38,0.10)' : (startcash < cost * 1.2 ? 'rgba(217,119,6,0.10)' : 'rgba(15,118,110,0.10)');
    document.getElementById('cashimpact-rec-value').textContent = rec;
    const cashimpactBadge = document.getElementById('cashimpact-live-badge');
    cashimpactBadge.textContent = startcash < cost ? '‚ö† Cash Insufficient' : (startcash < cost * 1.2 ? '‚ö° Tight' : '‚úì Cash Ample');
    cashimpactBadge.style.cssText = `background:${capexBg}; color:${capexColor}; font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;`;
    document.getElementById('cashimpact-headroom-label').innerHTML = startcash < cost
      ? `${fmtK(cost - startcash)} short for cash purchase`
      : `${fmtK(cashReserve)} left after cash purchase`;
    const cashimpactVerdictEl = document.getElementById('cashimpact-verdict-block');
    if (startcash < cost) {
      cashimpactVerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fef2f2; border-left:3px solid #dc2626; font-size:13px; line-height:1.6;';
      cashimpactVerdictEl.innerHTML = `<strong style="color:#dc2626;">‚ö† Cash purchase is not viable.</strong> Starting cash (${fmtK(startcash)}) is insufficient for the full purchase price (${fmtK(cost)}). The chart shows the Loan and Lease lines start from a healthy position while the Cash line would go negative. <strong>${rec}</strong> is the recommended path ‚Äî it requires only ${fmtK(down)} upfront and ${fmtK(monthlyPayment)}/mo.`;
    } else if (startcash < cost * 1.2) {
      cashimpactVerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fffbeb; border-left:3px solid #d97706; font-size:13px; line-height:1.6;';
      cashimpactVerdictEl.innerHTML = `<strong style="color:#d97706;">‚ö° Cash purchase is tight.</strong> You can afford the asset outright (${fmtK(cost)}), but it leaves only ${fmtK(cashReserve)} in reserve ‚Äî a thin buffer for unexpected costs. The chart shows how each option affects your balance over ${months} months. <strong>${rec}</strong> minimizes NPV cost while preserving operating flexibility.`;
    } else {
      cashimpactVerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#f0fdf9; border-left:3px solid #0f766e; font-size:13px; line-height:1.6;';
      cashimpactVerdictEl.innerHTML = `<strong style="color:#0f766e;">‚úì Strong cash position ‚Äî multiple options viable.</strong> Starting cash of ${fmtK(startcash)} provides ${fmtK(cashReserve)} in reserve even after an outright purchase. The chart shows that each option keeps your balance positive throughout the comparison period. <strong>${rec}</strong> is recommended based on lowest NPV cost (${fmtK(minNPV)}).`;
    }

    // ‚îÄ‚îÄ Monthly Outflow Explainer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    document.getElementById('outflow-explainer').style.display = '';
    const diff = Math.abs(monthlyPayment - lease);
    const cheaperMonthly = monthlyPayment <= lease ? 'Loan' : 'Lease';
    const diffColor = monthlyPayment <= lease ? '#0f766e' : '#d97706';
    document.getElementById('outflow-diff-value').textContent = fmtK(diff) + '/mo';
    const outflowBadge = document.getElementById('outflow-live-badge');
    outflowBadge.textContent = monthlyPayment <= lease ? '‚úì Loan cheaper/mo' : '‚ö° Lease cheaper/mo';
    outflowBadge.style.cssText = `background:rgba(15,118,110,0.10); color:${diffColor}; font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;`;
    document.getElementById('outflow-cheapest-label').innerHTML = `${cheaperMonthly}: ${fmtK(cheaperMonthly === 'Loan' ? monthlyPayment : lease)}/mo`;
    const outflowVerdictEl = document.getElementById('outflow-verdict-block');
    if (monthlyPayment < lease) {
      outflowVerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#f0fdf9; border-left:3px solid #0f766e; font-size:13px; line-height:1.6;';
      outflowVerdictEl.innerHTML = `<strong style="color:#0f766e;">‚úì Loan is cheaper month-over-month.</strong> The loan payment of ${fmtK(monthlyPayment)}/mo is ${fmtK(diff)}/mo less than the lease (${fmtK(lease)}/mo) ‚Äî and at the end of the loan term you own the asset outright. Over ${term} months that's ${fmtK(diff * term)} saved in payments vs. leasing, plus you retain the ${fmtK(salvage)} salvage value.`;
    } else {
      outflowVerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fffbeb; border-left:3px solid #d97706; font-size:13px; line-height:1.6;';
      outflowVerdictEl.innerHTML = `<strong style="color:#d97706;">‚ö° Lease is cheaper month-over-month but costs more over time.</strong> At ${fmtK(lease)}/mo, the lease costs ${fmtK(diff)}/mo less than the loan (${fmtK(monthlyPayment)}/mo) ‚Äî easing near-term cash pressure. However, lease total (${fmtK(lease * leaseTerm)}) over ${leaseTerm} months exceeds the loan total (${fmtK(totalLoanCost)}) with no asset ownership at the end.`;
    }
  }

  // ‚îÄ‚îÄ Scenario management for capex ‚îÄ‚îÄ
  let capexScenario = 'base';
  const CAPEX_SCENARIO_MULTS = { base: { rate: 1, lease: 1 }, upside: { rate: 0.85, lease: 0.85 }, downside: { rate: 1.15, lease: 1.15 } };
  const CAPEX_SCENARIO_NAMES = { base: 'Base Case', upside: 'Upside', downside: 'Downside' };
  // Store base values separately so scenario mults always apply to originals
  let _baseRate = SAMPLE.rate, _baseLease = SAMPLE.lease;

  function setCapexScenario(s) {
    capexScenario = s;
    document.querySelectorAll('.sb-acc-tab[data-scenario]').forEach(t => t.classList.toggle('active', t.dataset.scenario === s));
    var lbl = document.getElementById('sbScenarioLabel');
    if (lbl) lbl.textContent = CAPEX_SCENARIO_NAMES[s] || s;
    // Apply scenario multipliers to rate and lease inputs
    var mults = CAPEX_SCENARIO_MULTS[s];
    var rateEl = document.getElementById('inp-rate');
    var leaseEl = document.getElementById('inp-lease');
    if (rateEl) rateEl.value = (_baseRate * mults.rate).toFixed(2);
    if (leaseEl) leaseEl.value = Math.round(_baseLease * mults.lease);
    withStableScroll(compute);
  }

  // Override loadSample to also reset base values
  var _origLoadSample = loadSample;

  // Enable global tooltip bubble (prevents tooltip clipping in sidebar)
  initTooltips();
  loadSample();

  function setDecisionBox(state, verdict, verdictAction, bullets, next) {
    // state: 'positive' | 'warning' | 'negative'
    const box = document.getElementById('decisionBox');
    box.classList.remove('decision-box--positive','decision-box--warning','decision-box--negative');
    box.classList.add('decision-box--' + state);
    document.getElementById('decisionFallback').style.display = 'none';
    document.getElementById('decisionContent').style.display = '';
    document.getElementById('decisionVerdict').innerHTML = verdict + ' <span class="verdict-action">' + verdictAction + '</span>';
    document.getElementById('decisionBullets').innerHTML = bullets.map(b => '<li>' + b + '</li>').join('');
    document.getElementById('decisionNext').innerHTML = 'Top driver: <span>' + next + '</span>';
  }


    /* ‚îÄ‚îÄ Sidebar accordion: one section open at a time ‚îÄ‚îÄ */
    function sidebarAccordion(headerEl) {
      var sidebar = headerEl.closest('.sidebar');
      var allHeaders = sidebar.querySelectorAll('.sb-acc-header');
      allHeaders.forEach(function(h) {
        if (h === headerEl) return;
        h.classList.remove('open');
        var b = h.nextElementSibling;
        if (b && b.classList.contains('sb-acc-body')) b.classList.remove('open');
      });
      headerEl.classList.toggle('open');
      var body = headerEl.nextElementSibling;
      if (body && body.classList.contains('sb-acc-body')) body.classList.toggle('open');
    }


    /* ‚îÄ‚îÄ Body-level tooltip engine (fixes sidebar overflow clipping) ‚îÄ‚îÄ */
    function initTooltips() {
      var ttEl = document.getElementById('tt-root');
      if (!ttEl) {
        ttEl = document.createElement('div');
        ttEl.id = 'tt-root';
        document.body.appendChild(ttEl);
      }

      var hideTimer = null;

      function show(text, targetEl) {
        clearTimeout(hideTimer);
        ttEl.textContent = text;
        ttEl.classList.add('tt-visible');
        position(targetEl);
      }

      function hide() {
        hideTimer = setTimeout(function() {
          ttEl.classList.remove('tt-visible');
        }, 80);
      }

      function position(el) {
        var rect = el.getBoundingClientRect();
        var ttW = 260;
        var gap = 8;
        var left = rect.left + rect.width / 2 - ttW / 2;
        left = Math.max(12, Math.min(left, window.innerWidth - ttW - 12));
        var ttH = ttEl.offsetHeight || 60;
        var top, transform;
        if (rect.top - ttH - gap < 8) {
          // Flip below if not enough room above
          top = rect.bottom + gap;
          transform = 'translateY(0)';
        } else {
          top = rect.top - gap;
          transform = 'translateY(-100%)';
        }
        ttEl.style.left = left + 'px';
        ttEl.style.top = top + 'px';
        ttEl.style.transform = transform;
      }

      // Event delegation ‚Äî works on dynamically injected elements too
      document.addEventListener('mouseover', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) return;
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (text) show(text, el);
      });

      document.addEventListener('mouseout', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (el) hide();
      });

      // Hide on scroll so tooltip doesn't chase the page
      window.addEventListener('scroll', function() {
        ttEl.classList.remove('tt-visible');
      }, { passive: true });
    }


    /* Mobile sidebar toggle */
    (function() {
      var btn = document.getElementById('mobileControlsBtn');
      var sb  = document.querySelector('.sidebar');
      if (!btn || !sb) return;
      btn.addEventListener('click', function() {
        var open = sb.classList.toggle('mobile-open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();


    /* ‚îÄ‚îÄ Body-level tooltip engine (fixes sidebar overflow clipping) ‚îÄ‚îÄ */
    function initTooltips() {
      var ttEl = document.getElementById('tt-root');
      if (!ttEl) {
        ttEl = document.createElement('div');
        ttEl.id = 'tt-root';
        document.body.appendChild(ttEl);
      }

      var hideTimer = null;
      var activeEl = null;

      function show(text, targetEl) {
        clearTimeout(hideTimer);
        activeEl = targetEl;
        ttEl.textContent = text;
        ttEl.classList.add('tt-visible');
        position(targetEl);
      }

      function hide() {
        hideTimer = setTimeout(function() {
          ttEl.classList.remove('tt-visible');
          activeEl = null;
        }, 80);
      }

      function position(el) {
        var rect = el.getBoundingClientRect();
        var ttW = 270;
        var gap = 8;
        var left = rect.left + rect.width / 2 - ttW / 2;
        left = Math.max(12, Math.min(left, window.innerWidth - ttW - 12));
        ttEl.style.width = ttW + 'px';
        ttEl.style.left = left + 'px';
        // Measure height after setting content
        var ttH = ttEl.offsetHeight || 60;
        var top, transform;
        if (rect.top - ttH - gap - 8 < 0) {
          top = rect.bottom + window.scrollY + gap;
          transform = 'none';
        } else {
          top = rect.top + window.scrollY - ttH - gap;
          transform = 'none';
        }
        ttEl.style.top = top + 'px';
        ttEl.style.transform = transform;
        ttEl.style.position = 'absolute';
      }

      /* Kill CSS ::after tooltips ‚Äî they clip in overflow containers */
      var killStyle = document.createElement('style');
      killStyle.textContent = '.help-icon::after,.help-icon:hover::after,[data-help]::after,[data-tt]::after,.term-helper::after,.term-helper:hover::after{content:none!important;display:none!important;}';
      document.head.appendChild(killStyle);

      /* Desktop: mouse events (event delegation) */
      document.addEventListener('mouseover', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) return;
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (text && text !== 'Loading...') show(text, el);
      });

      document.addEventListener('mouseout', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (el) hide();
      });

      /* Mobile: tap to toggle */
      document.addEventListener('click', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) {
          // tap anywhere else hides tooltip
          if (ttEl.classList.contains('tt-visible')) {
            ttEl.classList.remove('tt-visible');
            activeEl = null;
          }
          return;
        }
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (!text || text === 'Loading...') return;
        if (activeEl === el && ttEl.classList.contains('tt-visible')) {
          ttEl.classList.remove('tt-visible');
          activeEl = null;
        } else {
          show(text, el);
        }
        e.stopPropagation();
      });

      /* Reposition on scroll (don't hide, just reposition) */
      window.addEventListener('scroll', function() {
        if (activeEl && ttEl.classList.contains('tt-visible')) {
          position(activeEl);
        }
      }, { passive: true });

      /* Hide on resize */
      window.addEventListener('resize', function() {
        ttEl.classList.remove('tt-visible');
        activeEl = null;
      }, { passive: true });
    }


</script>
<script>
/* Global Time Ticker */
(function(){
  var R=[{l:'APAC',t:'Asia/Singapore'},{l:'EMEA',t:'Europe/London'},{l:'USA',t:'America/New_York'},{l:'LATAM',t:'America/Sao_Paulo'}];
  var WS=6,WN=17,WE=18;
  function fmt(tz){return new Intl.DateTimeFormat('en-US',{timeZone:tz,hour:'numeric',minute:'2-digit',hour12:true}).format(new Date())}
  function hm(tz){var p=new Intl.DateTimeFormat('en-US',{timeZone:tz,hour:'numeric',minute:'2-digit',hour12:false}).formatToParts(new Date()),h=0,m=0;p.forEach(function(x){if(x.type==='hour')h=+x.value;if(x.type==='minute')m=+x.value});return{h:h||0,m:m||0}}
  function st(tz){var h=hm(tz).h;return h>=WS&&h<WN?'active':h===WN?'ending':'offline'}
  function wake(tz){var x=hm(tz),d=WS*60-(x.h*60+x.m);return d<=0?d+1440:d}
  function slp(tz){var x=hm(tz);return Math.max(0,WE*60-(x.h*60+x.m))}
  function dur(m){var h=Math.floor(m/60),n=m%60;return h===0?n+'m':n===0?h+'h':h+'h '+n+'m'}
  function bestWin(ltz){
    var now=new Date(),s=new Date(now);s.setUTCMinutes(0,0,0);s.setUTCHours(s.getUTCHours()+1);
    var bu=null,bc=0;
    for(var i=0;i<48;i++){
      var pr=new Date(s.getTime()+i*3600000),iw=0;
      R.forEach(function(r){var p=new Intl.DateTimeFormat('en-US',{timeZone:r.t,hour:'numeric',hour12:false}).formatToParts(pr),h=0;p.forEach(function(x){if(x.type==='hour')h=+x.value});if(h>=WS&&h<WE)iw++});
      if(iw>bc){bc=iw;bu=pr}
      if(bc===R.length)break;
    }
    if(!bu||bc<2)return null;
    var e=new Date(bu.getTime()+7200000),o={timeZone:ltz,hour:'numeric',minute:'2-digit',hour12:true};
    var t1=new Intl.DateTimeFormat('en-US',o).format(bu),t2=new Intl.DateTimeFormat('en-US',o).format(e);
    var fd={timeZone:ltz,year:'numeric',month:'2-digit',day:'2-digit'};
    var tm=new Intl.DateTimeFormat('en-US',fd).format(now)!==new Intl.DateTimeFormat('en-US',fd).format(bu)?' (tom)':'';
    return{time:t1+'‚Äì'+t2+tm,count:bc}
  }
  function render(){
    var el=document.getElementById('tz-ticker-items');if(!el)return;
    var ltz=Intl.DateTimeFormat().resolvedOptions().timeZone,h='';
    h+='<span class="tz-ticker-item"><span class="tz-ticker-item-label">You</span><span class="tz-ticker-item-value" style="font-weight:700">'+fmt(ltz)+'</span></span>';
    R.forEach(function(r){
      var s=st(r.t),dc=s==='active'?'tk-active':s==='ending'?'tk-ending':'tk-offline',vt;
      if(s==='active'){var ml=slp(r.t);vt=ml<180?'Active ¬∑ ends '+dur(ml):'Active'}
      else if(s==='ending')vt='Ending ¬∑ '+dur(slp(r.t));
      else vt='Online '+dur(wake(r.t));
      h+='<span class="tz-ticker-item"><span class="tz-ticker-dot '+dc+'"></span><span class="tz-ticker-item-label">'+r.l+'</span><span class="tz-ticker-item-value '+dc+'">'+vt+'</span></span>';
    });
    var w=bestWin(ltz),wt=w?w.time.split('(')[0].trim()+(w.count>=3?' ¬∑ '+w.count+' regions':''): '‚Äî';
    h+='<span class="tz-ticker-item"><span class="tz-ticker-item-label">Best window</span><span class="tz-ticker-item-value tk-window">'+wt+'</span></span>';
    el.innerHTML=h;
  }
  function init(){
    var hdr=document.querySelector('.site-header')||document.querySelector('header');
    document.documentElement.style.setProperty('--nav-h',(hdr?hdr.offsetHeight:56)+'px');
    window.addEventListener('resize',function(){var h2=document.querySelector('.site-header')||document.querySelector('header');document.documentElement.style.setProperty('--nav-h',(h2?h2.offsetHeight:56)+'px')});
    render();setInterval(render,30000);
  }
  document.readyState==='loading'?document.addEventListener('DOMContentLoaded',init):init();
})();
</script>
</body>
</html>
