<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Working Capital FP&A ¬∑ FP&A Portfolio</title>
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/png" href="favicon.png">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* module-hero, module-label, module-title, module-subtitle, feature-chips, chip ‚Äî all in style.css */
    .module-hero-inner { display: flex; flex-direction: column; gap: 20px; }
    .module-hero-text { flex: 1; min-width: 0; }
    .btn-small:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .btn-small:active { transform: translateY(1px); }
    .btn-primary { background: var(--text); color: white; border-color: var(--text); }
    .input-row { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
    .input-row label { font-size: 12px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 6px; }
    .input-row input { padding: 9px 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 13px; font-family: var(--font-sans); background: white; width: 100%; }
    .input-row input:focus { outline: none; border-color: var(--accent); }
    .main-content { min-width: 0; }
    
    
    
    
    
    
    
    
    .decision-driver strong { color: rgba(255,255,255,0.9); }
    
    .module-section { padding: 0 0 40px 0; }
    .module-section-title { font-size: 22px; margin-bottom: 18px; letter-spacing: -0.02em; font-weight: 700; }
    .module-card { background: white; border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow-soft); }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 20px; }
    .kpi-box { padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: rgba(246,248,251,0.6); }
    .kpi-box-label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .kpi-box-value { font-size: 22px; font-weight: 700; }
    .kpi-box-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }
    .board-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-top: 16px; }
    .board-block { padding: 14px; border: 1px solid var(--border); border-radius: var(--radius-sm); background: rgba(246,248,251,0.5); }
    .board-block-title { font-size: 12px; color: var(--muted); font-weight: 600; margin-bottom: 8px; letter-spacing: 0.04em; }
    .board-block ul { margin: 0; padding: 0 0 0 16px; display: grid; gap: 6px; }
    .board-block ul li { font-size: 13px; color: var(--text); }
    .what-means { margin-bottom: 16px; padding: 14px; border-left: 3px solid var(--accent); background: rgba(15,118,110,0.04); border-radius: 6px; }
    .what-means p { font-size: 14px; color: var(--text); line-height: 1.6; }
    .chart-wrap { position: relative; width: 100%; overflow-anchor: none; }
    .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .data-table th { text-align: left; padding: 10px 12px; border-bottom: 2px solid var(--border); font-weight: 650; font-size: 12px; }
    .data-table td { padding: 9px 12px; border-bottom: 1px solid var(--border); }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover { background: rgba(246,248,251,0.5); }
    .section-header-with-help { display: flex; align-items: center; gap: 10px; margin-bottom: 18px; }
    .data-badge { font-size: 12px; padding: 6px 12px; border-radius: 999px; background: rgba(15,118,110,0.10); border: 1px solid rgba(15,118,110,0.20); color: var(--accent); font-weight: 600; display: inline-block; margin-bottom: 10px; }
    .data-badge.random { background: #fef3c7; border: 1px solid #fbbf24; color: #92400e; }
    @media (max-width: 860px) { .module-layout { grid-template-columns: 1fr; }
 .board-grid { grid-template-columns: 1fr; } }
  
    /* ---- Decision Box (matches commercial-sales.html) ---- */
    .decision-box {
      background: white;
      border: 1.5px solid var(--accent);
      border-radius: var(--radius);
      padding: 20px 24px;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.08), var(--shadow-soft);
      margin-bottom: 24px;
      transition: border-color 200ms ease, box-shadow 200ms ease, background 200ms ease;
    }
    .decision-box--positive {
      border-color: #0f766e;
      background: #f0fdf9;
      box-shadow: 0 0 0 4px rgba(15,118,110,0.10), var(--shadow-soft);
    }
    .decision-box--positive .decision-box-eyebrow { color: #0f766e; }
    .decision-box--positive .verdict-action        { color: #0f766e; }
    .decision-box--positive .decision-box-bullets li::before { color: #0f766e; }
    .decision-box--warning {
      border-color: #d97706;
      background: #fffbeb;
      box-shadow: 0 0 0 4px rgba(217,119,6,0.10), var(--shadow-soft);
    }
    .decision-box--warning .decision-box-eyebrow { color: #d97706; }
    .decision-box--warning .verdict-action        { color: #d97706; }
    .decision-box--warning .decision-box-bullets li::before { color: #d97706; }
    .decision-box--negative {
      border-color: #dc2626;
      background: #fef2f2;
      box-shadow: 0 0 0 4px rgba(220,38,38,0.10), var(--shadow-soft);
    }
    .decision-box--negative .decision-box-eyebrow { color: #dc2626; }
    .decision-box--negative .verdict-action        { color: #dc2626; }
    .decision-box--negative .decision-box-bullets li::before { color: #dc2626; }
    .decision-box-eyebrow {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--accent);
      margin-bottom: 8px;
    }
    .decision-box-verdict {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text);
      margin-bottom: 12px;
    }
    .decision-box-verdict .verdict-action { color: var(--accent); }
    .decision-box-bullets {
      list-style: none;
      margin: 0 0 10px 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .decision-box-bullets li {
      font-size: 13px;
      color: var(--muted);
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.4;
    }
    .decision-box-bullets li::before {
      content: '‚Ä∫';
      color: var(--accent);
      font-weight: 700;
      flex-shrink: 0;
    }
    .decision-box-next {
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      border-top: 1px solid var(--border);
      padding-top: 10px;
    }
    .decision-box-next span { color: var(--accent-2); }
    .decision-box-fallback {
      font-size: 14px;
      color: var(--muted);
      font-style: italic;
    }

      .main-content { overflow-anchor: none; }
    .module-card { overflow-anchor: none; }
    .data-table { overflow-anchor: none; }

    /* KPI box tooltip */
    .kpi-box { position: relative; cursor: default; }
    .kpi-box-label { display: flex; align-items: center; gap: 5px; }
    .kpi-tip-icon {
      display: inline-flex; align-items: center; justify-content: center;
      width: 15px; height: 15px; border-radius: 50%;
      background: rgba(15,118,110,0.10); border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent); font-size: 9px; font-weight: 700;
      cursor: help; flex-shrink: 0; line-height: 1;
      transition: background 140ms;
    }
    .kpi-tip-icon:hover { background: rgba(15,118,110,0.20); }
    .kpi-tooltip {
      display: none;
      position: absolute;
      bottom: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%);
      background: var(--text, #0b1220);
      color: white;
      font-size: 12px;
      line-height: 1.55;
      border-radius: 10px;
      padding: 10px 14px;
      width: 240px;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0,0,0,0.18);
      white-space: normal;
      font-weight: 400;
      pointer-events: none;
    }
    .kpi-tooltip::after {
      content: '';
      position: absolute;
      top: 100%; left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--text, #0b1220);
    }
    .kpi-tip-icon:hover + .kpi-tooltip,
    .kpi-tip-icon:focus + .kpi-tooltip { display: block; }
  
    /* ‚îÄ‚îÄ Data-needed strip ‚îÄ‚îÄ */
    .data-needed-section {
      padding: 0 0 0 0;
      border-bottom: 1px solid var(--border, #e5e8ef);
    }
    .data-needed-wrap {
      max-width: var(--max-w, 1200px);
      margin: 0 auto;
      padding: 20px 32px 24px;
    }
    .data-needed-label {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: var(--muted, #6b7280);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .data-needed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(185px, 1fr));
      gap: 8px;
    }
    .data-needed-item {
      padding: 10px 12px;
      border: 1px solid var(--border, #e5e8ef);
      border-radius: 9px;
      display: flex;
      align-items: flex-start;
      gap: 9px;
      background: #fafbfc;
    }
    .data-needed-icon {
      width: 26px;
      height: 26px;
      font-size: 13px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 1px;
    }
    .data-needed-name {
      font-size: 11px;
      font-weight: 700;
      color: var(--text, #0b1220);
      margin-bottom: 3px;
      line-height: 1.35;
    }
    .data-needed-desc {
      font-size: 10px;
      color: var(--muted, #6b7280);
      line-height: 1.5;
    }


    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIDEBAR ‚Äî Accordion (shared across all modules)
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .sidebar {
      position: sticky;
      top: 80px;
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      max-height: calc(100vh - 100px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(12,23,45,0.15) transparent;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(12,23,45,0.15); border-radius: 4px; }
    .sidebar::-webkit-scrollbar-thumb:hover { background: rgba(12,23,45,0.28); }

    /* Static top section (data mode badge + always-visible controls) */
    .sb-static {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .sb-static-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    /* Accordion group */
    .sb-acc-group {
      border-bottom: 1px solid var(--border);
    }
    .sb-acc-group:last-child { border-bottom: none; }

    .sb-acc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      transition: color 120ms ease;
    }
    .sb-acc-header:hover { color: var(--text); }
    .sb-acc-header.open  { color: var(--text); }
    .sb-acc-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 200ms ease;
      flex-shrink: 0;
    }
    .sb-acc-header.open .sb-acc-chevron {
      transform: rotate(180deg);
      color: var(--text);
    }
    .sb-acc-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft, rgba(15,118,110,0.10));
      color: var(--accent, #0f766e);
      flex-shrink: 0;
      margin-left: auto;
    }

    .sb-acc-body {
      display: none;
      padding-bottom: 14px;
    }
    .sb-acc-body.open { display: block; }

    /* Buttons inside accordion */
    .sb-acc-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: all 140ms ease;
      text-align: left;
      white-space: nowrap;
      font-family: inherit;
    }
    .sb-acc-btn:first-child { margin-top: 0; }
    .sb-acc-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: 0 4px 12px rgba(11,18,32,0.06);
    }
    .sb-acc-btn:active { transform: translateY(1px); }
    .sb-acc-btn.primary { background: var(--text, #0b1220); color: white; border-color: var(--text, #0b1220); }
    .sb-acc-btn.primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-acc-btn.accent  { background: var(--accent, #0f766e); color: white; border-color: var(--accent, #0f766e); }

    /* Scenario tabs inside accordion */
    .sb-acc-tabs { display: flex; flex-direction: column; gap: 6px; }
    .sb-acc-tab {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }
    .sb-acc-tab:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-tab.active { background: var(--text, #0b1220); color: white; border-color: var(--text, #0b1220); }

    /* Input rows inside accordion */
    .sb-acc-input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .sb-acc-input-row:last-child { margin-bottom: 0; }
    .sb-acc-input-row label {
      font-size: 11px;
      color: var(--muted, #5d6b7a);
      flex: 1;
      line-height: 1.3;
    }
    .sb-acc-input-row input[type="number"] {
      width: 76px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: inherit;
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .sb-acc-input-row input[type="number"]::-webkit-outer-spin-button,
    .sb-acc-input-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sb-acc-input-row input[type="number"]:focus {
      outline: none;
      border-color: var(--accent, #0f766e);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .sb-acc-sub {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 8px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* Responsive: on mobile sidebar goes full width, no sticky, no scroll */
    @media (max-width: 860px) {
      .sidebar {
        position: static;
        max-height: none;
        overflow-y: visible;
      }
    }

  
    /* ‚îÄ‚îÄ Tooltip engine: body-level fixed div, never clipped by overflow ‚îÄ‚îÄ */
    /* Kill ALL CSS ::after tooltip rules ‚Äî they clip inside overflow containers */
    .help-icon::after,
    .help-icon:hover::after,
    .help-icon[data-help]::after,
    [data-tt]::after,
    [data-tt]:hover::after,
    .term-helper::after,
    .term-helper:hover::after {
      content: none !important;
      display: none !important;
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
    }

    /* #tt-root ‚Äî single fixed tooltip bubble appended to <body> by JS */
    #tt-root {
      position: fixed;
      z-index: 99999;
      pointer-events: none;
      padding: 9px 13px;
      background: rgba(11,18,32,0.95);
      color: #f0f4f8;
      font-size: 12px;
      font-weight: 400;
      line-height: 1.55;
      border-radius: 9px;
      white-space: normal;
      width: 260px;
      max-width: calc(100vw - 24px);
      box-shadow: 0 4px 18px rgba(0,0,0,0.28);
      text-align: left;
      opacity: 0;
      transition: opacity 120ms ease;
    }
    #tt-root.tt-visible { opacity: 1; }

    /* .help-icon visual ‚Äî keep the badge, remove position:relative (no longer needed) */
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-size: 11px;
      font-weight: 700;
      cursor: help;
      flex-shrink: 0;
      position: static;   /* was relative ‚Äî not needed with body-level tooltip */
    }
    .help-icon::before { content: '?'; line-height: 1; }

  
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SHARED SIDEBAR SHELL ‚Äî standardised across all modules
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Layout */
    .module-layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 24px;
      align-items: start;
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .main-content { min-width: 0; }

    /* Mobile Controls Toggle Button */
    .mobile-controls-btn {
      display: none;
      align-items: center;
      gap: 10px;
      width: 100%;
      padding: 12px 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      cursor: pointer;
      margin-bottom: 4px;
      box-shadow: var(--shadow-soft);
      transition: all 140ms ease;
    }
    .mobile-controls-btn:hover {
      border-color: rgba(12,23,45,0.18);
      box-shadow: var(--shadow);
    }
    .mobile-controls-btn .mcb-icon { font-size: 16px; flex-shrink: 0; }
    .mobile-controls-btn .mcb-label { flex: 1; text-align: left; }
    .mobile-controls-btn .mcb-chevron {
      font-size: 11px; color: var(--muted);
      transition: transform 200ms ease;
    }
    .mobile-controls-btn[aria-expanded="true"] .mcb-chevron { transform: rotate(180deg); }

    /* Sidebar shell */
    .sidebar {
      position: sticky;
      top: 84px;
      padding: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      max-height: calc(100vh - 104px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: rgba(12,23,45,0.15) transparent;
      width: 280px;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(12,23,45,0.15); border-radius: 4px; }
    .sidebar::-webkit-scrollbar-thumb:hover { background: rgba(12,23,45,0.28); }

    /* Static section (Data Mode etc ‚Äî always visible) */
    .sb-static {
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
    }
    .sb-static-title {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    /* ‚îÄ‚îÄ Data Mode segmented control (fixed height, no wrapping) ‚îÄ‚îÄ */
    .sb-data-mode-row {
      display: flex;
      gap: 0;
      height: 34px;              /* fixed height ‚Äî prevents layout shift */
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-muted);
      flex-wrap: nowrap;         /* never wrap */
    }
    .sb-data-mode-btn {
      flex: 1;
      min-width: 0;
      height: 100%;
      padding: 0 4px;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: inherit;
    }
    .sb-data-mode-btn:last-child { border-right: none; }
    .sb-data-mode-btn:hover { background: rgba(12,23,45,0.04); color: var(--text); }
    .sb-data-mode-btn.active {
      background: var(--text);
      color: white;
    }

    /* Mode pills (2-option) ‚Äî also fixed height */
    .sb-mode-pills {
      display: flex;
      gap: 0;
      height: 34px;
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-muted);
      flex-wrap: nowrap;
    }
    .sb-mode-pill {
      flex: 1;
      height: 100%;
      padding: 0 6px;
      border: none;
      border-right: 1px solid var(--border);
      background: transparent;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: background 120ms ease, color 120ms ease;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-family: inherit;
      text-align: center;
    }
    .sb-mode-pill:last-child { border-right: none; }
    .sb-mode-pill:hover { background: rgba(12,23,45,0.04); color: var(--text); }
    .sb-mode-pill.active { background: var(--text); color: white; }

    /* Badge */
    .data-badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15,118,110,0.10);
      border: 1px solid rgba(15,118,110,0.20);
      color: var(--accent);
      font-weight: 600;
      white-space: nowrap;
      flex-shrink: 0;
    }
    .data-badge.random {
      background: #fef3c7;
      border-color: #fbbf24;
      color: #92400e;
    }

    /* Accordion groups */
    .sb-acc-group {
      border-bottom: 1px solid var(--border);
    }
    .sb-acc-group:last-child { border-bottom: none; }

    .sb-acc-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 12px 0;
      cursor: pointer;
      user-select: none;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      background: none;
      border: none;
      width: 100%;
      text-align: left;
      transition: color 120ms ease;
      font-family: inherit;
    }
    .sb-acc-header:hover { color: var(--text); }
    .sb-acc-header.open  { color: var(--text); }
    .sb-acc-chevron {
      font-size: 10px;
      color: var(--muted);
      transition: transform 200ms ease;
      flex-shrink: 0;
    }
    .sb-acc-header.open .sb-acc-chevron { transform: rotate(180deg); color: var(--text); }
    .sb-acc-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      flex-shrink: 0;
      margin-left: auto;
    }

    .sb-acc-body {
      display: none;
      padding-bottom: 14px;
    }
    .sb-acc-body.open { display: block; }

    /* Buttons inside accordion */
    .sb-acc-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 6px;
      transition: all 140ms ease;
      text-align: left;
      white-space: nowrap;
      font-family: inherit;
    }
    .sb-acc-btn:first-child { margin-top: 0; }
    .sb-acc-btn:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-btn:active { transform: translateY(1px); }
    .sb-acc-btn.primary { background: var(--text); color: white; border-color: var(--text); }
    .sb-acc-btn.primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-acc-btn.accent  { background: var(--accent); color: white; border-color: var(--accent); }

    /* Tabs (scenario selectors etc.) */
    .sb-acc-tabs { display: flex; flex-direction: column; gap: 6px; }
    .sb-acc-tab {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 140ms ease;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }
    .sb-acc-tab:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-acc-tab.active { background: var(--text); color: white; border-color: var(--text); }

    /* Input rows */
    .sb-acc-input-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }
    .sb-acc-input-row:last-child { margin-bottom: 0; }
    .sb-acc-input-row label {
      font-size: 11px;
      color: var(--muted);
      flex: 1;
      line-height: 1.3;
    }
    .sb-acc-input-row input[type="number"] {
      width: 76px;
      padding: 5px 7px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      font-family: inherit;
      background: white;
      text-align: right;
      flex-shrink: 0;
      -moz-appearance: textfield;
    }
    .sb-acc-input-row input[type="number"]::-webkit-outer-spin-button,
    .sb-acc-input-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .sb-acc-input-row input[type="number"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(15,118,110,0.15);
    }
    .sb-acc-sub {
      font-size: 10px;
      font-weight: 700;
      color: var(--muted);
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin: 10px 0 8px;
      border-top: 1px solid var(--border);
      padding-top: 9px;
    }

    /* Action buttons (full-width) */
    .sb-action-btn {
      display: flex; align-items: center; gap: 8px;
      width: 100%; padding: 7px 12px;
      border-radius: 999px; border: 1px solid var(--border);
      background: white; font-size: 12px; font-weight: 600;
      cursor: pointer; margin-top: 6px;
      transition: all 140ms ease; text-align: left;
      white-space: nowrap; font-family: inherit;
    }
    .sb-action-btn:hover { border-color: rgba(12,23,45,0.18); box-shadow: 0 4px 12px rgba(11,18,32,0.06); }
    .sb-action-btn:active { transform: translateY(1px); }
    .sb-action-btn.sb-action-primary { background: var(--text); color: white; border-color: var(--text); }
    .sb-action-btn.sb-action-primary:hover { box-shadow: 0 6px 18px rgba(11,18,32,0.12); }
    .sb-action-btn.sb-action-accent  { background: var(--accent); color: white; border-color: var(--accent); }
    .sb-file-hidden { position: absolute; opacity: 0; width: 0; height: 0; }

    /* Sliders */
    .control-item { margin-bottom: 16px; }
    .control-item:last-child { margin-bottom: 0; }
    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text);
    }
    .control-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-2);
      font-family: var(--font-mono, monospace);
    }
    .control-input {
      -webkit-appearance: none; appearance: none;
      width: 100%; height: 6px;
      border-radius: 3px;
      background: var(--bg-muted);
      outline: none; cursor: pointer;
    }
    .control-input::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,118,110,0.3);
      transition: all 140ms ease;
    }
    .control-input::-webkit-slider-thumb:hover { transform: scale(1.1); }
    .control-input::-moz-range-thumb {
      width: 18px; height: 18px; border-radius: 50%;
      background: var(--accent); cursor: pointer;
      box-shadow: 0 2px 8px rgba(15,118,110,0.3); border: none;
    }

    /* ‚îÄ‚îÄ Mobile responsive ‚îÄ‚îÄ */
    @media (max-width: 860px) {
      .module-layout {
        grid-template-columns: 1fr;
        padding: 16px;
      }
      .mobile-controls-btn { display: flex; }
      .sidebar {
        position: static;
        top: 0;
        width: 100%;
        max-height: none;
        overflow-y: visible;
        display: none;            /* hidden by default; JS toggles */
        border-radius: var(--radius-sm);
        margin-bottom: 8px;
      }
      .sidebar.mobile-open { display: block; }
    }

    @media (max-width: 560px) {
      .module-layout { padding: 12px; }
    }


</style>
</head>
<body>
<a class="skip-link" href="#main">Skip to content</a>
<header class="site-header">
  <div class="container">
    <nav class="nav" aria-label="Main navigation">
      <a href="index.html" class="brand">
        <span class="brand-mark" aria-hidden="true"></span>
        FP&amp;A Portfolio
      </a>
      <div class="nav-cta">
        <a href="index.html#card-working-capital"" class="btn btn-ghost">&larr; Back to Portfolio</a>
      </div>
    </nav>
  </div>
</header>

<main id="main">
  <section class="module-hero">
    <div class="container">
      <div class="module-eyebrow">Cash &bull; Working Capital</div>
      <h1 class="module-title">Working Capital FP&amp;A</h1>
      <p class="module-subtitle">Model how collections, payables, and inventory timing change cash and runway.</p>
      <div class="feature-chips">
        <span class="chip">Cash Conversion</span>
        <span class="chip">Forecast</span>
        <span class="chip">AR/AP/Inventory</span>
        <span class="chip">Runway</span>
      </div>
    </div>
  </section>

  <!-- DATA NEEDED STRIP -->
  <div class="data-needed-section">
    <div class="data-needed-wrap">
      <div class="data-needed-label">üìÇ &nbsp;Data needed for this module</div>
      <div class="data-needed-grid">
        <div class="data-needed-item"><div class="data-needed-icon" style="background:#eff6ff;">üè¶</div><div><div class="data-needed-name">Bank Statement</div><div class="data-needed-desc">Cash inflows &amp; outflows ‚Üí net cash &amp; runway</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f0fdf9;">üìÑ</div><div><div class="data-needed-name">AR Register</div><div class="data-needed-desc">Customer payment aging ‚Üí drives DSO</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fef3c7;">üìã</div><div><div class="data-needed-name">AP Register</div><div class="data-needed-desc">Supplier payment ledger ‚Üí drives DPO</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#f5f3ff;">üì¶</div><div><div class="data-needed-name">Inventory Report</div><div class="data-needed-desc">Stock turnover ‚Üí days held (DIO)</div></div></div>
          <div class="data-needed-item"><div class="data-needed-icon" style="background:#fdf2f8;">üìä</div><div><div class="data-needed-name">P&L Statement</div><div class="data-needed-desc">Revenue, COGS &amp; OpEx ‚Üí all projections</div></div></div>
      </div>
    </div>
  </div>


  <div class="module-layout">
    <!-- SIDEBAR -->
        <!-- Mobile Controls Toggle (hidden on desktop) -->
    <button class="mobile-controls-btn" id="mobileControlsBtn" aria-expanded="false">
      <span class="mcb-icon">&#9881;</span>
      <span class="mcb-label">Controls</span>
      <span class="mcb-chevron">&#9660;</span>
    </button>
    <aside class="sidebar" id="sidebarPanel">

      <!-- Data Mode ‚Äî always visible -->
      <div class="sb-static">
        <div class="sb-static-title">
          <span>DATA MODE</span>
          <span class="data-badge" id="data-badge">SAMPLE</span>
        </div>
        <div class="sb-mode-row">
          <button class="sb-mode-btn active" id="btnSampleMode" onclick="loadSample()">Sample</button>
          <button class="sb-mode-btn" id="btnRandomMode" onclick="randomizeData()">Random</button>
        </div>
        <div class="sb-mode-hint">Sample = fixed demo dataset &bull; Random = generated dataset</div>
      </div>

      <!-- Assumptions -->
      <div class="sb-acc-group">
        <button class="sb-acc-header" onclick="sidebarAccordion(this)">
          <span>Assumptions</span>
          <span class="sb-acc-chevron">‚ñº</span>
        </button>
        <div class="sb-acc-body" style="padding-top:6px;">
          <div class="sb-acc-input-row">
            <label>Monthly Revenue ($) <span class="help-icon" data-help="How much money your business collects from customers each month on average."></span></label>
            <input type="number" id="inp-revenue" value="500000" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>COGS % <span class="help-icon" data-help="Cost of Goods Sold as % of revenue ‚Äî the direct cost to deliver your product/service."></span></label>
            <input type="number" id="inp-cogs" value="45" step="1" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>DSO ‚Äî Days <span class="help-icon" data-help="Days Sales Outstanding: how many days it takes to collect cash after invoicing a customer. Lower = faster cash."></span></label>
            <input type="number" id="inp-dso" value="45" step="1" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>DPO ‚Äî Days <span class="help-icon" data-help="Days Payable Outstanding: how many days before you pay your suppliers. Higher = you keep cash longer."></span></label>
            <input type="number" id="inp-dpo" value="30" step="1" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>DIO ‚Äî Days <span class="help-icon" data-help="Days Inventory Outstanding: how long inventory sits before being sold. Lower = faster cash conversion."></span></label>
            <input type="number" id="inp-dio" value="20" step="1" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Starting Cash ($) <span class="help-icon" data-help="How much cash the business has today to start the 12-month forecast."></span></label>
            <input type="number" id="inp-cash" value="1200000" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Monthly Growth % <span class="help-icon" data-help="Expected monthly revenue growth rate. Set to 0 for flat revenue."></span></label>
            <input type="number" id="inp-growth" value="3" step="0.5" oninput="withStableScroll(compute)">
          </div>
          <div class="sb-acc-input-row">
            <label>Monthly OpEx ($) <span class="help-icon" data-help="Operating expenses per month excluding COGS ‚Äî salaries, rent, software, etc."></span></label>
            <input type="number" id="inp-opex" value="180000" oninput="withStableScroll(compute)">
          </div>
        </div>
      </div>

    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">

      <!-- DECISION BOX -->
            <div class="decision-box" id="decisionBox">
        <div class="decision-box-eyebrow">Decision</div>
        <div class="decision-box-fallback" id="decisionFallback">Load sample data or adjust assumptions to see the decision.</div>
        <div id="decisionContent" style="display:none;">
          <div class="decision-box-verdict" id="decisionVerdict"></div>
          <ul class="decision-box-bullets" id="decisionBullets"></ul>
          <div class="decision-box-next" id="decisionNext"></div>
        </div>
      </div>

      <!-- BOARD VIEW -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Board View</h2>
          <span class="help-icon" data-help="Executive summary ‚Äî the 30-second version of what this data means for leadership."></span>
        </div>

        <div class="kpi-grid" id="kpi-grid">
          <div class="kpi-box">
            <div class="kpi-box-label">Runway <span class="kpi-tip-icon" tabindex="0">?</span><span class="kpi-tooltip" id="tip-runway">Loading‚Ä¶</span></div>
            <div class="kpi-box-value" id="kpi-runway">‚Äî</div><div class="kpi-box-sub">months remaining</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">CCC <span class="kpi-tip-icon" tabindex="0">?</span><span class="kpi-tooltip" id="tip-ccc">Loading‚Ä¶</span></div>
            <div class="kpi-box-value" id="kpi-ccc">‚Äî</div><div class="kpi-box-sub">days cycle</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">DSO <span class="kpi-tip-icon" tabindex="0">?</span><span class="kpi-tooltip" id="tip-dso">Loading‚Ä¶</span></div>
            <div class="kpi-box-value" id="kpi-dso">‚Äî</div><div class="kpi-box-sub">days to collect</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">DPO <span class="kpi-tip-icon" tabindex="0">?</span><span class="kpi-tooltip" id="tip-dpo">Loading‚Ä¶</span></div>
            <div class="kpi-box-value" id="kpi-dpo">‚Äî</div><div class="kpi-box-sub">days to pay</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">DIO <span class="kpi-tip-icon" tabindex="0">?</span><span class="kpi-tooltip" id="tip-dio">Loading‚Ä¶</span></div>
            <div class="kpi-box-value" id="kpi-dio">‚Äî</div><div class="kpi-box-sub">days in inventory</div>
          </div>
          <div class="kpi-box">
            <div class="kpi-box-label">Net Cash / Mo <span class="kpi-tip-icon" tabindex="0">?</span><span class="kpi-tooltip" id="tip-cashpm">Loading‚Ä¶</span></div>
            <div class="kpi-box-value" id="kpi-cashpm">‚Äî</div><div class="kpi-box-sub">avg monthly change</div>
          </div>
        </div>

        <div class="module-card">
          <div id="what-means" class="what-means"><p>Load data to see summary.</p></div>
          <div class="board-grid">
            <div class="board-block">
              <div class="board-block-title">‚ö† RISKS & WATCHOUTS</div>
              <ul id="risks-list"><li>‚Äî</li></ul>
            </div>
            <div class="board-block">
              <div class="board-block-title">üîß LEVERS TO PULL</div>
              <ul id="levers-list"><li>‚Äî</li></ul>
            </div>
          </div>
        </div>
      </div>

      <!-- CCC CHART -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Cash Conversion Cycle Breakdown</h2>
          <span class="help-icon" data-help="CCC = DSO + DIO ‚àí DPO. Shows how long it takes to turn operations into cash. Lower is better."></span>
        </div>
        <div class="module-card">
          <div class="chart-wrap"><canvas id="chart-ccc" height="120"></canvas></div>

          <!-- CCC Chart Explainer -->
          <div id="ccc-explainer" style="margin-top:20px; border-top: 1px solid var(--border); padding-top:18px; display:none;">

            <!-- Live CCC callout -->
            <div id="ccc-live-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">Current Cash Conversion Cycle</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="ccc-live-value" style="font-size:32px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">‚Äî</span>
                  <span style="font-size:13px; color:var(--muted);">days</span>
                  <span id="ccc-live-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Formula</div>
                <div id="ccc-live-formula" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>

            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:12px; letter-spacing:0.02em;">üìñ HOW TO READ THIS CHART</div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:14px;" id="ccc-bar-explainer">
              <!-- filled by JS -->
            </div>
            <div id="ccc-verdict-block" style="padding:12px 16px; border-radius:10px; font-size:13px; line-height:1.6;">
              <!-- filled by JS -->
            </div>
            <div style="margin-top:12px; font-size:12px; color:var(--muted); line-height:1.6;" id="ccc-formula-note"></div>
          </div>
        </div>
      </div>

      <!-- 13-WEEK CASH FLOW CHART -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">13-Week Cash Flow View</h2>
          <span class="help-icon" data-help="Short-term weekly cash plan: cash in (collections) vs. cash out (payroll, vendors, overhead). Spot shortfalls before they become a crisis."></span>
        </div>
        <div class="module-card">
          <div class="chart-wrap"><canvas id="chart-13week" height="180"></canvas></div>

          <!-- 13-Week Explainer Box -->
          <div id="week13-explainer" style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px; display:none;">
            <!-- Live callout -->
            <div id="week13-live-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">13-Week Ending Cash Position</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="week13-live-value" style="font-size:32px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">‚Äî</span>
                  <span id="week13-live-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Weekly Net</div>
                <div id="week13-net-label" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>

            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">üìñ WHAT YOU'RE LOOKING AT</div>
            <div id="week13-verdict-block" style="padding:12px 16px; border-radius:10px; font-size:13px; line-height:1.6; margin-bottom:10px;"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              This is a <strong>short-term cash plan</strong>. It shows weekly cash in (collections) and cash out (payroll, vendors, overhead) so you can spot cash shortfalls early. If the line trends toward zero, you need to pull levers now ‚Äî speed up collections, delay non-critical payments, or reduce spend ‚Äî before it becomes a crisis.
            </div>
          </div>
        </div>
      </div>

      <!-- CASH BALANCE CHART -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">12-Month Cash Balance Forecast</h2>
          <span class="help-icon" data-help="Projected cash balance each month based on revenue, COGS, OpEx, and working capital timing."></span>
        </div>
        <div class="module-card">
          <div class="chart-wrap"><canvas id="chart-cash" height="160"></canvas></div>

          <!-- 12-Month Explainer Box -->
          <div id="cash12-explainer" style="margin-top:20px; border-top:1px solid var(--border); padding-top:18px; display:none;">
            <div id="cash12-live-callout" style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-bottom:16px; padding:12px 16px; border-radius:12px; background:rgba(15,118,110,0.06); border:1.5px solid rgba(15,118,110,0.2);">
              <div>
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:2px;">12-Month Ending Cash Balance</div>
                <div style="display:flex; align-items:baseline; gap:8px;">
                  <span id="cash12-live-value" style="font-size:32px; font-weight:800; letter-spacing:-0.03em; color:var(--text);">‚Äî</span>
                  <span id="cash12-live-badge" style="font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;"></span>
                </div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.08em; color:var(--muted); margin-bottom:4px;">Trend</div>
                <div id="cash12-trend-label" style="font-size:13px; color:var(--text); font-weight:600;"></div>
              </div>
            </div>

            <div style="font-size:13px; font-weight:700; color:var(--text); margin-bottom:10px; letter-spacing:0.02em;">üìñ WHAT YOU'RE LOOKING AT</div>
            <div id="cash12-verdict-block" style="padding:12px 16px; border-radius:10px; font-size:13px; line-height:1.6; margin-bottom:10px;"></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.7;">
              This chart projects your <strong>ending cash balance</strong> each month over 12 months based on revenue growth, COGS, operating expenses, and working capital timing (DSO, DPO, DIO). A rising line means the business is generating more cash than it spends ‚Äî a declining line is a warning to act before cash runs out.
            </div>
          </div>
        </div>
      </div>

      <!-- DETAIL TABLE -->
      <div class="module-section">
        <div class="section-header-with-help">
          <h2 class="module-section-title">Monthly Detail</h2>
          <span class="help-icon" data-help="Month-by-month breakdown of revenue, COGS, gross profit, OpEx, and ending cash balance."></span>
        </div>
        <div class="module-card" style="overflow-x:auto;">
          <table class="data-table" id="detail-table">
            <thead><tr><th>Month</th><th>Revenue</th><th>COGS</th><th>Gross Profit</th><th>OpEx</th><th>Net Cash Flow</th><th>Ending Cash</th></tr></thead>
            <tbody id="detail-tbody"></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- ‚îÄ‚îÄ Next Module ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <nav class="next-module-bar" aria-label="Next recommended module">
    <div>
      <div class="next-module-label">Next recommended</div>
      <div class="next-module-title">Operations Finance &amp; Spend Analytics</div>
      <div class="next-module-why">Cash cycle is mapped ‚Äî now control where operational spend is actually going.</div>
    </div>
    <div class="next-module-actions">
      <a class="btn btn-solid" href="operations-spend.html">Open Ops Finance ‚Üí</a>
      <a class="btn btn-ghost" href="index.html">‚Üê Back to Portfolio</a>
    </div>
  </nav>

</main>

<a class="to-top" href="#main" aria-label="Back to top">‚Üë</a>
<script src="main.js"></script>
<script>
  let chartCCC = null, chartCash = null, chart13Week = null;

  const fmt = (n) => '$' + Math.round(n).toLocaleString();
  const fmtK = (n) => { const abs = Math.abs(n); const sign = n < 0 ? '-' : ''; if (abs >= 1000000) return sign + '$' + (abs/1000000).toFixed(1) + 'M'; if (abs >= 1000) return sign + '$' + (abs/1000).toFixed(0) + 'K'; return sign + '$' + Math.round(abs); };

  function getInputs() {
    return {
      revenue: +document.getElementById('inp-revenue').value,
      cogs: +document.getElementById('inp-cogs').value / 100,
      dso: +document.getElementById('inp-dso').value,
      dpo: +document.getElementById('inp-dpo').value,
      dio: +document.getElementById('inp-dio').value,
      cash: +document.getElementById('inp-cash').value,
      growth: +document.getElementById('inp-growth').value / 100,
      opex: +document.getElementById('inp-opex').value,
    };
  }

  function setInputs(vals) {
    document.getElementById('inp-revenue').value = vals.revenue;
    document.getElementById('inp-cogs').value = vals.cogs;
    document.getElementById('inp-dso').value = vals.dso;
    document.getElementById('inp-dpo').value = vals.dpo;
    document.getElementById('inp-dio').value = vals.dio;
    document.getElementById('inp-cash').value = vals.cash;
    document.getElementById('inp-growth').value = vals.growth;
    document.getElementById('inp-opex').value = vals.opex;
  }

  const SAMPLE = { revenue: 500000, cogs: 45, dso: 45, dpo: 30, dio: 20, cash: 1200000, growth: 3, opex: 180000 };

  function _setModeBtn(mode) {
    var s = document.getElementById('btnSampleMode');
    var r = document.getElementById('btnRandomMode');
    if (s) s.className = 'sb-mode-btn' + (mode === 'sample' ? ' active' : '');
    if (r) r.className = 'sb-mode-btn' + (mode === 'random' ? ' active' : '');
  }

  function loadSample() {
    withStableScroll(function() {
    setInputs(SAMPLE);
    document.getElementById('data-badge').textContent = 'SAMPLE';
    document.getElementById('data-badge').className = 'data-badge';
    _setModeBtn('sample');
    compute();
    });
  }

  function randomizeData() {
    withStableScroll(function() {
    const r = (a, b, step=1) => Math.round((a + Math.random() * (b - a)) / step) * step;
    setInputs({
      revenue: r(200000, 2000000, 50000),
      cogs: r(30, 70, 5),
      dso: r(20, 90, 5),
      dpo: r(15, 60, 5),
      dio: r(0, 45, 5),
      cash: r(200000, 5000000, 100000),
      growth: r(-2, 10, 0.5),
      opex: r(50000, 500000, 10000),
    });
    document.getElementById('data-badge').textContent = 'RANDOM';
    document.getElementById('data-badge').className = 'data-badge random';
    _setModeBtn('random');
    compute();
    });
  }

  function resetDefaults() { loadSample(); }

  function compute() {
    const inp = getInputs();
    const { revenue, cogs, dso, dpo, dio, growth, opex } = inp;
    let cash = inp.cash;

    // CCC
    const ccc = dso + dio - dpo;

    // Build 12-month forecast
    const months = [];
    const labels = ['M1','M2','M3','M4','M5','M6','M7','M8','M9','M10','M11','M12'];
    let totalNet = 0;
    for (let i = 0; i < 12; i++) {
      const rev = revenue * Math.pow(1 + growth, i);
      const cogsAmt = rev * cogs;
      const gp = rev - cogsAmt;
      // Working capital adjustment: AR increases tie up cash
      const arAdj = i === 0 ? -rev * (dso / 30) : -rev * growth * (dso / 30);
      const apAdj = i === 0 ? cogsAmt * (dpo / 30) : cogsAmt * growth * (dpo / 30);
      const invAdj = i === 0 ? -cogsAmt * (dio / 30) : -cogsAmt * growth * (dio / 30);
      const netCF = gp - opex + arAdj + apAdj + invAdj;
      cash += netCF;
      totalNet += netCF;
      months.push({ label: labels[i], rev, cogsAmt, gp, opex, netCF, cash: Math.max(cash, 0) });
    }

    const avgNetCF = totalNet / 12;
    const runway = avgNetCF < 0 ? Math.abs(months[0].cash / (totalNet / 12)) : 999;
    const runwayDisplay = runway >= 99 ? '‚àû' : runway.toFixed(1);

    // Update KPIs
    document.getElementById('kpi-runway').textContent = runwayDisplay;
    document.getElementById('kpi-ccc').textContent = ccc + 'd';
    document.getElementById('kpi-dso').textContent = dso + 'd';
    document.getElementById('kpi-dpo').textContent = dpo + 'd';
    document.getElementById('kpi-dio').textContent = dio + 'd';
    document.getElementById('kpi-cashpm').textContent = fmtK(avgNetCF);

    // Update Board View tooltips with dynamic values
    const runwayLabel = runway >= 99
      ? 'Runway is infinite ‚Äî the business is cash-flow positive and not burning cash.'
      : `Runway is how long your cash will last at the current burn rate. At ${runwayDisplay} months, you have until roughly ${new Date(Date.now() + runway * 30 * 24 * 3600 * 1000).toLocaleDateString('en-US',{month:'short',year:'numeric'})} before cash runs out ‚Äî assuming nothing changes.`;
    document.getElementById('tip-runway').textContent = runwayLabel;

    document.getElementById('tip-ccc').textContent =
      `Cash Conversion Cycle: the total number of days between spending money on operations and actually collecting cash from customers. Your CCC is ${ccc} days ‚Äî meaning every dollar you spend takes ${ccc} days to come back. Lower is better.`;

    document.getElementById('tip-dso').textContent =
      `Days Sales Outstanding: after you send an invoice, it takes an average of ${dso} days for customers to pay you. Faster collection = more cash on hand. Industry target is often 30‚Äì45 days.`;

    document.getElementById('tip-dpo').textContent =
      `Days Payable Outstanding: you're taking ${dpo} days to pay your own suppliers. Paying later keeps cash in your bank longer. A higher DPO (without damaging supplier relationships) is generally better for cash flow.`;

    document.getElementById('tip-dio').textContent =
      `Days Inventory Outstanding: your inventory sits for ${dio} days on average before being sold. Think of it as money sitting on a shelf. Lower means you're converting stock to cash faster.`;

    const cashSign = avgNetCF >= 0 ? 'gaining' : 'burning';
    document.getElementById('tip-cashpm').textContent =
      `Net Cash per Month: after all revenue comes in and all expenses go out, you are ${cashSign} an average of ${fmtK(Math.abs(avgNetCF))} per month. ${avgNetCF >= 0 ? 'You are cash-flow positive ‚Äî the business funds itself.' : 'You are cash-flow negative ‚Äî the business is consuming its reserves.'}`;

    // --- CCC Chart Explainer ---
    const explainer = document.getElementById('ccc-explainer');
    explainer.style.display = '';

    // Live CCC callout
    document.getElementById('ccc-live-value').textContent = ccc;
    document.getElementById('ccc-live-formula').innerHTML = `${dso}d &nbsp;+&nbsp; ${dio}d &nbsp;‚àí&nbsp; ${dpo}d &nbsp;= &nbsp;<strong>${ccc}d</strong>`;
    const liveBadge = document.getElementById('ccc-live-badge');
    const liveBanner = document.getElementById('ccc-live-callout');
    const liveVal = document.getElementById('ccc-live-value');
    if (ccc <= 30) {
      liveBadge.textContent = '‚úÖ Healthy'; liveBadge.style.cssText = 'font-size:11px;font-weight:700;padding:3px 9px;border-radius:999px;background:rgba(15,118,110,0.12);color:#0f766e;';
      liveBanner.style.borderColor = 'rgba(15,118,110,0.25)'; liveBanner.style.background = 'rgba(15,118,110,0.06)';
      liveVal.style.color = '#0f766e';
    } else if (ccc <= 60) {
      liveBadge.textContent = '‚ö†Ô∏è Watch'; liveBadge.style.cssText = 'font-size:11px;font-weight:700;padding:3px 9px;border-radius:999px;background:#fef3c7;color:#92400e;';
      liveBanner.style.borderColor = 'rgba(217,119,6,0.3)'; liveBanner.style.background = '#fffbeb';
      liveVal.style.color = '#d97706';
    } else {
      liveBadge.textContent = 'üî¥ High'; liveBadge.style.cssText = 'font-size:11px;font-weight:700;padding:3px 9px;border-radius:999px;background:#fee2e2;color:#dc2626;';
      liveBanner.style.borderColor = 'rgba(220,38,38,0.3)'; liveBanner.style.background = '#fef2f2';
      liveVal.style.color = '#dc2626';
    }

    // Determine health of each bar
    const dsoHealth = dso <= 30 ? 'good' : dso <= 45 ? 'ok' : 'bad';
    const dioHealth = dio <= 15 ? 'good' : dio <= 30 ? 'ok' : 'bad';
    const dpoHealth = dpo >= 45 ? 'good' : dpo >= 30 ? 'ok' : 'bad';
    const cccHealth = ccc <= 30 ? 'good' : ccc <= 60 ? 'ok' : 'bad';

    const healthColor = { good: '#0f766e', ok: '#d97706', bad: '#dc2626' };
    const healthBg   = { good: 'rgba(15,118,110,0.08)', ok: '#fffbeb', bad: '#fef2f2' };
    const healthLabel = { good: '‚úÖ Healthy', ok: '‚ö†Ô∏è Watch', bad: 'üî¥ Concern' };

    function barCard(title, value, sign, healthKey, explain) {
      const col = healthColor[healthKey];
      return `<div style="padding:10px 12px; border:1px solid ${col}33; border-radius:10px; background:${healthBg[healthKey]};">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
          <span style="font-size:12px;font-weight:700;color:var(--text);">${title}</span>
          <span style="font-size:11px;font-weight:700;color:${col};">${healthLabel[healthKey]}</span>
        </div>
        <div style="font-size:18px;font-weight:800;color:${col};margin-bottom:4px;">${sign}${value}d</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.5;">${explain}</div>
      </div>`;
    }

    document.getElementById('ccc-bar-explainer').innerHTML =
      barCard('DSO ‚Äî Blue bar (right)', dso, '+', dsoHealth,
        dsoHealth === 'good' ? `You collect in ${dso} days ‚Äî fast. Cash arrives quickly.`
        : dsoHealth === 'ok' ? `${dso} days to collect is acceptable but could be tighter. Aim for 30d.`
        : `${dso} days is slow. You're waiting over a month for cash that's already earned.`) +
      barCard('DIO ‚Äî Teal bar (right)', dio, '+', dioHealth,
        dioHealth === 'good' ? `Inventory moves fast at ${dio} days ‚Äî minimal cash locked up in stock.`
        : dioHealth === 'ok' ? `${dio} days in inventory is moderate. Monitor for slow-moving SKUs.`
        : `${dio} days means cash is tied up in unsold inventory for too long.`) +
      barCard('DPO ‚Äî Red bar (left)', dpo, '‚àí', dpoHealth,
        dpoHealth === 'good' ? `You hold supplier payments for ${dpo} days ‚Äî great for cash flow.`
        : dpoHealth === 'ok' ? `${dpo} days to pay suppliers is decent. Try to negotiate longer terms.`
        : `Only ${dpo} days before you pay suppliers. You're giving up cash earlier than you need to.`) +
      barCard('Net CCC ‚Äî Bottom bar', ccc, '', cccHealth,
        cccHealth === 'good' ? `${ccc} days total cycle ‚Äî excellent. Cash moves through your business quickly.`
        : cccHealth === 'ok' ? `${ccc} days is manageable but leaves room to improve. Target under 30d.`
        : `${ccc} days is high. It takes over ${ccc} days for every dollar spent to come back as cash.`);

    // Overall verdict block
    const vBg = healthBg[cccHealth];
    const vCol = healthColor[cccHealth];
    const vEmoji = cccHealth === 'good' ? 'üü¢' : cccHealth === 'ok' ? 'üü°' : 'üî¥';
    const vTitle = cccHealth === 'good' ? 'This looks healthy' : cccHealth === 'ok' ? 'Manageable ‚Äî but room to improve' : 'This needs attention';
    const vBody = cccHealth === 'good'
      ? `A CCC of ${ccc} days means your business converts spending into collected cash in about ${ccc} days. The right-pointing bars (DSO + DIO) are short, and the left-pointing bar (DPO) is long ‚Äî exactly what you want to see. Keep collecting fast and paying late.`
      : cccHealth === 'ok'
      ? `Your CCC of ${ccc} days means cash is tied up for about ${ccc} days before it returns. The biggest opportunity is likely ${dso > 40 ? 'reducing DSO ‚Äî customers are taking too long to pay' : dpo < 35 ? 'extending DPO ‚Äî you could negotiate longer payment terms with suppliers' : 'reducing DIO ‚Äî inventory is sitting too long before being sold'}.`
      : `A CCC of ${ccc} days is a red flag. Every sales cycle, your business goes ${ccc} days without seeing the cash it's owed. The bars extending right (DSO + DIO) should be shorter, and the bar extending left (DPO) should be longer. Focus on ${dso > dio ? 'collecting from customers faster (DSO)' : 'moving inventory faster (DIO)'} first.`;

    document.getElementById('ccc-verdict-block').style.cssText = `padding:14px 16px; border-radius:10px; background:${vBg}; border:1px solid ${vCol}33; font-size:13px; line-height:1.65; color:var(--text);`;
    document.getElementById('ccc-verdict-block').innerHTML =
      `<div style="font-weight:700;font-size:14px;color:${vCol};margin-bottom:6px;">${vEmoji} ${vTitle}</div>${vBody}`;

    document.getElementById('ccc-formula-note').innerHTML =
      `<strong>Formula:</strong> CCC = DSO + DIO ‚àí DPO &nbsp;‚Üí&nbsp; ${dso}d + ${dio}d ‚àí ${dpo}d = <strong>${ccc}d</strong>. &nbsp;
       The bars to the <strong>right</strong> add to your cycle (bad if large). The bar to the <strong>left</strong> subtracts from it (good if large). The goal is a short or negative CCC.`;
    let decision = '', bullets = [], driver = '';
    const runwayNum = runway >= 99 ? 999 : runway;
    if (runwayNum < 3) {
      decision = 'Emergency: Tighten collections and extend payables immediately.';
      bullets = [`Runway is critically low at ${runwayDisplay} months`, `CCC of ${ccc} days is draining cash each cycle`, `Collect faster: reduce DSO from ${dso}d toward 30d`, `Negotiate to extend DPO above current ${dpo}d`];
      driver = `DSO (${dso}d) ‚Äî reducing by 15 days adds ~${fmtK(revenue * 15/30)} in immediate cash.`;
    } else if (runwayNum < 6) {
      decision = 'Tighten working capital before scaling any spend.';
      bullets = [`Runway is short at ${runwayDisplay} months ‚Äî needs improvement`, `CCC = ${ccc} days; target below 35 days`, `AR is tying up ~${fmtK(revenue * dso / 30)} in uncollected revenue`, `Fix working capital before investing in growth`];
      driver = `CCC (${ccc}d) ‚Äî each 10-day improvement frees ~${fmtK(revenue * 10/30)} per cycle.`;
    } else if (ccc > 60) {
      decision = 'Fix working capital cycle ‚Äî OK to sustain, not to scale.';
      bullets = [`Runway OK at ${runwayDisplay} months`, `CCC of ${ccc} days is elevated ‚Äî watch for deterioration`, `DIO of ${dio}d suggests inventory is moving slowly`, `Scale carefully; protect cash position`];
      driver = `DIO (${dio}d) ‚Äî reducing inventory days to 10 frees ${fmtK(revenue * cogs * (dio-10)/30)}.`;
    } else {
      decision = 'Working capital is healthy ‚Äî OK to scale carefully.';
      bullets = [`Runway: ${runwayDisplay} months ‚Äî strong position`, `CCC of ${ccc} days is within healthy range`, `Avg monthly net cash: ${fmtK(avgNetCF)}`, `Maintain DPO at ${dpo}d+ and monitor DSO monthly`];
      driver = `Revenue growth (${inp.growth}%) ‚Äî each +1% growth adds ${fmtK(revenue * 0.01 * (1-cogs))} monthly to gross profit.`;
    }

    // Map state
    const state = runwayNum < 6 ? 'negative' : (ccc > 60 ? 'warning' : 'positive');
    setDecisionBox(state, 'Decision:', decision, bullets, driver);

    // What this means
    const cashTrend = months[11].cash > months[0].cash ? 'improving' : 'declining';
    document.getElementById('what-means').innerHTML = `<p>The business currently holds ${fmtK(months[0].cash - months[0].netCF)} in starting cash. Over 12 months, the cash balance is <strong>${cashTrend}</strong> ‚Äî ending at ${fmtK(months[11].cash)}. The Cash Conversion Cycle of <strong>${ccc} days</strong> means it takes over ${ccc} days to turn operations into cash. ${avgNetCF >= 0 ? 'The business is cash-flow positive on average.' : 'The business is burning cash on average ‚Äî action needed.'}</p>`;

    document.getElementById('risks-list').innerHTML = [
      `CCC could worsen if customers pay slower (DSO drift)`,
      `Revenue growth increases AR ‚Äî needs working capital funding`,
      `OpEx of ${fmtK(opex)}/mo leaves ${fmtK(revenue*(1-cogs)-opex)} gross margin buffer`,
    ].map(r=>`<li>${r}</li>`).join('');

    document.getElementById('levers-list').innerHTML = [
      `Reduce DSO: offer 2/10 net 30 discounts to collect faster`,
      `Extend DPO: negotiate 45-60d terms with key suppliers`,
      `Reduce DIO: tighten inventory reorder points / consignment`,
    ].map(r=>`<li>${r}</li>`).join('');

    // CCC Chart
    const cccCtx = document.getElementById('chart-ccc').getContext('2d');
    if (chartCCC) chartCCC.destroy();
    chartCCC = new Chart(cccCtx, {
      type: 'bar',
      data: {
        labels: ['DSO (Collect)', 'DIO (Inventory)', 'DPO (Pay)', 'Net CCC'],
        datasets: [{
          label: 'Days',
          data: [dso, dio, -dpo, ccc],
          backgroundColor: [
            'rgba(27,77,122,0.75)', 'rgba(15,118,110,0.75)',
            'rgba(239,68,68,0.75)', ccc > 50 ? 'rgba(239,68,68,0.9)' : 'rgba(15,118,110,0.9)'
          ],
          borderRadius: 8,
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ctx.parsed.x + ' days' } } },
        scales: { x: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { callback: v => v + 'd' } }, y: { grid: { display: false } } }
      }
    });

    // Cash Balance Chart
    const cashCtx = document.getElementById('chart-cash').getContext('2d');
    if (chartCash) chartCash.destroy();
    chartCash = new Chart(cashCtx, {
      type: 'line',
      data: {
        labels: months.map(m => m.label),
        datasets: [{
          label: 'Cash Balance',
          data: months.map(m => m.cash),
          borderColor: months[11].cash > months[0].cash ? 'rgba(15,118,110,1)' : 'rgba(239,68,68,1)',
          backgroundColor: months[11].cash > months[0].cash ? 'rgba(15,118,110,0.08)' : 'rgba(239,68,68,0.08)',
          fill: true, tension: 0.4, pointRadius: 4,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => '$' + Math.round(ctx.parsed.y).toLocaleString() } } },
        scales: {
          y: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { callback: v => fmtK(v) } },
          x: { grid: { display: false } }
        }
      }
    });

    // ‚îÄ‚îÄ 13-Week Cash Flow Chart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Derive weekly cash in/out from monthly assumptions
    const weeklyRevenue = revenue / 4.33;
    const weeklyOpex = opex / 4.33;
    const weeklyCogsAmt = weeklyRevenue * cogs;
    const weeklyNetCF = weeklyRevenue - weeklyCogsAmt - weeklyOpex;
    const weekLabels = Array.from({length:13}, (_,i) => 'W'+(i+1));
    const weekCashIn = weekLabels.map((_,i) => Math.round(weeklyRevenue * (1 + growth/4 * i)));
    const weekCashOut = weekLabels.map((_,i) => Math.round((weeklyCogsAmt + weeklyOpex) * (1 + growth/4 * i * 0.3)));
    let wCash = inp.cash;
    const weekBalance = weekLabels.map((_,i) => {
      wCash += weekCashIn[i] - weekCashOut[i];
      return Math.max(wCash, 0);
    });

    const week13ctx = document.getElementById('chart-13week').getContext('2d');
    if (chart13Week) chart13Week.destroy();
    const w13Positive = weekBalance[12] > inp.cash;
    chart13Week = new Chart(week13ctx, {
      type: 'bar',
      data: {
        labels: weekLabels,
        datasets: [
          {
            label: 'Cash In',
            data: weekCashIn,
            backgroundColor: 'rgba(15,118,110,0.65)',
            borderRadius: 5,
            order: 2,
          },
          {
            label: 'Cash Out',
            data: weekCashOut.map(v => -v),
            backgroundColor: 'rgba(239,68,68,0.55)',
            borderRadius: 5,
            order: 2,
          },
          {
            label: 'Cash Balance',
            data: weekBalance,
            type: 'line',
            borderColor: w13Positive ? 'rgba(15,118,110,1)' : 'rgba(239,68,68,1)',
            backgroundColor: 'transparent',
            borderWidth: 2.5,
            pointRadius: 3,
            tension: 0.4,
            order: 1,
            yAxisID: 'y',
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true, position: 'top', labels: { font: { size: 12 }, boxWidth: 14 } },
          tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': $' + Math.abs(Math.round(ctx.parsed.y)).toLocaleString() } }
        },
        scales: {
          y: { grid: { color: 'rgba(0,0,0,0.04)' }, ticks: { callback: v => fmtK(Math.abs(v)) } },
          x: { grid: { display: false } }
        }
      }
    });

    // 13-Week explainer
    const week13End = weekBalance[12];
    const week13Pos = week13End > inp.cash;
    const week13Low = weekBalance.some(b => b < inp.cash * 0.15);
    const avgWeeklyNet = weekCashIn.reduce((a,v,i) => a + v - weekCashOut[i], 0) / 13;
    document.getElementById('week13-explainer').style.display = '';
    document.getElementById('week13-live-value').textContent = fmtK(week13End);
    const w13BadgeColor = week13Low ? '#dc2626' : (week13Pos ? '#0f766e' : '#d97706');
    const w13BadgeBg = week13Low ? 'rgba(220,38,38,0.10)' : (week13Pos ? 'rgba(15,118,110,0.10)' : 'rgba(217,119,6,0.10)');
    const w13BadgeText = week13Low ? '‚ö† Cash Risk' : (week13Pos ? '‚úì Building' : '‚Üì Declining');
    const w13BadgeEl = document.getElementById('week13-live-badge');
    w13BadgeEl.textContent = w13BadgeText;
    w13BadgeEl.style.cssText = `background:${w13BadgeBg}; color:${w13BadgeColor}; font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;`;
    document.getElementById('week13-net-label').innerHTML = `${fmtK(avgWeeklyNet)}<span style="color:var(--muted);font-weight:400;font-size:11px;"> avg / week</span>`;
    const week13VerdictEl = document.getElementById('week13-verdict-block');
    if (week13Low) {
      week13VerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fef2f2; border-left:3px solid #dc2626; font-size:13px; line-height:1.6;';
      week13VerdictEl.innerHTML = `<strong style="color:#dc2626;">‚ö† Cash shortfall risk detected.</strong> One or more weeks dip critically close to zero ‚Äî the business is vulnerable to a missed payment or unexpected expense. Act now: accelerate collections, defer discretionary spend, and review payroll timing.`;
    } else if (!week13Pos) {
      week13VerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fffbeb; border-left:3px solid #d97706; font-size:13px; line-height:1.6;';
      week13VerdictEl.innerHTML = `<strong style="color:#d97706;">‚ö° Cash is declining week over week.</strong> Cash out exceeds cash in on a net basis ‚Äî ending at ${fmtK(week13End)} vs. starting at ${fmtK(inp.cash)}. Watch closely and identify which weeks are the most cash-intensive to plan ahead.`;
    } else {
      week13VerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#f0fdf9; border-left:3px solid #0f766e; font-size:13px; line-height:1.6;';
      week13VerdictEl.innerHTML = `<strong style="color:#0f766e;">‚úì Cash is building week over week.</strong> Collections are outpacing outflows ‚Äî ending 13-week cash is ${fmtK(week13End)}, up from ${fmtK(inp.cash)}. The business has a positive short-term cash position.`;
    }

    // ‚îÄ‚îÄ 12-Month Cash Balance explainer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const cash12End = months[11].cash;
    const cash12Pos = cash12End > months[0].cash - months[0].netCF;
    document.getElementById('cash12-explainer').style.display = '';
    document.getElementById('cash12-live-value').textContent = fmtK(cash12End);
    const c12Color = cash12Pos ? '#0f766e' : '#dc2626';
    const c12Bg = cash12Pos ? 'rgba(15,118,110,0.10)' : 'rgba(220,38,38,0.10)';
    const c12Badge = document.getElementById('cash12-live-badge');
    c12Badge.textContent = cash12Pos ? '‚úì Positive Trend' : '‚Üì Declining';
    c12Badge.style.cssText = `background:${c12Bg}; color:${c12Color}; font-size:11px; font-weight:700; padding:3px 9px; border-radius:999px; margin-left:4px;`;
    const startCash = months[0].cash - months[0].netCF;
    const changePct = startCash > 0 ? ((cash12End - startCash) / startCash * 100).toFixed(1) : '‚Äî';
    document.getElementById('cash12-trend-label').innerHTML = `${cash12Pos ? '‚ñ≤' : '‚ñº'} ${Math.abs(changePct)}% over 12 mo`;
    const c12VerdictEl = document.getElementById('cash12-verdict-block');
    if (cash12Pos && avgNetCF > 0) {
      c12VerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#f0fdf9; border-left:3px solid #0f766e; font-size:13px; line-height:1.6;';
      c12VerdictEl.innerHTML = `<strong style="color:#0f766e;">‚úì Positive ‚Äî cash is growing.</strong> The business ends the year at ${fmtK(cash12End)}, gaining ${fmtK(cash12End - startCash)} (+${changePct}%) from the starting balance. Average monthly net cash flow is ${fmtK(avgNetCF)} ‚Äî the business is self-funding its growth.`;
    } else if (!cash12Pos || avgNetCF < 0) {
      c12VerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fef2f2; border-left:3px solid #dc2626; font-size:13px; line-height:1.6;';
      c12VerdictEl.innerHTML = `<strong style="color:#dc2626;">‚ö† Negative ‚Äî cash is declining.</strong> The business ends the year at ${fmtK(cash12End)}, down ${fmtK(startCash - cash12End)} from the start. Average monthly net cash flow is ${fmtK(avgNetCF)} ‚Äî this trajectory is unsustainable without intervention. Tighten collections (DSO), extend payables (DPO), and review OpEx.`;
    } else {
      c12VerdictEl.style.cssText = 'padding:12px 16px; border-radius:10px; background:#fffbeb; border-left:3px solid #d97706; font-size:13px; line-height:1.6;';
      c12VerdictEl.innerHTML = `<strong style="color:#d97706;">‚ö° Mixed ‚Äî watch closely.</strong> Cash ends at ${fmtK(cash12End)}, a change of ${changePct}% over 12 months. The trend warrants monitoring ‚Äî small changes in revenue growth or DSO could flip this negative.`;
    }

    // Detail Table
    const tbody = document.getElementById('detail-tbody');
    tbody.innerHTML = months.map(m => `<tr>
      <td>${m.label}</td><td>${fmt(m.rev)}</td><td>${fmt(m.cogsAmt)}</td>
      <td>${fmt(m.gp)}</td><td>${fmt(m.opex)}</td>
      <td style="color:${m.netCF>=0?'var(--accent)':'#ef4444'}">${fmtK(m.netCF)}</td>
      <td><strong>${fmtK(m.cash)}</strong></td>
    </tr>`).join('');
  }

  // Init
  // Enable global tooltip bubble (prevents tooltip clipping in sidebar)
  initTooltips();
  loadSample();

  function setDecisionBox(state, verdict, verdictAction, bullets, next) {
    // state: 'positive' | 'warning' | 'negative'
    const box = document.getElementById('decisionBox');
    box.classList.remove('decision-box--positive','decision-box--warning','decision-box--negative');
    box.classList.add('decision-box--' + state);
    document.getElementById('decisionFallback').style.display = 'none';
    document.getElementById('decisionContent').style.display = '';
    document.getElementById('decisionVerdict').innerHTML = verdict + ' <span class="verdict-action">' + verdictAction + '</span>';
    document.getElementById('decisionBullets').innerHTML = bullets.map(b => '<li>' + b + '</li>').join('');
    document.getElementById('decisionNext').innerHTML = 'Top driver: <span>' + next + '</span>';
  }


    /* ‚îÄ‚îÄ Sidebar accordion: one section open at a time ‚îÄ‚îÄ */
    function sidebarAccordion(headerEl) {
      var sidebar = headerEl.closest('.sidebar');
      var allHeaders = sidebar.querySelectorAll('.sb-acc-header');
      allHeaders.forEach(function(h) {
        if (h === headerEl) return;
        h.classList.remove('open');
        var b = h.nextElementSibling;
        if (b && b.classList.contains('sb-acc-body')) b.classList.remove('open');
      });
      headerEl.classList.toggle('open');
      var body = headerEl.nextElementSibling;
      if (body && body.classList.contains('sb-acc-body')) body.classList.toggle('open');
    }


    /* ‚îÄ‚îÄ Body-level tooltip engine (fixes sidebar overflow clipping) ‚îÄ‚îÄ */
    function initTooltips() {
      var ttEl = document.getElementById('tt-root');
      if (!ttEl) {
        ttEl = document.createElement('div');
        ttEl.id = 'tt-root';
        document.body.appendChild(ttEl);
      }

      var hideTimer = null;

      function show(text, targetEl) {
        clearTimeout(hideTimer);
        ttEl.textContent = text;
        ttEl.classList.add('tt-visible');
        position(targetEl);
      }

      function hide() {
        hideTimer = setTimeout(function() {
          ttEl.classList.remove('tt-visible');
        }, 80);
      }

      function position(el) {
        var rect = el.getBoundingClientRect();
        var ttW = 260;
        var gap = 8;
        var left = rect.left + rect.width / 2 - ttW / 2;
        left = Math.max(12, Math.min(left, window.innerWidth - ttW - 12));
        var ttH = ttEl.offsetHeight || 60;
        var top, transform;
        if (rect.top - ttH - gap < 8) {
          // Flip below if not enough room above
          top = rect.bottom + gap;
          transform = 'translateY(0)';
        } else {
          top = rect.top - gap;
          transform = 'translateY(-100%)';
        }
        ttEl.style.left = left + 'px';
        ttEl.style.top = top + 'px';
        ttEl.style.transform = transform;
      }

      // Event delegation ‚Äî works on dynamically injected elements too
      document.addEventListener('mouseover', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) return;
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (text) show(text, el);
      });

      document.addEventListener('mouseout', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (el) hide();
      });

      // Hide on scroll so tooltip doesn't chase the page
      window.addEventListener('scroll', function() {
        ttEl.classList.remove('tt-visible');
      }, { passive: true });
    }


    /* Mobile sidebar toggle */
    (function() {
      var btn = document.getElementById('mobileControlsBtn');
      var sb  = document.querySelector('.sidebar');
      if (!btn || !sb) return;
      btn.addEventListener('click', function() {
        var open = sb.classList.toggle('mobile-open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    })();


    /* ‚îÄ‚îÄ Body-level tooltip engine (fixes sidebar overflow clipping) ‚îÄ‚îÄ */
    function initTooltips() {
      var ttEl = document.getElementById('tt-root');
      if (!ttEl) {
        ttEl = document.createElement('div');
        ttEl.id = 'tt-root';
        document.body.appendChild(ttEl);
      }

      var hideTimer = null;
      var activeEl = null;

      function show(text, targetEl) {
        clearTimeout(hideTimer);
        activeEl = targetEl;
        ttEl.textContent = text;
        ttEl.classList.add('tt-visible');
        position(targetEl);
      }

      function hide() {
        hideTimer = setTimeout(function() {
          ttEl.classList.remove('tt-visible');
          activeEl = null;
        }, 80);
      }

      function position(el) {
        var rect = el.getBoundingClientRect();
        var ttW = 270;
        var gap = 8;
        var left = rect.left + rect.width / 2 - ttW / 2;
        left = Math.max(12, Math.min(left, window.innerWidth - ttW - 12));
        ttEl.style.width = ttW + 'px';
        ttEl.style.left = left + 'px';
        // Measure height after setting content
        var ttH = ttEl.offsetHeight || 60;
        var top, transform;
        if (rect.top - ttH - gap - 8 < 0) {
          top = rect.bottom + window.scrollY + gap;
          transform = 'none';
        } else {
          top = rect.top + window.scrollY - ttH - gap;
          transform = 'none';
        }
        ttEl.style.top = top + 'px';
        ttEl.style.transform = transform;
        ttEl.style.position = 'absolute';
      }

      /* Kill CSS ::after tooltips ‚Äî they clip in overflow containers */
      var killStyle = document.createElement('style');
      killStyle.textContent = '.help-icon::after,.help-icon:hover::after,[data-help]::after,[data-tt]::after,.term-helper::after,.term-helper:hover::after{content:none!important;display:none!important;}';
      document.head.appendChild(killStyle);

      /* Desktop: mouse events (event delegation) */
      document.addEventListener('mouseover', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) return;
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (text && text !== 'Loading...') show(text, el);
      });

      document.addEventListener('mouseout', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (el) hide();
      });

      /* Mobile: tap to toggle */
      document.addEventListener('click', function(e) {
        var el = e.target.closest('[data-help], [data-tt]');
        if (!el) {
          // tap anywhere else hides tooltip
          if (ttEl.classList.contains('tt-visible')) {
            ttEl.classList.remove('tt-visible');
            activeEl = null;
          }
          return;
        }
        var text = el.getAttribute('data-help') || el.getAttribute('data-tt');
        if (!text || text === 'Loading...') return;
        if (activeEl === el && ttEl.classList.contains('tt-visible')) {
          ttEl.classList.remove('tt-visible');
          activeEl = null;
        } else {
          show(text, el);
        }
        e.stopPropagation();
      });

      /* Reposition on scroll (don't hide, just reposition) */
      window.addEventListener('scroll', function() {
        if (activeEl && ttEl.classList.contains('tt-visible')) {
          position(activeEl);
        }
      }, { passive: true });

      /* Hide on resize */
      window.addEventListener('resize', function() {
        ttEl.classList.remove('tt-visible');
        activeEl = null;
      }, { passive: true });
    }


</script>


</body>
</html>
